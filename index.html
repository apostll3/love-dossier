<!doctype html>
<html lang="uk" id="htmlRoot">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title data-i18n="app.title">–î–æ—Å—å—î –∫–æ—Ö–∞–Ω–æ—ó –ª—é–¥–∏–Ω–∏</title>
<link rel="icon" type="image/x-icon" href="LoveDossier.ico">
<!--
  üìù –Ü–ù–°–¢–†–£–ö–¶–Ü–Ø –ó –§–û–†–ú–ê–¢–£–í–ê–ù–ù–Ø –¢–ï–ö–°–¢–£:
  
  –ü—Ä–∏ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—ñ –ø–æ–ª—ñ–≤ –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Å–ø–µ—Ü—ñ–∞–ª—å–Ω–∏–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –¥–ª—è —Ñ–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è:
  
  **–∂–∏—Ä–Ω–∏–π —Ç–µ–∫—Å—Ç** –∞–±–æ __–∂–∏—Ä–Ω–∏–π —Ç–µ–∫—Å—Ç__ ‚Üí –∂–∏—Ä–Ω–∏–π —Ç–µ–∫—Å—Ç (—Å–∏–Ω—ñ–π –∫–æ–ª—ñ—Ä)
  *–∫—É—Ä—Å–∏–≤* –∞–±–æ _–∫—É—Ä—Å–∏–≤_ ‚Üí –∫—É—Ä—Å–∏–≤
  ~~–∑–∞–∫—Ä–µ—Å–ª–µ–Ω–∏–π~~ ‚Üí –∑–∞–∫—Ä–µ—Å–ª–µ–Ω–∏–π —Ç–µ–∫—Å—Ç
  [—Ç–µ–∫—Å—Ç –ø–æ—Å–∏–ª–∞–Ω–Ω—è](https://example.com) ‚Üí –∫–ª—ñ–∫–∞–±–µ–ª—å–Ω–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è
  
  üé® –®–í–ò–î–ö–ï –§–û–†–ú–ê–¢–£–í–ê–ù–ù–Ø:
  1. –í–∏–¥—ñ–ª—ñ—Ç—å —Ç–µ–∫—Å—Ç –≤ –ø–æ–ª—ñ input –∞–±–æ textarea
  2. –ó'—è–≤–∏—Ç—å—Å—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–µ –º–µ–Ω—é –∑ –∫–Ω–æ–ø–∫–∞–º–∏ —Ñ–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è
  3. –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –ø–æ—Ç—Ä—ñ–±–Ω—É –∫–Ω–æ–ø–∫—É –∞–±–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ –≥–∞—Ä—è—á—ñ –∫–ª–∞–≤—ñ—à—ñ:
     ‚Ä¢ Ctrl+B - –∂–∏—Ä–Ω–∏–π
     ‚Ä¢ Ctrl+I - –∫—É—Ä—Å–∏–≤
     ‚Ä¢ Ctrl+K - –ø–æ—Å–∏–ª–∞–Ω–Ω—è
  
  –ü—Ä–∏–∫–ª–∞–¥: "–õ—é–±–∏—Ç—å **—à–æ–∫–æ–ª–∞–¥** —ñ *–∫–∞–≤—É*, –∞–ª–µ ~~–Ω–µ –ª—é–±–∏—Ç—å~~ —á–∞–π. [–£–ª—é–±–ª–µ–Ω–∏–π —Å–∞–π—Ç](https://example.com)"
  
  –¶–µ –ø—Ä–∞—Ü—é—î –≤ —É—Å—ñ—Ö —Ç–∏–ø–∞—Ö –ø–æ–ª—ñ–≤: text, textarea, tags, —ñ –Ω–∞–≤—ñ—Ç—å —É –≤–∫–ª–∞–¥–µ–Ω–∏—Ö –ø–æ–ª—è—Ö!
-->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
<!-- Google API –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó -->
<script src="https://accounts.google.com/gsi/client" async defer></script>
<script src="https://apis.google.com/js/api.js" async defer></script>
<style>
*, *::before, *::after {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

:root {
  --primary: #6366f1;
  --primary-dark: #4f46e5;
  --bg: #f8fafc;
  --card: #ffffff;
  --border: #e2e8f0;
  --text: #0f172a;
  --text-muted: #64748b;
  --success: #10b981;
  --warning: #f59e0b;
  --danger: #ef4444;
  --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
  --shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1);
  --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1);
  --radius: 0.75rem;
  --radius-sm: 0.5rem;
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
}

body {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  min-height: 100vh;
  padding: 1.5rem;
  color: var(--text);
  line-height: 1.6;
}

/* –ó–∞–±–æ—Ä–æ–Ω–∞ –≤–∏–¥—ñ–ª–µ–Ω–Ω—è UI –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ */
button,
.btn,
.header,
.sidebar,
.category-item,
.field-label,
.field-meta,
.badge,
.chip,
.modal-header,
.modal-footer,
.content-title,
.content-actions,
.filters-toggle-btn,
.filters-dropdown-label,
.progress-bar-text,
label,
.header-title,
.header-icon,
.sidebar-title,
.empty-state-icon,
.toast,
i,
.field-controls {
  user-select: none;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
}

/* –î–æ–∑–≤–æ–ª—è—î–º–æ –≤–∏–¥—ñ–ª–µ–Ω–Ω—è –∫–æ–Ω—Ç–µ–Ω—Ç—É */
input,
textarea,
.field-value,
.nested-subcategory,
.search-input {
  user-select: text;
  -webkit-user-select: text;
  -moz-user-select: text;
  -ms-user-select: text;
}

.container {
  max-width: 1400px;
  margin: 0 auto;
}

/* Header */
.header {
  background: var(--card);
  border-radius: var(--radius);
  padding: 1.5rem;
  margin-bottom: 1.5rem;
  box-shadow: var(--shadow-lg);
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

/* Header top row */
.header-top {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 1rem;
  flex-wrap: wrap;
}

.header-title {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  font-size: 1.5rem;
  font-weight: 700;
  color: var(--primary);
}

.header-main-actions {
  display: flex;
  gap: 0.5rem;
  align-items: center;
  flex-wrap: wrap;
  position: relative;
}

/* Header Menu Button */
.header-menu-btn {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.5rem 0.875rem;
  border: 2px solid var(--border);
  background: white;
  color: var(--text);
  border-radius: var(--radius-sm);
  font-size: 0.8125rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s ease;
  position: relative;
}

.header-menu-btn:hover {
  border-color: var(--primary);
  color: var(--primary);
  transform: translateY(-1px);
  box-shadow: var(--shadow);
}

.header-menu-btn.active {
  background: var(--primary);
  border-color: var(--primary);
  color: white;
  box-shadow: var(--shadow);
}

.header-menu-btn i {
  font-size: 0.875rem;
}

/* Header Menu Dropdown */
.header-menu-dropdown {
  display: none;
  position: absolute;
  top: calc(100% + 0.5rem);
  right: 0;
  background: white;
  border: 2px solid var(--primary);
  border-radius: var(--radius);
  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
  padding: 0.5rem;
  z-index: 1000;
  min-width: 200px;
}

.header-menu-dropdown.active {
  display: flex;
  flex-direction: column;
  animation: dropdownSlide 0.2s ease;
}

.header-menu-dropdown.closing {
  display: flex;
  flex-direction: column;
  animation: dropdownSlideOut 0.2s ease forwards;
  pointer-events: none;
}

.header-menu-dropdown .btn {
  width: 100%;
  justify-content: flex-start;
  text-align: left;
  border-radius: var(--radius-sm);
  padding: 0.625rem 0.875rem;
  font-size: 0.875rem;
  background: transparent;
  border: none;
  color: var(--text);
  font-weight: 600;
  transition: all 0.2s ease;
}

.header-menu-dropdown .btn:hover {
  background: var(--bg);
  color: var(--primary);
}

.header-menu-dropdown .btn i {
  width: 1.25rem;
  margin-right: 0.5rem;
}

.header-menu-dropdown .btn.danger:hover {
  background: rgba(239, 68, 68, 0.1);
  color: var(--danger);
}

/* Header bottom row */
.header-bottom {
  display: grid;
  grid-template-columns: 1fr auto;
  gap: 1rem;
  align-items: center;
}

.header-icon {
  width: 2.5rem;
  height: 2.5rem;
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-size: 1.25rem;
}

/* SVG inside header-icon */
.header-icon svg {
  width: 100%;
  height: 100%;
  display: block;
  transition: transform 0.3s ease, filter 0.3s ease;
}

.header-icon svg:hover {
  transform: scale(1.05);
  filter: drop-shadow(0 4px 8px rgba(99, 102, 241, 0.3));
}

.header-actions {
  display: flex;
  gap: 0.5rem;
  flex-wrap: wrap;
}

/* Search Bar */
.header-search {
  position: relative;
  min-width: 0;
}

.search-input-container {
  position: relative;
  width: 100%;
}

.search-input {
  width: 100%;
  padding: 0.625rem 2.5rem 0.625rem 2.5rem;
  border: 2px solid var(--border);
  border-radius: var(--radius-sm);
  font-size: 0.875rem;
  background: white;
  transition: all 0.2s ease;
  font-family: inherit;
}

.search-input:hover {
  border-color: #cbd5e1;
}

.search-input:focus {
  outline: none;
  border-color: var(--primary);
  box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
}

.search-icon {
  position: absolute;
  left: 0.875rem;
  top: 50%;
  transform: translateY(-50%);
  color: var(--text-muted);
  font-size: 0.875rem;
  pointer-events: none;
}

.search-input:focus ~ .search-icon {
  color: var(--primary);
}

.search-clear-btn {
  position: absolute;
  right: 0.5rem;
  top: 50%;
  transform: translateY(-50%);
  background: none;
  border: none;
  color: var(--text-muted);
  cursor: pointer;
  width: 1.5rem;
  height: 1.5rem;
  border-radius: 50%;
  display: none;
  align-items: center;
  justify-content: center;
  transition: all 0.2s ease;
  font-size: 1rem;
}

.search-clear-btn.visible {
  display: flex;
}

.search-clear-btn:hover {
  background: rgba(0, 0, 0, 0.05);
  color: var(--danger);
}

/* Progress Bar */
.header-progress {
  position: relative;
  display: flex;
  align-items: center;
  gap: 1rem;
  white-space: nowrap;
}

.progress-bar-container {
  width: 120px;
  height: 8px;
  background: var(--border);
  border-radius: 999px;
  overflow: hidden;
  position: relative;
  cursor: help;
  flex-shrink: 0;
}

.progress-bar-fill {
  height: 100%;
  background: linear-gradient(90deg, var(--primary), var(--primary-dark));
  border-radius: 999px;
  transition: width 0.3s ease;
  box-shadow: 0 0 8px rgba(99, 102, 241, 0.4);
}

.progress-bar-text {
  font-size: 0.75rem;
  color: var(--text-muted);
  font-weight: 600;
  min-width: 0;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* Search Highlight */
.search-highlight {
  background: #fef08a;
  color: #854d0e;
  font-weight: 600;
  padding: 0;
  border-radius: 2px;
}

/* Search Badge */
.search-result-badge {
  display: inline-flex;
  align-items: center;
  gap: 0.25rem;
  background: rgba(99, 102, 241, 0.1);
  color: var(--primary);
  padding: 0.125rem 0.5rem;
  border-radius: 999px;
  font-size: 0.7rem;
  font-weight: 600;
  margin-left: 0.5rem;
}

/* Fill Filter */
.fill-filter {
  display: inline-flex;
  gap: 0.25rem;
  background: var(--bg);
  padding: 0.25rem;
  border-radius: var(--radius-sm);
  border: 2px solid var(--border);
}

.fill-filter-btn {
  display: inline-flex;
  align-items: center;
  gap: 0.375rem;
  padding: 0.5rem 0.875rem;
  border: none;
  background: transparent;
  color: var(--text-muted);
  border-radius: var(--radius-sm);
  font-size: 0.8125rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s ease;
  white-space: nowrap;
}

.fill-filter-btn:hover {
  background: rgba(99, 102, 241, 0.1);
  color: var(--primary);
}

.fill-filter-btn.active {
  background: linear-gradient(135deg, var(--primary), var(--primary-dark));
  color: white;
  box-shadow: 0 2px 8px rgba(99, 102, 241, 0.3);
}

.fill-filter-btn i {
  font-size: 0.875rem;
}

/* Importance Filter */
.importance-filter {
  display: inline-flex;
  gap: 0.25rem;
}

.importance-filter-btn {
  display: inline-flex;
  align-items: center;
  gap: 0.375rem;
  padding: 0.5rem 0.875rem;
  border: 2px solid var(--border);
  background: var(--bg);
  color: var(--text-muted);
  border-radius: var(--radius-sm);
  font-size: 0.8125rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s ease;
  white-space: nowrap;
}

.importance-filter-btn:hover {
  border-color: var(--text-muted);
  transform: translateY(-1px);
}

.importance-filter-btn.active.high {
  background: var(--danger);
  border-color: var(--danger);
  color: white;
  box-shadow: 0 2px 8px rgba(239, 68, 68, 0.3);
}

.importance-filter-btn.active.medium {
  background: var(--warning);
  border-color: var(--warning);
  color: white;
  box-shadow: 0 2px 8px rgba(245, 158, 11, 0.3);
}

.importance-filter-btn.active.low {
  background: var(--success);
  border-color: var(--success);
  color: white;
  box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3);
}

.importance-filter-btn i {
  font-size: 0.875rem;
}

/* Main layout */
.main-grid {
  display: grid;
  grid-template-columns: 300px 1fr;
  gap: 1.5rem;
  align-items: start;
}


/* Sidebar */
.sidebar {
  background: var(--card);
  border-radius: var(--radius);
  padding: 1.5rem;
  box-shadow: var(--shadow-lg);
  position: sticky;
  top: 1.5rem;
  max-height: calc(100vh - 3rem);
  overflow-y: auto;
  transition: all 0.3s ease;
}

/* –ö–Ω–æ–ø–∫–∞ toggle (—Ç—ñ–ª—å–∫–∏ –Ω–∞ –º–æ–±—ñ–ª—å–Ω–∏—Ö) */
.sidebar-toggle-btn {
  display: none;
  width: 100%;
  margin-bottom: 1rem;
  background: linear-gradient(135deg, #4f46e5, #3730a3);
  color: white;
  border: none;
  padding: 0.875rem 1rem;
  border-radius: var(--radius);
  font-weight: 600;
  font-size: 0.9375rem;
  cursor: pointer;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
  transition: all 0.3s ease;
  box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3);
  position: relative;
  overflow: hidden;
}

.sidebar-toggle-btn::before {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(135deg, rgba(255,255,255,0.1), transparent);
  opacity: 0;
  transition: opacity 0.3s ease;
}

.sidebar-toggle-btn:hover {
  transform: translateY(-1px);
  box-shadow: 0 6px 16px rgba(79, 70, 229, 0.4);
  background: linear-gradient(135deg, #5b52e8, #4338ca);
}

.sidebar-toggle-btn:hover::before {
  opacity: 1;
}

.sidebar-toggle-btn:active {
  transform: translateY(0);
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
}

.sidebar-toggle-btn .sidebar-toggle-icon {
  font-size: 1.125rem;
  opacity: 0.9;
}

.sidebar-toggle-btn .sidebar-toggle-arrow {
  margin-left: auto;
  font-size: 0.875rem;
  transition: transform 0.3s ease;
}

.sidebar-toggle-btn.active .sidebar-toggle-arrow {
  transform: rotate(180deg);
}

.sidebar-toggle-btn span {
  font-weight: 600;
  letter-spacing: 0.02em;
  flex: 1;
  text-align: left;
}

.sidebar-title {
  font-size: 0.875rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  color: var(--text-muted);
  margin-bottom: 1rem;
}

.category-nav {
  display: flex;
  flex-direction: column;
  gap: 0.25rem;
  margin-bottom: 1rem;
}

/* –ö–Ω–æ–ø–∫–∞ –¥–æ–¥–∞–≤–∞–Ω–Ω—è –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó */
.btn-add-category {
  width: 100%;
  background: linear-gradient(135deg, #10b981, #059669);
  color: white;
  border: none;
  padding: 0.875rem 1rem;
  border-radius: var(--radius);
  font-weight: 600;
  font-size: 0.875rem;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
  transition: all 0.3s ease;
  box-shadow: 0 2px 8px rgba(16, 185, 129, 0.25);
  position: relative;
  overflow: hidden;
}

.btn-add-category::before {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(135deg, rgba(255,255,255,0.15), transparent);
  opacity: 0;
  transition: opacity 0.3s ease;
}

.btn-add-category:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(16, 185, 129, 0.35);
  background: linear-gradient(135deg, #14c992, #06a372);
}

.btn-add-category:hover::before {
  opacity: 1;
}

.btn-add-category:active {
  transform: translateY(0);
  box-shadow: 0 2px 6px rgba(16, 185, 129, 0.2);
}

.btn-add-category i {
  font-size: 1rem;
}

.btn-add-category span {
  font-weight: 600;
  letter-spacing: 0.01em;
}

.category-item {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  padding: 0.75rem;
  border-radius: var(--radius-sm);
  cursor: pointer;
  transition: all 0.2s;
  border: 2px solid transparent;
  background: var(--bg);
}

.category-item:hover {
  background: rgba(99, 102, 241, 0.1);
  border-color: var(--primary);
}

.category-item.active {
  background: var(--primary);
  color: white;
  font-weight: 600;
}

.category-icon {
  width: 2rem;
  height: 2rem;
  background: rgba(99, 102, 241, 0.1);
  color: var(--primary);
  border-radius: var(--radius-sm);
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
}

.category-item.active .category-icon {
  background: rgba(255, 255, 255, 0.2);
  color: white;
}

.category-label {
  flex: 1;
  font-size: 0.9rem;
}

.category-count {
  font-size: 0.75rem;
  background: rgba(0, 0, 0, 0.1);
  padding: 0.125rem 0.5rem;
  border-radius: 999px;
  font-weight: 600;
}

.category-item.active .category-count {
  background: rgba(255, 255, 255, 0.2);
}

/* Content area */
.content {
  background: var(--card);
  border-radius: var(--radius);
  padding: 1.5rem;
  box-shadow: var(--shadow-lg);
  min-height: 400px;
  position: relative;
}

.content-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1.5rem;
  padding-bottom: 1rem;
  border-bottom: 2px solid var(--border);
  gap: 1rem;
  flex-wrap: wrap;
}

.content-title {
  font-size: 1.5rem;
  font-weight: 700;
  display: flex;
  align-items: center;
  gap: 0.75rem;
}

.content-title i {
  color: var(--primary);
}

.content-title span {
  line-height: 1;
}

.content-actions {
  display: flex;
  gap: 0.5rem;
  flex-wrap: wrap;
  align-items: center;
  position: relative;
}

/* Filters Toggle */
.filters-toggle-btn {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.5rem 0.875rem;
  border: 2px solid var(--border);
  background: white;
  color: var(--text);
  border-radius: var(--radius-sm);
  font-size: 0.8125rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s ease;
  position: relative;
}

.filters-toggle-btn:hover {
  border-color: var(--primary);
  color: var(--primary);
  transform: translateY(-1px);
  box-shadow: var(--shadow);
}

.filters-toggle-btn.active {
  background: var(--primary);
  border-color: var(--primary);
  color: white;
  box-shadow: var(--shadow);
}

.filters-toggle-btn i {
  font-size: 0.875rem;
}

/* Badge –∑ –∫—ñ–ª—å–∫—ñ—Å—Ç—é –∞–∫—Ç–∏–≤–Ω–∏—Ö —Ñ—ñ–ª—å—Ç—Ä—ñ–≤ */
.filters-badge {
  position: absolute;
  top: -6px;
  right: -6px;
  background: var(--danger);
  color: white;
  border-radius: 999px;
  width: 18px;
  height: 18px;
  font-size: 0.65rem;
  font-weight: 700;
  display: flex;
  align-items: center;
  justify-content: center;
  border: 2px solid white;
}

.filters-container {
  display: none;
}

.filters-dropdown {
  display: none;
  position: absolute;
  top: 100%;
  right: 0;
  margin-top: 0.5rem;
  background: white;
  border: 2px solid var(--primary);
  border-radius: var(--radius);
  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
  padding: 1.25rem;
  z-index: 1000;
  max-width: 328px;
  width: max-content;
}

.filters-dropdown.active {
  display: flex;
  flex-direction: column;
  animation: dropdownSlide 0.2s ease;
}

.filters-dropdown.closing {
  display: flex;
  flex-direction: column;
  animation: dropdownSlideOut 0.2s ease forwards;
  pointer-events: none;
}

@keyframes dropdownSlide {
  from {
    opacity: 0;
    transform: translateY(-10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes dropdownSlideOut {
  from {
    opacity: 1;
    transform: translateY(0);
  }
  to {
    opacity: 0;
    transform: translateY(-10px);
  }
}

.filters-dropdown-section {
  margin-bottom: 1.25rem;
}

.filters-dropdown-section:last-child {
  margin-bottom: 0;
}

.filters-dropdown-label {
  font-size: 0.8125rem;
  font-weight: 700;
  text-transform: uppercase;
  color: var(--primary);
  margin-bottom: 0.75rem;
  letter-spacing: 0.05em;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.filters-dropdown-label i {
  font-size: 1rem;
}

/* –°—Ç–∏–ª—ñ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –≤ dropdown */
.filters-dropdown .fill-filter,
.filters-dropdown .importance-filter {
  display: flex;
  gap: 0.375rem;
  flex-wrap: wrap;
}

.filters-dropdown .fill-filter-btn,
.filters-dropdown .importance-filter-btn {
  flex: 1 1 auto;
  min-width: fit-content;
  justify-content: center;
  padding: 0.625rem 0.625rem;
  font-size: 0.8125rem;
}

.filters-dropdown .fill-filter-btn span,
.filters-dropdown .importance-filter-btn span {
  white-space: nowrap;
}

/* Fields grid */
.fields-grid {
  display: grid;
  gap: 1rem;
}

.field-card {
  background: var(--bg);
  border: 2px solid var(--border);
  border-radius: var(--radius-sm);
  padding: 1rem;
  transition: all 0.2s;
}

.field-card:hover {
  border-color: var(--primary);
  box-shadow: var(--shadow);
}

.field-header {
  display: flex;
  justify-content: space-between;
  align-items: start;
  gap: 1rem;
  margin-bottom: 0.75rem;
}

.field-info {
  flex: 1;
}

.field-label {
  font-weight: 600;
  font-size: 1rem;
  margin-bottom: 0.25rem;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.field-meta {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  font-size: 0.75rem;
  color: var(--text-muted);
}

.field-controls {
  display: flex;
  gap: 0.25rem;
  position: relative;
}

/* –ö–Ω–æ–ø–∫–∞ –º–µ–Ω—é (–ø–æ–∫–∞–∑—É—î—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ –Ω–∞ –¥—É–∂–µ –º–∞–ª–µ–Ω—å–∫–∏—Ö –µ–∫—Ä–∞–Ω–∞—Ö) */
.field-controls-menu-btn {
  display: none !important;
}

@media (max-width: 500px) {
  .field-controls-menu-btn {
    display: flex !important;
  }
}

/* Popup –º–µ–Ω—é –¥–ª—è –∫–Ω–æ–ø–æ–∫ */
.field-controls-popup {
  display: none;
  position: absolute;
  top: 100%;
  right: 0;
  margin-top: 0.5rem;
  background: white;
  border: 1px solid var(--border);
  border-radius: var(--radius-sm);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  padding: 0.5rem;
  z-index: 100;
  min-width: 150px;
}

.field-controls-popup.active {
  display: flex;
  flex-direction: column;
  gap: 0.25rem;
}

.field-controls-popup .btn {
  width: 100%;
  justify-content: flex-start;
}

.field-value {
  padding: 0.75rem;
  background: white;
  border-radius: var(--radius-sm);
  border: 1px solid var(--border);
  min-height: 3rem;
  display: flex;
  align-items: center;
  white-space: pre-wrap;
  word-wrap: break-word;
  flex-wrap: wrap;
}

.field-value.empty {
  color: var(--text-muted);
  font-style: italic;
}

.field-value strong,
.field-value b {
  font-weight: 700;
  color: var(--primary);
}

.field-value em,
.field-value i {
  font-style: italic;
  color: var(--text);
}

.field-value u {
  text-decoration: underline;
}

.field-value del {
  text-decoration: line-through;
  opacity: 0.7;
}

.field-value a {
  color: var(--primary);
  text-decoration: underline;
  font-weight: 600;
  transition: all 0.2s;
}

.field-value a:hover {
  color: var(--primary-dark);
  text-decoration: none;
}

/* Nested fields */
.nested-container {
  display: grid;
  gap: 0.75rem;
  margin-top: 0.75rem;
}

.nested-category {
  background: white;
  border-radius: var(--radius-sm);
  padding: 1rem;
  border: 1px solid var(--border);
}

.nested-category-title {
  font-weight: 600;
  margin-bottom: 0.75rem;
  padding-bottom: 0.5rem;
  border-bottom: 1px solid var(--border);
}

.nested-subcategory {
  margin-top: 0.75rem;
}

.nested-subcategory:first-child {
  margin-top: 0;
}

.nested-label {
  font-size: 0.875rem;
  font-weight: 500;
  color: var(--text-muted);
  margin-bottom: 0.5rem;
}

.chips-container {
  display: flex;
  flex-wrap: wrap;
  gap: 0.5rem;
}

.chip {
  background: var(--primary);
  color: white;
  padding: 0.25rem 0.75rem;
  border-radius: 999px;
  font-size: 0.875rem;
  font-weight: 500;
}

.chip em {color:#e2e8f0}

.chip strong,
.chip b {
  font-weight: 700;
  color: white;
}

.chip em,
.chip i {
  font-style: italic;
}

.chip del {
  text-decoration: line-through;
  opacity: 0.8;
}

.chip a {
  color: white;
  text-decoration: underline;
  font-weight: 600;
}

.chip a:hover {
  opacity: 0.9;
}

/* Buttons */
.btn {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.5rem 1rem;
  border-radius: var(--radius-sm);
  border: none;
  font-weight: 600;
  font-size: 0.875rem;
  cursor: pointer;
  transition: all 0.2s;
  white-space: nowrap;
}

.btn-primary {
  background: var(--primary);
  color: white;
}

.btn-primary:hover {
  background: var(--primary-dark);
  transform: translateY(-1px);
  box-shadow: var(--shadow);
}

.btn-secondary {
  background: var(--bg);
  color: var(--text);
  border: 2px solid var(--border);
}

.btn-secondary:hover {
  border-color: var(--primary);
  color: var(--primary);
}

.btn-sm {
  padding: 0.375rem 0.75rem;
  font-size: 0.8rem;
}

.btn-icon {
  padding: 0.5rem;
  aspect-ratio: 1;
}

/* Badges */
.badge {
  display: inline-flex;
  align-items: center;
  gap: 0.375rem;
  padding: 0.25rem 0.625rem;
  border-radius: 999px;
  font-size: 0.75rem;
  font-weight: 600;
}

.badge i {
  font-size: 0.875rem;
}

.badge-high {
  background: rgba(239, 68, 68, 0.1);
  color: var(--danger);
}

.badge-medium {
  background: rgba(245, 158, 11, 0.1);
  color: var(--warning);
}

.badge-low {
  background: rgba(16, 185, 129, 0.1);
  color: var(--success);
}

/* Modal */
.modal-backdrop {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.5);
  backdrop-filter: blur(4px);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 1000;
  padding: 1rem;
  transition: opacity 0.2s ease;
  opacity: 0;
}

.modal-backdrop.active,
.modal-backdrop.closing {
  display: flex;
}

.modal-backdrop.active {
  opacity: 1;
}

.modal {
  background: var(--card);
  border-radius: 12px;
  max-width: 600px;
  width: 100%;
  max-height: 90vh;
  display: flex;
  flex-direction: column;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3), 0 0 0 1px rgba(0, 0, 0, 0.05);
  transform: scale(0.95);
  opacity: 0;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  overflow: hidden;
}

.modal-large {
  max-width: 900px;
}

.modal-small {
  max-width: 400px;
}

.modal-backdrop.active .modal {
  transform: scale(1) translateY(0);
  opacity: 1;
}

.modal-backdrop.closing .modal {
  transform: scale(0.9) translateY(20px);
  opacity: 0;
}

.modal-backdrop.closing {
  opacity: 0;
}

.modal-header {
  padding: 1.25rem 1.5rem;
  background: linear-gradient(135deg, rgba(99, 102, 241, 0.03), rgba(99, 102, 241, 0.01));
  border-bottom: 1px solid rgba(99, 102, 241, 0.1);
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 1rem;
}

.modal-title {
  font-size: 1.25rem;
  font-weight: 700;
  display: flex;
  line-height: 1.3;
  align-items: center;
  gap: 0.875rem;
  color: var(--text);
  flex: 1;
}

.modal-title-icon {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 2.75rem;
  height: 2.75rem;
  background: linear-gradient(135deg, var(--primary), var(--primary-dark));
  color: white;
  border-radius: 12px;
  font-size: 1.25rem;
  box-shadow: 0 4px 16px rgba(99, 102, 241, 0.35);
  flex-shrink: 0;
  transition: all 0.3s ease;
}

.modal-title-icon:hover {
  transform: scale(1.05);
  box-shadow: 0 6px 20px rgba(99, 102, 241, 0.45);
}

.modal-title span {
  line-height: 1.3;
}

.modal-close-btn {
  width: 2rem;
  height: 2rem;
  border-radius: 8px;
  background: linear-gradient(135deg, var(--primary), var(--primary-dark));
  border: none;
  color: white;
  transition: all 0.3s ease;
  flex-shrink: 0;
  box-shadow: 0 3px 10px rgba(99, 102, 241, 0.3);
  display: flex;
  align-items: center;
  justify-content: center;
}

.modal-close-btn:hover {
  transform: scale(1.05);
  box-shadow: 0 4px 14px rgba(99, 102, 241, 0.4);
}

.modal-close-btn:active {
  transform: scale(0.95);
  box-shadow: 0 2px 8px rgba(99, 102, 241, 0.25);
}

.modal-close-btn i {
  font-size: 1rem;
}

.modal-body {
  padding: 1.5rem;
  overflow-y: auto;
  flex: 1;
  background: var(--card);
}

.modal-footer {
  padding: 1.25rem 1.5rem;
  background: var(--bg);
  border-top: 1px solid var(--border);
  display: flex;
  gap: 0.75rem;
  justify-content: flex-end;
}

/* Form elements */
.form-group {
  margin-bottom: 1.25rem;
}

.form-label {
  display: block;
  font-weight: 600;
  margin-bottom: 0.625rem;
  font-size: 0.875rem;
  color: var(--text);
  letter-spacing: 0.01em;
}

.checkbox-label {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  cursor: pointer;
  font-size: 0.875rem;
  font-weight: 600;
  color: var(--text);
  user-select: none;
}

.checkbox-label input[type="checkbox"] {
  cursor: pointer;
  width: 1.125rem;
  height: 1.125rem;
}

.form-input,
.form-textarea,
.form-select {
  width: 100%;
  padding: 0.875rem 1rem;
  border: 2px solid var(--border);
  border-radius: 8px;
  font-size: 0.9375rem;
  background: white;
  transition: all 0.2s ease;
  font-family: inherit;
}

.form-select {
  appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;
  padding-right: 2.75rem;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 20 20' fill='none'%3E%3Cpath d='M5 7.5L10 12.5L15 7.5' stroke='%236366f1' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 0.875rem center;
  background-size: 20px;
  cursor: pointer;
  position: relative;
}

.form-input:hover,
.form-textarea:hover {
  border-color: #cbd5e1;
}

.form-select:hover {
  border-color: #cbd5e1;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 20 20' fill='none'%3E%3Cpath d='M5 7.5L10 12.5L15 7.5' stroke='%234f46e5' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E");
}

.form-select:active {
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 20 20' fill='none'%3E%3Cpath d='M5 12.5L10 7.5L15 12.5' stroke='%234f46e5' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E");
}

.form-input:focus,
.form-textarea:focus {
  outline: none;
  border-color: var(--primary);
  box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
  background: white;
}

.form-select:focus {
  outline: none;
  border-color: var(--primary);
  box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
  background-color: white;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 20 20' fill='none'%3E%3Cpath d='M5 12.5L10 7.5L15 12.5' stroke='%234f46e5' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E");
}

.form-textarea {
  resize: vertical;
  min-height: 120px;
  line-height: 1.6;
}

.form-row {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 1rem;
}

.form-checkbox {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  margin-top: 0.75rem;
  cursor: pointer;
  user-select: none;
}

.form-checkbox input[type="checkbox"] {
  appearance: none;
  -webkit-appearance: none;
  width: 1.25rem;
  height: 1.25rem;
  border: 2px solid var(--border);
  border-radius: 6px;
  cursor: pointer;
  position: relative;
  transition: all 0.2s ease;
  background: white;
  flex-shrink: 0;
}

.form-checkbox input[type="checkbox"]:hover {
  border-color: var(--primary);
  background: rgba(99, 102, 241, 0.05);
}

.form-checkbox input[type="checkbox"]:checked {
  background: linear-gradient(135deg, var(--primary), var(--primary-dark));
  border-color: var(--primary);
}

.form-checkbox input[type="checkbox"]:checked::after {
  content: '';
  position: absolute;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%) rotate(45deg);
  width: 5px;
  height: 9px;
  border: solid white;
  border-width: 0 2px 2px 0;
}

.form-checkbox input[type="checkbox"]:focus {
  outline: none;
  box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
}

.form-checkbox label {
  cursor: pointer;
  font-size: 0.9375rem;
  color: var(--text);
  line-height: 1.5;
}

/* Custom Select Dropdown */
.custom-select {
  position: relative;
  width: 100%;
}

.custom-select-trigger {
  width: 100%;
  padding: 0.875rem 1rem;
  padding-right: 2.75rem;
  border: 2px solid var(--border);
  border-radius: 8px;
  font-size: 0.9375rem;
  background: white;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 0.625rem;
  transition: all 0.2s ease;
  user-select: none;
}

.custom-select-trigger:hover {
  border-color: #cbd5e1;
}

.custom-select.active .custom-select-trigger {
  border-color: var(--primary);
  box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
}

.custom-select-trigger::after {
  content: '';
  position: absolute;
  right: 0.875rem;
  top: 50%;
  transform: translateY(-50%);
  width: 20px;
  height: 20px;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 20 20' fill='none'%3E%3Cpath d='M5 7.5L10 12.5L15 7.5' stroke='%236366f1' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: center;
  transition: transform 0.2s ease;
}

.custom-select.active .custom-select-trigger::after {
  transform: translateY(-50%) rotate(180deg);
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 20 20' fill='none'%3E%3Cpath d='M5 7.5L10 12.5L15 7.5' stroke='%234f46e5' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E");
}

.custom-select-icon {
  font-size: 1rem;
  color: var(--primary);
  flex-shrink: 0;
}

.custom-select-text {
  flex: 1;
  color: var(--text);
}

.custom-select-dropdown {
  position: fixed;
  background: white;
  border: 2px solid var(--border);
  border-radius: 8px;
  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
  max-height: 300px;
  overflow-y: auto;
  z-index: 10000;
  opacity: 0;
  transform: translateY(-10px);
  pointer-events: none;
  transition: all 0.2s ease;
}

/* –ö–∞—Å—Ç–æ–º–Ω–∏–π scrollbar –¥–ª—è dropdown */
.custom-select-dropdown::-webkit-scrollbar {
  width: 8px;
}

.custom-select-dropdown::-webkit-scrollbar-track {
  background: var(--bg);
  border-radius: 0 6px 6px 0;
}

.custom-select-dropdown::-webkit-scrollbar-thumb {
  background: linear-gradient(135deg, var(--primary), var(--primary-dark));
  border-radius: 4px;
  transition: background 0.2s ease;
}

.custom-select-dropdown::-webkit-scrollbar-thumb:hover {
  background: linear-gradient(135deg, var(--primary-dark), #3730a3);
}

/* Firefox scrollbar */
.custom-select-dropdown {
  scrollbar-width: thin;
  scrollbar-color: var(--primary) var(--bg);
}

.custom-select.active .custom-select-dropdown,
.custom-select-dropdown.active {
  opacity: 1;
  transform: translateY(0);
  pointer-events: all;
}

.custom-select-option {
  padding: 0.75rem 1rem;
  display: flex;
  align-items: center;
  gap: 0.625rem;
  cursor: pointer;
  transition: all 0.15s ease;
  border-bottom: 1px solid var(--border);
}

.custom-select-option:last-child {
  border-bottom: none;
}

.custom-select-option:hover {
  background: rgba(99, 102, 241, 0.05);
}

.custom-select-option.selected {
  background: linear-gradient(to right, rgba(99, 102, 241, 0.1), transparent);
  color: var(--primary);
  font-weight: 600;
}

.custom-select-option-icon {
  font-size: 1rem;
  color: var(--primary);
  flex-shrink: 0;
  width: 1.25rem;
  text-align: center;
}

.custom-select-option-text {
  flex: 1;
}

/* ============= Language Selector Styles ============= */
.language-select {
  width: auto;
  position: relative;
}

.language-trigger {
  width: 44px;
  height: 44px;
  padding: 0;
  border: 2px solid var(--border);
  border-radius: 50%;
  background: white;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.3s ease;
  position: relative;
}

.language-trigger::after {
  display: none; /* –ü—Ä–∏–±–∏—Ä–∞—î–º–æ —Å—Ç—Ä—ñ–ª–∫—É */
}

.language-trigger:hover {
  border-color: var(--primary);
  background: rgba(99, 102, 241, 0.05);
  transform: scale(1.05);
}

.language-select.active .language-trigger {
  border-color: var(--primary);
  background: rgba(99, 102, 241, 0.1);
  box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
}

.language-flag {
  width: 24px;
  height: auto;
  border-radius: 2px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
  overflow: hidden;

}

.language-flag svg {
  width: 100%;
  height: 100%;
  display: block;
}

.language-dropdown {
  min-width: 200px;
  padding: 0.5rem;
}

.language-option {
  padding: 0.75rem 1rem;
  display: flex;
  align-items: center;
  gap: 0.75rem;
  border-radius: 6px;
  cursor: pointer;
  transition: all 0.2s ease;
  border-bottom: none !important;
}

.language-option:hover {
  background: rgba(99, 102, 241, 0.08);
}

.language-option.selected {
  background: rgba(99, 102, 241, 0.12);
}

.language-option .language-flag {
  width: 24px;
  height: auto;
}

.language-name {
  flex: 1;
  font-size: 0.9375rem;
  color: var(--text);
  font-weight: 500;
}

.language-check {
  font-size: 0.875rem;
  color: var(--primary);
  flex-shrink: 0;
}

/* Responsive –¥–ª—è language selector */
@media (max-width: 768px) {
  .language-trigger {
    width: 40px;
    height: 40px;
  }
  
  .language-flag {
    width: 24px;
    height: auto;
  }
  
  .language-option .language-flag {
    width: 20px;
    height: auto;
  }
  
  .language-dropdown {
    min-width: 180px;
  }
}

/* Format Menu */
.format-menu {
  position: absolute;
  background: var(--card);
  border: 2px solid var(--border);
  border-radius: var(--radius-sm);
  box-shadow: var(--shadow-lg);
  padding: 0.5rem;
  display: none;
  z-index: 1500;
  gap: 0.25rem;
  flex-direction: row;
}

.format-menu.active {
  display: flex;
}

.format-menu-btn {
  padding: 0.5rem 0.75rem;
  border: none;
  background: var(--bg);
  border-radius: var(--radius-sm);
  cursor: pointer;
  transition: all 0.2s;
  font-size: 0.875rem;
  font-weight: 600;
  color: var(--text);
  display: flex;
  align-items: center;
  gap: 0.25rem;
}

.format-menu-btn:hover {
  background: var(--primary);
  color: white;
  transform: translateY(-1px);
}

.format-menu-btn i {
  font-size: 0.875rem;
}

/* Sync Status */
.sync-status {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.5rem 0.75rem;
  border-radius: var(--radius-sm);
  font-size: 0.8125rem;
  font-weight: 600;
  transition: all 0.2s ease;
}

.sync-status.synced {
  background: rgba(16, 185, 129, 0.1);
  color: #10b981;
}

.sync-status.syncing {
  background: rgba(245, 158, 11, 0.1);
  color: #f59e0b;
}

.sync-status.error {
  background: rgba(239, 68, 68, 0.1);
  color: var(--danger);
}

.sync-status.offline {
  background: var(--bg);
  color: var(--text-muted);
}

.sync-status.local {
  background: rgba(99, 102, 241, 0.1);
  color: var(--primary);
}

.sync-status i {
  font-size: 0.875rem;
}

/* Instruction Block */
.instruction-block {
  background: var(--bg);
  border-left: 4px solid var(--primary);
  padding: 1rem;
  border-radius: var(--radius-sm);
  margin: 1rem 0;
  font-size: 0.875rem;
  line-height: 1.6;
}

.instruction-block h4 {
  color: var(--primary);
  margin-bottom: 0.75rem;
  font-size: 0.9375rem;
}

.instruction-block ol {
  margin-left: 1.5rem;
  margin-top: 0.5rem;
}

.instruction-block li {
  margin-bottom: 0.5rem;
}

.instruction-block code {
  background: rgba(99, 102, 241, 0.1);
  padding: 0.125rem 0.375rem;
  border-radius: 3px;
  font-family: monospace;
  font-size: 0.8125rem;
}

.instruction-toggle {
  cursor: pointer;
  color: var(--primary);
  font-weight: 600;
  display: flex;
  align-items: center;
  gap: 0.5rem;
  margin-bottom: 0.75rem;
  user-select: none;
}

.instruction-toggle:hover {
  color: var(--primary-dark);
}

.instruction-toggle i {
  transition: transform 0.2s ease;
}

.instruction-toggle.expanded i {
  transform: rotate(180deg);
}

.instruction-content {
  display: none;
}

.instruction-content.show {
  display: block;
}

/* Password Input Group */
.password-input-group {
  position: relative;
}

.password-toggle {
  position: absolute;
  right: 0.75rem;
  top: 50%;
  transform: translateY(-50%);
  background: none;
  border: none;
  cursor: pointer;
  color: var(--text-muted);
  padding: 0.5rem;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: color 0.2s ease;
}

.password-toggle:hover {
  color: var(--primary);
}

/* Settings Section */
.settings-section {
  margin-bottom: 1.5rem;
  padding-bottom: 1.5rem;
  border-bottom: 1px solid var(--border);
}

.settings-section:last-child {
  border-bottom: none;
  margin-bottom: 0;
  padding-bottom: 0;
}

.settings-section-title {
  font-size: 1rem;
  font-weight: 700;
  color: var(--text);
  margin-bottom: 1rem;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.settings-section-title i {
  color: var(--primary);
}

.radio-group {
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
}

.radio-option {
  display: flex;
  align-items: flex-start;
  gap: 0.75rem;
  padding: 0.75rem;
  border: 2px solid var(--border);
  border-radius: var(--radius-sm);
  cursor: pointer;
  transition: all 0.2s ease;
}

.radio-option:hover {
  border-color: var(--primary);
  background: rgba(99, 102, 241, 0.05);
}

.radio-option input[type="radio"] {
  margin-top: 0.25rem;
  cursor: pointer;
}

.radio-option-content {
  flex: 1;
}

.radio-option-label {
  font-weight: 600;
  color: var(--text);
  margin-bottom: 0.25rem;
  display: block;
}

.radio-option-desc {
  font-size: 0.8125rem;
  color: var(--text-muted);
  line-height: 1.5;
}

.radio-option input[type="radio"]:checked ~ .radio-option-content .radio-option-label {
  color: var(--primary);
}

.sync-settings-group {
  display: flex;
  flex-direction: column;
  gap: 1rem;
  margin-top: 1rem;
  padding: 1rem;
  background: var(--bg);
  border-radius: var(--radius-sm);
}

.sync-buttons {
  display: flex;
  gap: 0.5rem;
  flex-wrap: wrap;
}

.security-notice {
  background: rgba(16, 185, 129, 0.1);
  border-left: 4px solid #10b981;
  padding: 1rem;
  border-radius: var(--radius-sm);
  margin-top: 1rem;
}

.security-notice-title {
  font-weight: 600;
  color: #10b981;
  margin-bottom: 0.5rem;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.security-notice ul {
  margin-left: 1.5rem;
  margin-top: 0.5rem;
  font-size: 0.8125rem;
  color: var(--text-muted);
  line-height: 1.6;
}

.sync-stats {
  display: flex;
  gap: 1.5rem;
  padding: 1rem;
  background: var(--bg);
  border-radius: var(--radius-sm);
  font-size: 0.875rem;
}

.sync-stat-item {
  display: flex;
  flex-direction: column;
  gap: 0.25rem;
}

.sync-stat-label {
  color: var(--text-muted);
  font-size: 0.75rem;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.sync-stat-value {
  font-weight: 600;
  color: var(--text);
}

/* Toast */
.toast-container {
  position: fixed;
  bottom: 1.5rem;
  right: 1.5rem;
  z-index: 2000;
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.toast {
  background: var(--text);
  color: white;
  padding: 1rem 1.5rem;
  border-radius: var(--radius-sm);
  box-shadow: var(--shadow-lg);
  display: flex;
  align-items: center;
  gap: 0.75rem;
  min-width: 300px;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.2s ease;
  opacity: 0;
  transform: translateX(400px);
}

.toast.show {
  animation: slideIn 0.3s ease forwards;
}

/* –¢–∏–ø–∏ toast –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å */
.toast-success {
  background: linear-gradient(135deg, #10b981 0%, #059669 100%);
  border-left: 4px solid #047857;
}

.toast-error {
  background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
  border-left: 4px solid #b91c1c;
  font-weight: 600;
}

.toast-warning {
  background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
  border-left: 4px solid #b45309;
  color: #ffffff;
}

.toast-info {
  background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
  border-left: 4px solid #1d4ed8;
}

.toast:hover {
  transform: scale(1.02);
  box-shadow: var(--shadow-xl);
}

.toast i {
  font-size: 1.25rem;
  flex-shrink: 0;
}

@keyframes slideIn {
  from {
    transform: translateX(400px);
    opacity: 0;
  }
  to {
    transform: translateX(0);
    opacity: 1;
  }
}

.toast.removing {
  animation: slideOut 0.3s ease forwards;
}

@keyframes slideOut {
  to {
    transform: translateX(400px);
    opacity: 0;
  }
}

/* Empty state */
.empty-state {
  text-align: center;
  padding: 3rem 1rem;
  color: var(--text-muted);
}

.empty-state-icon {
  font-size: 3rem;
  margin-bottom: 1rem;
  opacity: 0.5;
}

.empty-state-text {
  font-size: 1.125rem;
  margin-bottom: 0.5rem;
}

/* Utilities */
.hidden {
  display: none !important;
}

.fade-in {
  animation: fadeIn 0.3s ease;
}

@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(-10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* Scrollbar */
::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

::-webkit-scrollbar-track {
  background: var(--bg);
}

::-webkit-scrollbar-thumb {
  background: var(--border);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: var(--text-muted);
}

/* Responsive */
@media (max-width: 1024px) {
  /* –ü–æ–∫–∞–∑—É—î–º–æ –∫–Ω–æ–ø–∫—É toggle –Ω–∞ –ø–ª–∞–Ω—à–µ—Ç–∞—Ö —ñ –º–æ–±—ñ–ª—å–Ω–∏—Ö */
  .sidebar-toggle-btn {
    display: flex;
  }

  /* Sidebar –∫–æ–Ω—Ç–µ–Ω—Ç –∑–≥–æ—Ä—Ç–∞—î—Ç—å—Å—è */
  .sidebar.collapsed .category-nav,
  .sidebar.collapsed .sidebar-title,
  .sidebar.collapsed > .btn {
    display: none;
  }

  .sidebar.collapsed {
    padding: 0;
    background: transparent;
    box-shadow: none;
  }

  .sidebar {
    position: static;
    max-height: none;
  }

  .sidebar.collapsed .sidebar-toggle-btn {
    margin-bottom: 0;
  }
  
  /* Main grid —Å—Ç–∞—î –æ–¥–Ω–æ–∫–æ–ª–æ–Ω–∫–æ–≤–∏–º */
  .main-grid {
    grid-template-columns: 1fr;
  }
}

@media (max-width: 768px) {
  /* –ù–∞ –º–æ–±—ñ–ª—å–Ω–∏—Ö dropdown –Ω–∞ –≤—Å—é —à–∏—Ä–∏–Ω—É */
  .filters-dropdown {
    right: auto;
    left: 0;
    width: calc(100vw - 4rem);
    max-width: none;
  }
  
  .content-actions {
    position: relative;
    width: 100%;
  }
  
  /* –ö–Ω–æ–ø–∫–∏ –Ω–∞ –ø–æ–≤–Ω—É —à–∏—Ä–∏–Ω—É */
  .content-actions > .btn,
  .filters-toggle-btn {
    flex: 1;
  }
}

@media (max-width: 768px) {
  body {
    padding: 1rem;
  }

  .header {
    padding: 1rem;
    margin-bottom: 1rem;
  }
  
  .header-top {
    flex-direction: column;
    align-items: stretch;
  }
  
  .header-title {
    font-size: 1.25rem;
  }
  
  .header-main-actions {
    width: 100%;
  }
  
  .header-main-actions .btn {
    flex: 1;
  }
  
  .header-bottom {
    grid-template-columns: 1fr;
    gap: 0.75rem;
  }
  
  .header-progress {
    flex-direction: column;
    align-items: stretch;
    gap: 0.5rem;
  }
  
  .progress-bar-container {
    width: 100%;
  }
  
  .progress-bar-text {
    text-align: center;
  }
  
  .header-menu-dropdown {
    right: auto;
    left: 0;
    width: calc(100vw - 4rem);
    max-width: none;
  }
  .main-grid {
    gap: 1rem;
  }

  .form-row {
    grid-template-columns: 1fr;
  }

  .sidebar {
    position: static;
    max-height: none;
  }

  .toast {
    min-width: unset;
    width: calc(100vw - 2rem);
  }

  /* Modal –Ω–∞ –º–æ–±—ñ–ª—å–Ω–∏—Ö */
  .modal {
    max-width: calc(100vw - 2rem);
    border-radius: 12px;
  }

  .modal-header {
    padding: 1.25rem;
  }

  .modal-title {
    font-size: 1.25rem;
  }

  .modal-title-icon {
    width: 2.25rem;
    height: 2.25rem;
    font-size: 1rem;
  }

  .modal-body {
    padding: 1.25rem;
  }

  .modal-footer {
    padding: 1rem 1.25rem;
    flex-direction: column-reverse;
  }

  .modal-footer .btn {
    width: 100%;
  }

  .content-actions .btn {
    padding: 0.5rem;
  }
  .content, .sidebar {
    padding: 1rem;
  }

}

@media (max-width: 500px) {

  .content-title {
    font-size: 18px;
  }
}

@media (max-width: 500px) {
  /* –•–æ–≤–∞—î–º–æ –≤—Å—ñ –∫–Ω–æ–ø–∫–∏ –∫—Ä—ñ–º –º–µ–Ω—é */
  .field-controls > .btn:not(.field-controls-menu-btn) {
    display: none !important;
  }
}
</style>
</head>
<body>
<div class="container">
  <!-- Header -->
  <header class="header">
    <!-- Top Row: Title + Main Actions -->
    <div class="header-top">
      <div class="header-title">
        <div class="header-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 513 449" aria-label="Love Dossier Logo" role="img">
            <defs>
              <linearGradient id="logoGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" stop-color="#6366f1" />
                <stop offset="100%" stop-color="#8b5cf6" />
              </linearGradient>
            </defs>
            <path fill="url(#logoGradient)" d="m256 75.9l-15-20.8c-25-34.6-65.1-55.1-107.9-55.1-73.5 0-133.1 59.6-133.1 133.1v2.6c0 23.6 6.2 48 16.6 72.3h106c3.2 0 6.1-1.9 7.4-4.9l31.8-76.3c3.7-8.8 12.3-14.6 21.8-14.8 9.5-0.2 18.3 5.4 22.2 14.1l51.3 113.9 41.4-82.8c4.1-8.1 12.4-13.3 21.5-13.3 9.1 0 17.4 5.1 21.5 13.3l23.2 46.3c1.4 2.7 4.1 4.4 7.2 4.4h123.6c10.5-24.3 16.6-48.7 16.6-72.3v-2.6c-0.1-73.4-59.7-133-133.2-133-42.7 0-82.9 20.5-107.9 55.1l-15 20.7zm213.6 180.1h-97.8c-21.2 0-40.6-12-50.1-31l-1.7-3.4-42.5 85.1c-4.1 8.3-12.7 13.5-22 13.3-9.3-0.2-17.6-5.7-21.4-14.1l-49.3-109.5-10.5 25.2c-8.7 20.9-29.1 34.5-51.7 34.5h-80.2c47.2 73.8 123 141.7 170.4 177.9 12.4 9.4 27.6 14.1 43.1 14.1 15.5 0 30.8-4.6 43.1-14.1 47.6-36.3 123.4-104.2 170.6-178z" />
          </svg>
        </div>
        <span data-i18n="app.title">–î–æ—Å—å—î –∫–æ—Ö–∞–Ω–æ—ó –ª—é–¥–∏–Ω–∏</span>
      </div>
      
      <div class="header-main-actions">
        <!-- Language Switcher -->
        <div class="custom-select language-select" id="languageSelector">
          <div class="custom-select-trigger language-trigger" id="languageTrigger" data-i18n-title="tooltips.changeLanguage">
            <span class="language-flag" id="currentLanguage">
              <svg viewBox="0 0 800 600" xmlns="http://www.w3.org/2000/svg">
                <rect width="800" height="600" fill="#0057B7" rx="50"/>
                <rect y="300" width="800" height="300" fill="#FFD700"/>
              </svg>
            </span>
          </div>
          <div class="custom-select-dropdown language-dropdown" id="languageDropdown">
            <div class="custom-select-option language-option" data-lang="uk" data-flag="uk">
              <span class="language-flag">
                <svg viewBox="0 0 800 600" xmlns="http://www.w3.org/2000/svg">
                  <rect width="800" height="600" fill="#0057B7" rx="50"/>
                  <rect y="300" width="800" height="300" fill="#FFD700"/>
                </svg>
              </span>
              <span class="language-name">–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞</span>
              <i class="fas fa-check language-check" style="visibility: visible;"></i>
            </div>
            <div class="custom-select-option language-option" data-lang="en" data-flag="en">
              <span class="language-flag">
                <svg viewBox="0 0 800 600" xmlns="http://www.w3.org/2000/svg">
                  <rect width="800" height="600" fill="#f0f0f0" rx="50"/>
                  <g fill="#B22234">
                    <rect width="800" height="46.15"/>
                    <rect y="92.31" width="800" height="46.15"/>
                    <rect y="184.62" width="800" height="46.15"/>
                    <rect y="276.92" width="800" height="46.15"/>
                    <rect y="369.23" width="800" height="46.15"/>
                    <rect y="461.54" width="800" height="46.15"/>
                    <rect y="553.85" width="800" height="46.15"/>
                  </g>
                  <rect width="342.86" height="323.08" fill="#3C3B6E"/>
                  <g fill="#fff">
                    <circle cx="57.14" cy="40" r="15"/>
                    <circle cx="128.57" cy="40" r="15"/>
                    <circle cx="200" cy="40" r="15"/>
                    <circle cx="271.43" cy="40" r="15"/>
                    <circle cx="92.86" cy="100" r="15"/>
                    <circle cx="164.29" cy="100" r="15"/>
                    <circle cx="235.71" cy="100" r="15"/>
                    <circle cx="57.14" cy="160" r="15"/>
                    <circle cx="128.57" cy="160" r="15"/>
                    <circle cx="200" cy="160" r="15"/>
                    <circle cx="271.43" cy="160" r="15"/>
                    <circle cx="92.86" cy="220" r="15"/>
                    <circle cx="164.29" cy="220" r="15"/>
                    <circle cx="235.71" cy="220" r="15"/>
                    <circle cx="57.14" cy="280" r="15"/>
                    <circle cx="128.57" cy="280" r="15"/>
                    <circle cx="200" cy="280" r="15"/>
                    <circle cx="271.43" cy="280" r="15"/>
                  </g>
                </svg>
              </span>
              <span class="language-name">English</span>
              <i class="fas fa-check language-check" style="visibility: hidden;"></i>
            </div>
            <div class="custom-select-option language-option" data-lang="ru" data-flag="ru">
              <span class="language-flag">
                <svg viewBox="0 0 800 600" xmlns="http://www.w3.org/2000/svg">
                  <rect width="800" height="600" fill="#f0f0f0" rx="50"/>
                  <rect y="200" width="800" height="200" fill="#0039A6"/>
                  <rect y="400" width="800" height="200" fill="#D52B1E"/>
                </svg>
              </span>
              <span class="language-name">–†—É—Å—Å–∫–∏–π</span>
              <i class="fas fa-check language-check" style="visibility: hidden;"></i>
            </div>
            <div class="custom-select-option language-option" data-lang="pl" data-flag="pl">
              <span class="language-flag">
                <svg viewBox="0 0 800 600" xmlns="http://www.w3.org/2000/svg">
                  <rect width="800" height="600" fill="#f0f0f0" rx="50"/>
                  <rect y="300" width="800" height="300" fill="#DC143C"/>
                </svg>
              </span>
              <span class="language-name">Polski</span>
              <i class="fas fa-check language-check" style="visibility: hidden;"></i>
            </div>
          </div>
        </div>
        
        <div class="sync-status local" id="syncStatus" data-i18n-title="ui.storageMode">
          <i class="fas fa-laptop"></i>
          <span data-i18n="ui.localMode">Local —Ä–µ–∂–∏–º</span>
        </div>
        
        <button class="btn btn-secondary btn-sm" id="btnSave">
          <i class="fas fa-save"></i>
          <span data-i18n="ui.save">–ó–±–µ—Ä–µ–≥—Ç–∏</span>
        </button>
        
        <button class="btn btn-primary btn-sm" id="btnAddField">
          <i class="fas fa-plus"></i>
          <span data-i18n="ui.addField">–î–æ–¥–∞—Ç–∏ –ø–æ–ª–µ</span>
        </button>
        
        <button class="header-menu-btn" data-action="App.toggleHeaderMenu" id="headerMenuBtn">
          <i class="fas fa-ellipsis-h"></i>
          <span data-i18n="ui.more">–ë—ñ–ª—å—à–µ</span>
        </button>
        
        <div class="header-menu-dropdown" id="headerMenuDropdown">
          <button class="btn" id="btnSync">
            <i class="fas fa-sync-alt"></i> <span data-i18n="ui.sync">–°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è</span>
          </button>
          <button class="btn" id="btnExport">
            <i class="fas fa-download"></i> <span data-i18n="ui.export">–ï–∫—Å–ø–æ—Ä—Ç</span>
          </button>
          <button class="btn" id="btnImport">
            <i class="fas fa-upload"></i> <span data-i18n="ui.import">–Ü–º–ø–æ—Ä—Ç</span>
          </button>
          <button class="btn danger" id="btnClear">
            <i class="fas fa-trash-alt"></i> <span data-i18n="ui.clear">–û—á–∏—Å—Ç–∏—Ç–∏</span>
          </button>
        </div>
      </div>
    </div>
    
    <!-- Bottom Row: Search + Progress -->
    <div class="header-bottom">
      <div class="header-search" id="headerSearch">
        <div class="search-input-container">
          <input 
            type="text" 
            class="search-input" 
            id="searchInput" 
            data-i18n-placeholder="ui.searchPlaceholder"
            placeholder="–ü–æ—à—É–∫ –ø–æ –≤—Å—ñ—Ö –ø–æ–ª—è—Ö..."
            autocomplete="off"
          />
          <i class="fas fa-search search-icon"></i>
          <button class="search-clear-btn" id="searchClearBtn" data-i18n-title="ui.clearSearch">
            <i class="fas fa-times"></i>
          </button>
        </div>
      </div>
      
      <div class="header-progress" id="headerProgress">
        <div class="progress-bar-container" data-i18n-title="ui.fillProgress">
          <div class="progress-bar-fill" id="progressBarFill" style="width: 0%"></div>
        </div>
        <div class="progress-bar-text" id="progressBarText" data-i18n="ui.selectCategory">–û–±–µ—Ä—ñ—Ç—å –∫–∞—Ç–µ–≥–æ—Ä—ñ—é</div>
      </div>
    </div>
    
    <input type="file" id="fileInput" accept=".json" class="hidden">
  </header>

  <!-- Main Grid -->
  <div class="main-grid">
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
      <button class="sidebar-toggle-btn" id="sidebarToggle">
        <i class="fas fa-layer-group sidebar-toggle-icon"></i>
        <span data-i18n="ui.categories">–ö–∞—Ç–µ–≥–æ—Ä—ñ—ó</span>
        <i class="fas fa-chevron-down sidebar-toggle-arrow"></i>
      </button>
      <div class="sidebar-title" data-i18n="ui.categories">–ö–∞—Ç–µ–≥–æ—Ä—ñ—ó</div>
      <nav class="category-nav" id="categoryNav">
        <!-- Categories will be rendered here -->
      </nav>
      <button class="btn btn-add-category" id="btnAddCategory">
        <i class="fas fa-folder-plus"></i>
        <span data-i18n="ui.addCategory">–î–æ–¥–∞—Ç–∏ –∫–∞—Ç–µ–≥–æ—Ä—ñ—é</span>
      </button>
    </aside>

    <!-- Content -->
    <main class="content">
      <div class="content-header">
        <div class="content-title" id="contentTitle">
          <i class="fas fa-folder"></i>
          <span data-i18n="ui.selectCategory">–û–±–µ—Ä—ñ—Ç—å –∫–∞—Ç–µ–≥–æ—Ä—ñ—é</span>
        </div>
        <div class="content-actions" id="contentActions">
          <!-- Dynamic actions will appear here -->
        </div>
      </div>
      <div id="contentBody">
        <div class="empty-state">
          <div class="empty-state-icon">
            <span data-i18n="ui.selectCategory">–û–±–µ—Ä—ñ—Ç—å –∫–∞—Ç–µ–≥–æ—Ä—ñ—é –∑–ª—ñ–≤–∞</span>
          </div>
          <div class="empty-state-text" data-i18n="ui.selectCategoryLeft">–û–±–µ—Ä—ñ—Ç—å –∫–∞—Ç–µ–≥–æ—Ä—ñ—é –∑–ª—ñ–≤–∞</div>
          <p data-i18n="ui.clickCategory">–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä—ñ—é, —â–æ–± –ø–æ–±–∞—á–∏—Ç–∏ –ø–æ–ª—è</p>
        </div>
      </div>
    </main>
  </div>
</div>

<!-- Modal -->
<div class="modal-backdrop" id="modalBackdrop">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-title">
        <i class="fas fa-edit modal-title-icon" id="modalTitleIcon"></i>
        <span id="modalTitle" data-i18n="ui.modal">–ú–æ–¥–∞–ª–∫–∞</span>
      </div>
      <button class="btn btn-icon btn-secondary btn-sm modal-close-btn" id="modalClose" data-i18n-title="ui.close">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="modal-body" id="modalBody">
      <!-- Dynamic content -->
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" id="modalCancel">
        <i class="fas fa-times"></i>
        <span data-i18n="ui.cancel">–°–∫–∞—Å—É–≤–∞—Ç–∏</span>
      </button>
      <button class="btn btn-primary" id="modalSave">
        <i class="fas fa-check"></i>
        <span data-i18n="ui.save">–ó–±–µ—Ä–µ–≥—Ç–∏</span>
      </button>
    </div>
  </div>
</div>

<!-- Toast Container -->
<div class="toast-container" id="toastContainer"></div>

<!-- Format Menu -->
<div class="format-menu" id="formatMenu">
  <button class="format-menu-btn" data-format="bold" data-i18n-title="format.bold">
    <i class="fas fa-bold"></i>
  </button>
  <button class="format-menu-btn" data-format="italic" data-i18n-title="format.italic">
    <i class="fas fa-italic"></i>
  </button>
  <button class="format-menu-btn" data-format="strikethrough" data-i18n-title="format.strikethrough">
    <i class="fas fa-strikethrough"></i>
  </button>
  <button class="format-menu-btn" data-format="link" data-i18n-title="format.link">
    <i class="fas fa-link"></i>
  </button>
  <button class="format-menu-btn" data-format="chip" data-i18n-title="format.chip">
    <i class="fas fa-tag"></i>
  </button>
</div>

<script>
(function() {
  'use strict';
  // ============= CONSTANTS =============
  const DELAYS = {
    MODAL_INIT: 100,        // –ß–∞—Å –Ω–∞ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—é DOM –ø–µ—Ä–µ–¥ –¥–æ–¥–∞–≤–∞–Ω–Ω—è–º listeners
    TOAST_SHOW: 10,         // –ó–∞—Ç—Ä–∏–º–∫–∞ –¥–ª—è trigger CSS transition
    TOAST_REMOVE: 300,      // –ß–∞—Å –∞–Ω—ñ–º–∞—Ü—ñ—ó –∑–Ω–∏–∫–Ω–µ–Ω–Ω—è toast
    SELECTION_DETECT: 10,   // –ß–∞—Å –¥–ª—è –¥–µ—Ç–µ–∫—Ü—ñ—ó –≤–∏–¥—ñ–ª–µ–Ω–Ω—è —Ç–µ–∫—Å—Ç—É –Ω–∞ –º–æ–±—ñ–ª—å–Ω–∏—Ö
    DROPDOWN_CLOSE: 0,      // –ó–∞—Ç—Ä–∏–º–∫–∞ –¥–ª—è —É–Ω–∏–∫–Ω–µ–Ω–Ω—è immediate trigger
    DROPDOWN_ANIMATION: 200, // –ß–∞—Å –∞–Ω—ñ–º–∞—Ü—ñ—ó –∑–∞–∫—Ä–∏—Ç—Ç—è dropdown
    THROTTLE_SCROLL: 16     // ~60fps –¥–ª—è throttling scroll/resize
  };

  // ============= STATE =============
  const State = {
    config: {
      categories: [],
      fields: []
    },
    values: {},
    ui: {
      activeCategory: null,
      lastActiveCategory: null,
      searchActive: false,
      fillFilter: 'all',
      importanceFilters: [], // –º–∞—Å–∏–≤ –∑ 'high', 'medium', 'low'
      modalData: null
    },
    sync: {
      mode: 'localStorage', // 'localStorage' | 'googleSheets' | 'manual'
      googleSheets: {
        enabled: false,
        clientId: '',
        spreadsheetId: '',
        lastSync: null,
        autoSyncEnabled: false,
        autoSyncInterval: 5, // —Ö–≤–∏–ª–∏–Ω–∏
        encryptionEnabled: false,
        encryptionPasswordHash: null // –¥–ª—è –≤–µ—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—ó
      },
      status: 'local', // 'local' | 'synced' | 'syncing' | 'error' | 'offline'
      statusText: '',
      lastError: null
    },
    language: localStorage.getItem('app_language') || 'uk'
  };

  // ============= TRANSLATIONS =============
  const TRANSLATIONS = {
    uk: {
      app: {
        title: '–î–æ—Å—å—î –∫–æ—Ö–∞–Ω–æ—ó –ª—é–¥–∏–Ω–∏',
        filePrefix: 'dosie',
        spreadsheetTitle: '–î–æ—Å—å—î'
      },
      ui: {
        localMode: 'Local —Ä–µ–∂–∏–º',
        save: '–ó–±–µ—Ä–µ–≥—Ç–∏',
        addField: '–î–æ–¥–∞—Ç–∏ –ø–æ–ª–µ',
        more: '–ë—ñ–ª—å—à–µ',
        sync: '–°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è',
        export: '–ï–∫—Å–ø–æ—Ä—Ç',
        import: '–Ü–º–ø–æ—Ä—Ç',
        clear: '–û—á–∏—Å—Ç–∏—Ç–∏',
        searchPlaceholder: '–ü–æ—à—É–∫ –ø–æ –≤—Å—ñ—Ö –ø–æ–ª—è—Ö...',
        clearSearch: '–û—á–∏—Å—Ç–∏—Ç–∏ –ø–æ—à—É–∫',
        fillProgress: '–ü—Ä–æ–≥—Ä–µ—Å –∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è',
        selectCategory: '–û–±–µ—Ä—ñ—Ç—å –∫–∞—Ç–µ–≥–æ—Ä—ñ—é',
        categories: '–ö–∞—Ç–µ–≥–æ—Ä—ñ—ó',
        addCategory: '–î–æ–¥–∞—Ç–∏ –∫–∞—Ç–µ–≥–æ—Ä—ñ—é',
        selectCategoryLeft: '–û–±–µ—Ä—ñ—Ç—å –∫–∞—Ç–µ–≥–æ—Ä—ñ—é –∑–ª—ñ–≤–∞',
        clickCategory: '–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä—ñ—é, —â–æ–± –ø–æ–±–∞—á–∏—Ç–∏ –ø–æ–ª—è',
        modal: '–ú–æ–¥–∞–ª–∫–∞',
        close: '–ó–∞–∫—Ä–∏—Ç–∏',
        cancel: '–°–∫–∞—Å—É–≤–∞—Ç–∏',
        storageMode: '–†–µ–∂–∏–º –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è',
        filled: '–ó–∞–ø–æ–≤–Ω–µ–Ω–æ',
        empty: '–ü–æ—Ä–æ–∂–Ω—å–æ',
        all: '–í—Å—ñ',
        high: '–í–∏—Å–æ–∫–∏–π',
        medium: '–°–µ—Ä–µ–¥–Ω—ñ–π',
        low: '–ù–∏–∑—å–∫–∏–π',
        filters: '–§—ñ–ª—å—Ç—Ä–∏',
        importance: '–í–∞–∂–ª–∏–≤—ñ—Å—Ç—å',
        edit: '–†–µ–¥–∞–≥—É–≤–∞—Ç–∏',
        delete: '–í–∏–¥–∞–ª–∏—Ç–∏',
        addSubcategory: '–î–æ–¥–∞—Ç–∏ –ø—ñ–¥–∫–∞—Ç–µ–≥–æ—Ä—ñ—é',
        emptyValue: '–ù–µ –∑–∞–ø–æ–≤–Ω–µ–Ω–æ',
        searchResults: '—Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤',
        searchResultsTitle: '–†–µ–∑—É–ª—å—Ç–∞—Ç–∏ –ø–æ—à—É–∫—É',
        noResults: '–ù—ñ—á–æ–≥–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ',
        changeSearchQuery: '–°–ø—Ä–æ–±—É–π—Ç–µ –∑–º—ñ–Ω–∏—Ç–∏ –ø–æ—à—É–∫–æ–≤–∏–π –∑–∞–ø–∏—Ç',
        changeFilters: '–°–ø—Ä–æ–±—É–π—Ç–µ –∑–º—ñ–Ω–∏—Ç–∏ —Ñ—ñ–ª—å—Ç—Ä–∏',
        privateBadge: 'üîí –ü—Ä–∏–≤–∞—Ç–Ω–∞',
        of: '–∑',
        fields: '–ø–æ–ª—ñ–≤',
        filledProgress: '–ó–∞–ø–æ–≤–Ω–µ–Ω–æ',
        inCategory: '—É –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó',
        manageCategories: '–ö–µ—Ä—É–≤–∞—Ç–∏ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è–º–∏',
        values: '–ó–Ω–∞—á–µ–Ω–Ω—è'
      },
      format: {
        bold: '–ñ–∏—Ä–Ω–∏–π (Ctrl+B)',
        italic: '–ö—É—Ä—Å–∏–≤ (Ctrl+I)',
        strikethrough: '–ó–∞–∫—Ä–µ—Å–ª–µ–Ω–∏–π',
        link: '–ü–æ—Å–∏–ª–∞–Ω–Ω—è (Ctrl+K)',
        chip: '–¢–µ–≥'
      },
      categories: {
        base: '–ë–∞–∑–æ–≤–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è',
        character: '–•–∞—Ä–∞–∫—Ç–µ—Ä',
        preferences: '–í–ø–æ–¥–æ–±–∞–Ω–Ω—è',
        antipreferences: '–ê–Ω—Ç–∏–≤–ø–æ–¥–æ–±–∞–Ω–Ω—è',
        gifts: '–ü–æ–¥–∞—Ä—É–Ω–∫–∏',
        psychology: '–ü—Å–∏—Ö–æ–ª–æ–≥—ñ—è',
        psych: '–ü—Å–∏—Ö–æ–ª–æ–≥—ñ—á–Ω—ñ –æ—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ',
        logistics: '–õ–æ–≥—ñ—Å—Ç–∏–∫–∞ —Ç–∞ –ø–æ–±—É—Ç',
        goals: '–¶—ñ–ª—ñ —Ç–∞ –º—Ä—ñ—ó',
        custom: '–î–æ–¥–∞—Ç–∫–æ–≤–µ',
        communication: '–ö–æ–º—É–Ω—ñ–∫–∞—Ü—ñ—è',
        finance: '–§—ñ–Ω–∞–Ω—Å–∏',
        intimacy: '–Ü–Ω—Ç–∏–º–Ω—ñ—Å—Ç—å',
        family: '–°—ñ–º\'—è',
        career: '–ö–∞—Ä\'—î—Ä–∞',
        culture: '–ö—É–ª—å—Ç—É—Ä–∞'
      },
      fields: {
        fullName: '–ü–Ü–ë',
        dob: '–î–∞—Ç–∞ –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è',
        character: '–û—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ —Ö–∞—Ä–∞–∫—Ç–µ—Ä—É',
        dreams: '–ú—Ä—ñ—ó —Ç–∞ –±–∞–∂–∞–Ω–Ω—è',
        likes: '–©–æ –ª—é–±–∏—Ç—å',
        memories: '–ü–∞–º\'—è—Ç—å —ñ —Å–ø–æ–≥–∞–¥–∏',
        dislikes: '–©–æ –Ω–µ –ª—é–±–∏—Ç—å',
        anti_triggers: '–¢—Ä–∏–≥–µ—Ä–∏ —Ç–∞ —Ä–æ–∑–¥—Ä–∞—Ç—É–≤–∞–Ω–Ω—è',
        anti_topics: '–ù–µ–ø—Ä–∏—î–º–Ω—ñ —Ç–µ–º–∏ –¥–ª—è —Ä–æ–∑–º–æ–≤',
        anti_places: '–ú—ñ—Å—Ü—è, —è–∫—ñ –Ω–µ –ø–æ–¥–æ–±–∞—é—Ç—å—Å—è',
        anti_sounds: '–ù–µ–ø—Ä–∏—î–º–Ω—ñ –∑–≤—É–∫–∏/–∑–∞–ø–∞—Ö–∏',
        anti_situations: '–ù–µ–∫–æ–º—Ñ–æ—Ä—Ç–Ω—ñ —Å–∏—Ç—É–∞—Ü—ñ—ó',
        gift_wishlist: '–°–ø–∏—Å–æ–∫ –±–∞–∂–∞–Ω—å',
        gift_sizes: '–†–æ–∑–º—ñ—Ä–∏',
        gift_brands: '–£–ª—é–±–ª–µ–Ω—ñ –±—Ä–µ–Ω–¥–∏',
        gift_anti: '–ê–Ω—Ç–∏–ø–æ–¥–∞—Ä—É–Ω–∫–∏',
        gift_history: '–Ü—Å—Ç–æ—Ä—ñ—è –ø–æ–¥–∞—Ä—É–Ω–∫—ñ–≤',
        love_language: '–ú–æ–≤–∞ –∫–æ—Ö–∞–Ω–Ω—è',
        values: '–û—Å–Ω–æ–≤–Ω—ñ —Ü—ñ–Ω–Ω–æ—Å—Ç—ñ',
        psy_conflict_style: '–°—Ç–∏–ª—å –ø–æ–≤–µ–¥—ñ–Ω–∫–∏ –≤ –∫–æ–Ω—Ñ–ª—ñ–∫—Ç–∞—Ö',
        psy_compliments: '–Ø–∫ –ª—é–±–∏—Ç—å –æ—Ç—Ä–∏–º—É–≤–∞—Ç–∏ –∫–æ–º–ø–ª—ñ–º–µ–Ω—Ç–∏',
        psy_stress_relief: '–°–ø–æ—Å–æ–±–∏ –∑–Ω—è—Ç—Ç—è —Å—Ç—Ä–µ—Å—É',
        log_places: '–£–ª—é–±–ª–µ–Ω—ñ –º—ñ—Å—Ü—è',
        log_social_circle: '–°–æ—Ü—ñ–∞–ª—å–Ω–µ –∫–æ–ª–æ',
        log_schedule_peak: '–ü—ñ–∫–æ–≤—ñ –≥–æ–¥–∏–Ω–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ',
        log_media: '–ú–µ–¥—ñ–∞ –≤–ø–æ–¥–æ–±–∞–Ω–Ω—è',
        short_goals: '–ö–æ—Ä–æ—Ç–∫–æ—Å—Ç—Ä–æ–∫–æ–≤—ñ —Ü—ñ–ª—ñ',
        goal_travel: '–ú—Ä—ñ—ó –ø—Ä–æ –ø–æ–¥–æ—Ä–æ–∂—ñ',
        goal_traditions: '–¢—Ä–∞–¥–∏—Ü—ñ—ó, —è–∫—ñ —Ö–æ—á–µ —Å—Ç–≤–æ—Ä–∏—Ç–∏',
        goal_cozy_ideal: '–Ü–¥–µ–∞–ª—å–Ω–∏–π –∑–∞—Ç–∏—à–Ω–∏–π –≤–µ—á—ñ—Ä',
        contact_phone: '–¢–µ–ª–µ—Ñ–æ–Ω',
        contact_email: 'Email',
        city: '–ú—ñ—Å—Ç–æ / –õ–æ–∫–∞—Ü—ñ—è',
        anniversary: '–†—ñ—á–Ω–∏—Ü—è / –í–∞–∂–ª–∏–≤–∞ –¥–∞—Ç–∞',
        attachment_style: '–°—Ç–∏–ª—å –ø—Ä–∏—Ö–∏–ª—å–Ω–æ—Å—Ç—ñ',
        humor_style: '–ü–æ—á—É—Ç—Ç—è –≥—É–º–æ—Ä—É',
        personal_boundaries: '–û—Å–æ–±–∏—Å—Ç—ñ –∫–æ—Ä–¥–æ–Ω–∏',
        cuisines_fav: '–£–ª—é–±–ª–µ–Ω—ñ –∫—É—Ö–Ω—ñ',
        allergies: '–ê–ª–µ—Ä–≥—ñ—ó / –ß—É—Ç–ª–∏–≤–æ—Å—Ç—ñ',
        aesthetics: '–ï—Å—Ç–µ—Ç–∏–∫–∏ / –°—Ç–∏–ª—ñ',
        fav_colors: '–£–ª—é–±–ª–µ–Ω—ñ –∫–æ–ª—å–æ—Ä–∏',
        anti_allergies: '–ó–∞–±–æ—Ä–æ–Ω–µ–Ω—ñ —á–µ—Ä–µ–∑ –∞–ª–µ—Ä–≥—ñ—ó',
        anti_people_types: '–¢–∏–ø–∏ –ª—é–¥–µ–π, –∑ —è–∫–∏–º–∏ –≤–∞–∂–∫–æ',
        gift_price_range: '–ö–æ–º—Ñ–æ—Ä—Ç–Ω–∏–π –±—é–¥–∂–µ—Ç –ø–æ–¥–∞—Ä—É–Ω–∫—ñ–≤',
        gift_stores: '–£–ª—é–±–ª–µ–Ω—ñ –º–∞–≥–∞–∑–∏–Ω–∏ / –ø–ª–∞—Ç—Ñ–æ—Ä–º–∏',
        psy_anxiety_triggers: '–¢—Ä–∏–≥–µ—Ä–∏ —Ç—Ä–∏–≤–æ–≥–∏',
        psy_motivators: '–©–æ –º–æ—Ç–∏–≤—É—î',
        psy_calming_words: '–°–ª–æ–≤–∞/—Ñ—Ä–∞–∑–∏ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏',
        log_transport: '–ó–≤–∏—á–Ω–∏–π —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç',
        log_work_hours: '–ì–æ–¥–∏–Ω–∏ —Ä–æ–±–æ—Ç–∏/–Ω–∞–≤—á–∞–Ω–Ω—è',
        log_routines: '–©–æ–¥–µ–Ω–Ω—ñ —Ä—É—Ç–∏–Ω–∏',
        log_food_schedule: '–•–∞—Ä—á–æ–≤–∏–π —Ä–µ–∂–∏–º',
        long_goals: '–î–æ–≤–≥–æ—Å—Ç—Ä–æ–∫–æ–≤—ñ —Ü—ñ–ª—ñ',
        learning_topics: '–©–æ —Ö–æ—á–µ –≤–∏–≤—á–∏—Ç–∏',
        bucket_list: 'Bucket list',
        notes_private: '–û—Å–æ–±–∏—Å—Ç—ñ –Ω–æ—Ç–∞—Ç–∫–∏',
        comm_style: '–°—Ç–∏–ª—å —Å–ø—ñ–ª–∫—É–≤–∞–Ω–Ω—è',
        comm_frequency: '–ß–∞—Å—Ç–æ—Ç–∞ –±–∞–∂–∞–Ω–æ–≥–æ –∫–æ–Ω—Ç–∞–∫—Ç—É',
        comm_topics_good: '–ö–æ–º—Ñ–æ—Ä—Ç–Ω—ñ —Ç–µ–º–∏',
        comm_topics_bad: '–°–∫–ª–∞–¥–Ω—ñ —Ç–µ–º–∏',
        comm_love_language: '–ú–æ–≤–∞ –ª—é–±–æ–≤—ñ –≤ –∫–æ–º—É–Ω—ñ–∫–∞—Ü—ñ—ó',
        finance_habits: '–§—ñ–Ω–∞–Ω—Å–æ–≤—ñ –∑–≤–∏—á–∫–∏',
        finance_attitude: '–°—Ç–∞–≤–ª–µ–Ω–Ω—è –¥–æ –≥—Ä–æ—à–µ–π',
        finance_goals: '–°–ø—ñ–ª—å–Ω—ñ —Ñ—ñ–Ω–∞–Ω—Å–æ–≤—ñ —Ü—ñ–ª—ñ',
        finance_split: '–†–æ–∑–ø–æ–¥—ñ–ª –≤–∏—Ç—Ä–∞—Ç',
        intimacy_language: '–ú–æ–≤–∞ —ñ–Ω—Ç–∏–º–Ω–æ—Å—Ç—ñ',
        intimacy_boundaries: 'Boundaries —Ç–∞ –∫–æ–º—Ñ–æ—Ä—Ç',
        intimacy_gestures: '–†–æ–º–∞–Ω—Ç–∏—á–Ω—ñ –∂–µ—Å—Ç–∏',
        family_info: '–Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ —Ä–æ–¥–∏–Ω—É',
        family_important: '–í–∞–∂–ª–∏–≤—ñ –ª—é–¥–∏',
        family_traditions: '–°—ñ–º–µ–π–Ω—ñ —Ç—Ä–∞–¥–∏—Ü—ñ—ó',
        family_attitude: '–°—Ç–∞–≤–ª–µ–Ω–Ω—è –¥–æ —Ä–æ–¥–∏–Ω–∏',
        career_goals: '–ü—Ä–æ—Ñ–µ—Å—ñ–π–Ω—ñ —Ü—ñ–ª—ñ',
        career_schedule: '–†–æ–±–æ—á–∏–π –≥—Ä–∞—Ñ—ñ–∫',
        career_dreams: '–ö–∞—Ä\'—î—Ä–Ω—ñ –º—Ä—ñ—ó',
        career_balance: 'Work-life balance',
        culture_religion: '–†–µ–ª—ñ–≥—ñ–π–Ω—ñ –ø–æ–≥–ª—è–¥–∏',
        culture_politics: '–ü–æ–ª—ñ—Ç–∏—á–Ω—ñ –ø–µ—Ä–µ–∫–æ–Ω–∞–Ω–Ω—è',
        culture_traditions: '–ö—É–ª—å—Ç—É—Ä–Ω—ñ —Ç—Ä–∞–¥–∏—Ü—ñ—ó',
        culture_principles: '–ñ–∏—Ç—Ç—î–≤—ñ –ø—Ä–∏–Ω—Ü–∏–ø–∏'
      },
      nested: {
        food: '–á–∂–∞',
        activities: '–ó–∞–Ω—è—Ç—Ç—è',
        sweet: '–°–æ–ª–æ–¥–∫–µ',
        drinks: '–ù–∞–ø–æ—ó',
        active: '–ê–∫—Ç–∏–≤–Ω—ñ',
        calm: '–°–ø–æ–∫—ñ–π–Ω—ñ',
        tastes: '–°–º–∞–∫–∏',
        dishes: '–°—Ç—Ä–∞–≤–∏',
        social: '–°–æ—Ü—ñ–∞–ª—å–Ω—ñ',
        personal: '–û—Å–æ–±–∏—Å—Ç—ñ',
        behaviors: '–ü–æ–≤–µ–¥—ñ–Ω–∫–∞',
        communication: '–°–ø—ñ–ª–∫—É–≤–∞–Ω–Ω—è',
        habits: '–ó–≤–∏—á–∫–∏'
      },
      messages: {
        dataSaved: '–î–∞–Ω—ñ –∑–±–µ—Ä–µ–∂–µ–Ω–æ',
        exported: '–ï–∫—Å–ø–æ—Ä—Ç–æ–≤–∞–Ω–æ',
        imported: '–Ü–º–ø–æ—Ä—Ç–æ–≤–∞–Ω–æ',
        invalidFile: '–ù–µ–≤—ñ—Ä–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª—É',
        fileReadError: '–ü–æ–º–∏–ª–∫–∞ —á–∏—Ç–∞–Ω–Ω—è —Ñ–∞–π–ª—É',
        dataCleared: '–î–∞–Ω—ñ –æ—á–∏—â–µ–Ω–æ',
        confirmClear: '–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –æ—á–∏—Å—Ç–∏—Ç–∏ –≤—Å—ñ –¥–∞–Ω—ñ? –¶—è –¥—ñ—è –Ω–µ–∑–≤–æ—Ä–æ—Ç–Ω–∞!',
        fillAllFields: '–ó–∞–ø–æ–≤–Ω—ñ—Ç—å –≤—Å—ñ –ø–æ–ª—è',
        fieldExists: '–ü–æ–ª–µ –∑ —Ç–∞–∫–∏–º ID –≤–∂–µ —ñ—Å–Ω—É—î',
        fieldUpdated: '–ü–æ–ª–µ –æ–Ω–æ–≤–ª–µ–Ω–æ',
        fieldCreated: '–ü–æ–ª–µ —Å—Ç–≤–æ—Ä–µ–Ω–æ',
        categoryExists: '–ö–∞—Ç–µ–≥–æ—Ä—ñ—è –∑ —Ç–∞–∫–∏–º ID –≤–∂–µ —ñ—Å–Ω—É—î',
        categoryUpdated: '–ö–∞—Ç–µ–≥–æ—Ä—ñ—é –æ–Ω–æ–≤–ª–µ–Ω–æ',
        categoryCreated: '–ö–∞—Ç–µ–≥–æ—Ä—ñ—é —Å—Ç–≤–æ—Ä–µ–Ω–æ',
        valueUpdated: '–ó–Ω–∞—á–µ–Ω–Ω—è –æ–Ω–æ–≤–ª–µ–Ω–æ',
        fieldDeleted: '–ü–æ–ª–µ –≤–∏–¥–∞–ª–µ–Ω–æ',
        confirmDeleteField: '–í–∏–¥–∞–ª–∏—Ç–∏ —Ü–µ –ø–æ–ª–µ?',
        syncError: '–ü–æ–º–∏–ª–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó',
        syncComplete: '–°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞',
        syncInitError: '–ü–æ–º–∏–ª–∫–∞ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó',
        needAuth: '–ü–æ—Ç—Ä—ñ–±–Ω–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è –≤ Google',
        enterUrl: '–í–≤–µ–¥—ñ—Ç—å URL:',
        connectionRestored: '–ó\'—î–¥–Ω–∞–Ω–Ω—è –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–æ',
        offlineMode: '–û—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º',
        localSave: '–î–∞–Ω—ñ –∑–±–µ—Ä–µ–∂–µ–Ω–æ –ª–æ–∫–∞–ª—å–Ω–æ',
        showFilled: '–ü–æ–∫–∞–∑–∞–Ω–æ: –∑–∞–ø–æ–≤–Ω–µ–Ω—ñ –ø–æ–ª—è',
        showEmpty: '–ü–æ–∫–∞–∑–∞–Ω–æ: –ø–æ—Ä–æ–∂–Ω—ñ –ø–æ–ª—è',
        showAll: '–ü–æ–∫–∞–∑–∞–Ω–æ: –≤—Å—ñ –ø–æ–ª—è',
        allImportance: '–ü–æ–∫–∞–∑–∞–Ω–æ –ø–æ–ª—è –≤—Å—ñ—Ö —Ä—ñ–≤–Ω—ñ–≤ –≤–∞–∂–ª–∏–≤–æ—Å—Ç—ñ',
        syncing: '–°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è...',
        noFieldsWithFilters: '–ù–µ–º–∞—î –ø–æ–ª—ñ–≤ –∑–∞ –æ–±—Ä–∞–Ω–∏–º–∏ —Ñ—ñ–ª—å—Ç—Ä–∞–º–∏',
        noFilledFields: '–ù–µ–º–∞—î –∑–∞–ø–æ–≤–Ω–µ–Ω–∏—Ö –ø–æ–ª—ñ–≤ –∑–∞ –æ–±—Ä–∞–Ω–∏–º–∏ —Ñ—ñ–ª—å—Ç—Ä–∞–º–∏',
        noEmptyFields: '–ù–µ–º–∞—î –ø–æ—Ä–æ–∂–Ω—ñ—Ö –ø–æ–ª—ñ–≤ –∑–∞ –æ–±—Ä–∞–Ω–∏–º–∏ —Ñ—ñ–ª—å—Ç—Ä–∞–º–∏',
        noFieldsWithImportance: '–ù–µ–º–∞—î –ø–æ–ª—ñ–≤ –∑ –æ–±—Ä–∞–Ω–∏–º–∏ —Ä—ñ–≤–Ω—è–º–∏ –≤–∞–∂–ª–∏–≤–æ—Å—Ç—ñ',
        enterClientId: '–í–≤–µ–¥—ñ—Ç—å Client ID',
        passwordMinLength: '–ü–∞—Ä–æ–ª—å –ø–æ–≤–∏–Ω–µ–Ω –º—ñ—Å—Ç–∏—Ç–∏ –º—ñ–Ω—ñ–º—É–º 6 —Å–∏–º–≤–æ–ª—ñ–≤',
        passwordsNotMatch: '–ü–∞—Ä–æ–ª—ñ –Ω–µ —Å–ø—ñ–≤–ø–∞–¥–∞—é—Ç—å',
        settingsSaved: '–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∑–±–µ—Ä–µ–∂–µ–Ω–æ',
        passwordNotStored: '–ü–∞—Ä–æ–ª—å –Ω–µ –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è!',
        writeItDown: '–ó–∞–ø–∏—à—ñ—Ç—å –π–æ–≥–æ –≤ –±–µ–∑–ø–µ—á–Ω–æ–º—É –º—ñ—Å—Ü—ñ.',
        noNestedCategories: '–ù–µ–º–∞—î –≤–∫–ª–∞–¥–µ–Ω–∏—Ö –∫–∞—Ç–µ–≥–æ—Ä—ñ–π',
        errorNotAuthorized: '–ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–æ',
        errorSpreadsheetIdNotSet: 'Spreadsheet ID –Ω–µ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ',
        errorDataNotFound: '–î–∞–Ω—ñ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ',
        errorDataEncrypted: '–î–∞–Ω—ñ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–æ. –í–≤–µ–¥—ñ—Ç—å –ø–∞—Ä–æ–ª—å –¥–ª—è —Ä–æ–∑—à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è.',
        errorNotAuthorizedGoogle: '–ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–æ –≤ Google',
        errorGoogleApiNotLoaded: 'Google API –Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ',
        errorGoogleIdentityNotLoaded: 'Google Identity Services –Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ',
        errorTokenClientNotInitialized: 'Token client –Ω–µ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ'
      },
      modal: {
        confirmAction: '–ü—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è',
        editField: '–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –ø–æ–ª–µ',
        newField: '–ù–æ–≤–µ –ø–æ–ª–µ',
        editCategory: '–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –∫–∞—Ç–µ–≥–æ—Ä—ñ—é',
        newCategory: '–ù–æ–≤–∞ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è',
        editValue: '–†–µ–¥–∞–≥—É–≤–∞—Ç–∏',
        syncSettings: '–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó',
        fieldId: 'ID –ø–æ–ª—è',
        fieldName: '–ù–∞–∑–≤–∞ –ø–æ–ª—è',
        type: '–¢–∏–ø',
        importance: '–í–∞–∂–ª–∏–≤—ñ—Å—Ç—å',
        category: '–ö–∞—Ç–µ–≥–æ—Ä—ñ—è',
        required: '–û–±–æ–≤\'—è–∑–∫–æ–≤–µ –ø–æ–ª–µ',
        categoryId: 'ID –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó',
        categoryName: '–ù–∞–∑–≤–∞ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó',
        icon: '–Ü–∫–æ–Ω–∫–∞ (Font Awesome)',
        customCategoryNote: '–ó–º—ñ–Ω—é—é—á–∏ –Ω–∞–∑–≤—É –∫–∞—Å—Ç–æ–º–Ω–æ—ó –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó, –≤–∏ –∑–º—ñ–Ω—é—î—Ç–µ —ó—ó –¥–ª—è –≤—Å—ñ—Ö –º–æ–≤',
        password: '–ü–∞—Ä–æ–ª—å',
        confirmPassword: '–ü—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è',
        enterPassword: '–í–≤–µ–¥—ñ—Ç—å –ø–∞—Ä–æ–ª—å',
        confirmPasswordPlaceholder: '–ü—ñ–¥—Ç–≤–µ—Ä–¥—ñ—Ç—å –ø–∞—Ä–æ–ª—å'
      },
      types: {
        text: '–¢–µ–∫—Å—Ç',
        textarea: '–¢–µ–∫—Å—Ç–æ–≤–∞ –æ–±–ª–∞—Å—Ç—å',
        date: '–î–∞—Ç–∞',
        tags: '–¢–µ–≥–∏',
        nested: '–í–∫–ª–∞–¥–µ–Ω—ñ'
      },
      importance: {
        high: '–í–∏—Å–æ–∫–∞',
        medium: '–°–µ—Ä–µ–¥–Ω—è',
        low: '–ù–∏–∑—å–∫–∞',
        highShort: '–í–∏—Å–æ–∫–∏–π',
        mediumShort: '–°–µ—Ä–µ–¥–Ω—ñ–π',
        lowShort: '–ù–∏–∑—å–∫–∏–π',
        highPlural: '–í–∏—Å–æ–∫—ñ',
        mediumPlural: '–°–µ—Ä–µ–¥–Ω—ñ',
        lowPlural: '–ù–∏–∑—å–∫—ñ'
      },
      tooltips: {
        menu: '–ú–µ–Ω—é',
        editValue: '–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –∑–Ω–∞—á–µ–Ω–Ω—è',
        fieldSettings: '–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ø–æ–ª—è',
        deleteField: '–í–∏–¥–∞–ª–∏—Ç–∏',
        changeLanguage: '–ó–º—ñ–Ω–∏—Ç–∏ –º–æ–≤—É'
      },
      fillStatus: {
        all: '–í—Å—ñ',
        filled: '–ó–∞–ø–æ–≤–Ω–µ–Ω—ñ',
        empty: '–ü–æ—Ä–æ–∂–Ω—ñ',
        filledness: '–ó–∞–ø–æ–≤–Ω–µ–Ω—ñ—Å—Ç—å'
      },
      sync: {
        storageMode: '–†–µ–∂–∏–º –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è',
        localMode: 'üíæ –õ–æ–∫–∞–ª—å–Ω–µ —Å—Ö–æ–≤–∏—â–µ',
        localModeDesc: '–î–∞–Ω—ñ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è —É –±—Ä–∞—É–∑–µ—Ä—ñ. –®–≤–∏–¥–∫–æ, –∞–ª–µ –¥–æ—Å—Ç—É–ø —Ç—ñ–ª—å–∫–∏ –∑ —Ü—å–æ–≥–æ –ø—Ä–∏—Å—Ç—Ä–æ—é.',
        googleSheetsMode: '‚òÅÔ∏è Google Sheets',
        googleSheetsModeDesc: '–°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è –∑ Google —Ç–∞–±–ª–∏—Ü–µ—é. –î–æ—Å—Ç—É–ø –∑ –±—É–¥—å-—è–∫–æ–≥–æ –ø—Ä–∏—Å—Ç—Ä–æ—é, –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è.',
        manualMode: 'üìÅ –†—É—á–Ω—ñ —Ñ–∞–π–ª–∏',
        manualModeDesc: '–Ü–º–ø–æ—Ä—Ç/–ï–∫—Å–ø–æ—Ä—Ç JSON —Ñ–∞–π–ª—ñ–≤. –ü–æ–≤–Ω–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –¥–∞–Ω–∏–º–∏.',
        googleSheetsSettings: 'Google Sheets –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è',
        stepByStepInstructions: '–ü–æ–∫—Ä–æ–∫–æ–≤–∞ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è',
        step1: '–ö—Ä–æ–∫ 1: Google Cloud Console',
        step2: '–ö—Ä–æ–∫ 2: –£–≤—ñ–º–∫–Ω–∏—Ç–∏ API',
        step3: '–ö—Ä–æ–∫ 3: –°—Ç–≤–æ—Ä–∏—Ç–∏ OAuth Client',
        projectName: '–ù–∞–∑–≤–∞',
        clientId: 'Client ID',
        spreadsheetId: 'Spreadsheet ID',
        authorizeGoogle: '–ê–≤—Ç–æ—Ä–∏–∑—É–≤–∞—Ç–∏—Å—å –≤ Google',
        createSpreadsheet: '–°—Ç–≤–æ—Ä–∏—Ç–∏ —Ç–∞–±–ª–∏—Ü—é',
        openSpreadsheet: '–í—ñ–¥–∫—Ä–∏—Ç–∏ —Ç–∞–±–ª–∏—Ü—é',
        autoSync: '–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è',
        interval: '–Ü–Ω—Ç–µ—Ä–≤–∞–ª',
        encryption: '–®–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö (—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ)',
        migrationData: '–ú—ñ–≥—Ä–∞—Ü—ñ—è –¥–∞–Ω–∏—Ö',
        exportToSheets: '–ï–∫—Å–ø–æ—Ä—Ç Local ‚Üí Google Sheets',
        importFromSheets: '–Ü–º–ø–æ—Ä—Ç Google Sheets ‚Üí Local',
        syncNow: '–°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É–≤–∞—Ç–∏ –∑–∞—Ä–∞–∑',
        initializing: '–Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è Google API...',
        authorized: '–ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–æ –≤ Google',
        spreadsheetCreated: '–¢–∞–±–ª–∏—Ü—é —Å—Ç–≤–æ—Ä–µ–Ω–æ!',
        openLink: '–í—ñ–¥–∫—Ä–∏—Ç–∏',
        uploadingData: '–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö...',
        downloadingData: '–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö...',
        errorAuth: '–ü–æ–º–∏–ª–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó',
        errorCreateSheet: '–ü–æ–º–∏–ª–∫–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç–∞–±–ª–∏—Ü—ñ',
        minute1: '1 —Ö–≤–∏–ª–∏–Ω–∞',
        minutes5: '5 —Ö–≤–∏–ª–∏–Ω',
        minutes15: '15 —Ö–≤–∏–ª–∏–Ω',
        minutes30: '30 —Ö–≤–∏–ª–∏–Ω',
        hour1: '1 –≥–æ–¥–∏–Ω–∞',
        securityTitle: '–ü—Ä–æ –≤–∞—à—É –±–µ–∑–ø–µ–∫—É',
        securityItem1: '–î–∞–Ω—ñ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è —É –í–ê–®–Ü–ô Google —Ç–∞–±–ª–∏—Ü—ñ',
        securityItem2: '–ú–∏ –ù–ï –º–∞—î–º–æ –¥–æ—Å—Ç—É–ø—É –¥–æ –≤–∞—à–∏—Ö –¥–∞–Ω–∏—Ö',
        securityItem3: '–¢–æ–∫–µ–Ω–∏ –¥–æ—Å—Ç—É–ø—É —Ç—ñ–ª—å–∫–∏ —É –≤–∞—à–æ–º—É –±—Ä–∞—É–∑–µ—Ä—ñ',
        securityItem4: '–ó —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è–º –¥–∞–Ω—ñ –Ω–µ—á–∏—Ç–∞–±–µ–ª—å–Ω—ñ –±–µ–∑ –ø–∞—Ä–æ–ª—è',
        securityItem5: '–í–∏ –º–æ–∂–µ—Ç–µ –≤—ñ–¥–∫–ª–∏–∫–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –±—É–¥—å-–∫–æ–ª–∏',
        migrationAndStats: '–ú—ñ–≥—Ä–∞—Ü—ñ—è —Ç–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞',
        fieldsFilled: '–ü–æ–ª—ñ–≤ –∑–∞–ø–æ–≤–Ω–µ–Ω–æ',
        lastSync: '–û—Å—Ç–∞–Ω–Ω—è —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è',
        never: '–ù—ñ–∫–æ–ª–∏'
      },
      hints: {
        formatting: '–ü—ñ–¥—Ç—Ä–∏–º—É—î—Ç—å—Å—è Markdown —Ñ–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è: **–∂–∏—Ä–Ω–∏–π**, *–∫—É—Ä—Å–∏–≤*, ~~–∑–∞–∫—Ä–µ—Å–ª–µ–Ω–∏–π~~',
        selectTextForFormatting: '–í–∏–¥—ñ–ª—ñ—Ç—å —Ç–µ–∫—Å—Ç –¥–ª—è —à–≤–∏–¥–∫–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è',
        nestedCategories: '–°—Ç–≤–æ—Ä—ñ—Ç—å –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó —Ç–∞ –ø—ñ–¥–∫–∞—Ç–µ–≥–æ—Ä—ñ—ó –¥–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–≤–∞–Ω–æ–≥–æ –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö',
        separateTagsWithCommas: '–†–æ–∑–¥—ñ–ª—è–π—Ç–µ —Ç–µ–≥–∏ –∫–æ–º–∞–º–∏',
        tagsPlaceholder: '—Ç–µ–≥1, —Ç–µ–≥2, —Ç–µ–≥3',
        valuesPlaceholder: '–ó–Ω–∞—á–µ–Ω–Ω—è —á–µ—Ä–µ–∑ –∫–æ–º—É',
        iconPlaceholder: 'fa-folder',
        clientIdPlaceholder: '1234567890-abc123...'
      },
      emptyStates: {
        noFieldsInCategory: '–ù–µ–º–∞—î –ø–æ–ª—ñ–≤ —É —Ü—ñ–π –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó',
        clickAddFieldToCreate: '–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å "–î–æ–¥–∞—Ç–∏ –ø–æ–ª–µ" —â–æ–± —Å—Ç–≤–æ—Ä–∏—Ç–∏ –Ω–æ–≤–µ –ø–æ–ª–µ'
      },
      instructions: {
        goTo: '–ü–µ—Ä–µ–π–¥—ñ—Ç—å',
        click: '–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å',
        find: '–ó–Ω–∞–π–¥—ñ—Ç—å',
        yourDomain: '–≤–∞—à –¥–æ–º–µ–Ω',
        copyClientId: '–°–ö–û–ü–Ü–Æ–ô–¢–ï'
      }
    },
    en: {
      app: {
        title: 'Love Dossier (BETA)',
        filePrefix: 'dossier',
        spreadsheetTitle: 'Dossier'
      },
      ui: {
        localMode: 'Local mode',
        save: 'Save',
        addField: 'Add field',
        more: 'More',
        sync: 'Sync',
        export: 'Export',
        import: 'Import',
        clear: 'Clear',
        searchPlaceholder: 'Search in all fields...',
        clearSearch: 'Clear search',
        fillProgress: 'Fill progress',
        selectCategory: 'Select category',
        categories: 'Categories',
        addCategory: 'Add category',
        selectCategoryLeft: 'Select category on the left',
        clickCategory: 'Click on a category to see fields',
        changeFilters: 'Try changing filters',
        modal: 'Modal',
        close: 'Close',
        cancel: 'Cancel',
        storageMode: 'Storage mode',
        filled: 'Filled',
        empty: 'Empty',
        all: 'All',
        high: 'High',
        medium: 'Medium',
        low: 'Low',
        filters: 'Filters',
        importance: 'Importance',
        edit: 'Edit',
        delete: 'Delete',
        addSubcategory: 'Add subcategory',
        emptyValue: 'Not filled',
        searchResults: 'results',
        searchResultsTitle: 'Search results',
        noResults: 'No results found',
        changeSearchQuery: 'Try changing your search query',
        privateBadge: 'üîí Private',
        of: 'of',
        fields: 'fields',
        filledProgress: 'Filled',
        inCategory: 'in category',
        manageCategories: 'Manage Categories',
        values: 'Values'
      },
      format: {
        bold: 'Bold (Ctrl+B)',
        italic: 'Italic (Ctrl+I)',
        strikethrough: 'Strikethrough',
        link: 'Link (Ctrl+K)',
        chip: 'Tag'
      },
      categories: {
        base: 'Basic Information',
        character: 'Character',
        preferences: 'Preferences',
        antipreferences: 'Dislikes',
        gifts: 'Gifts',
        psychology: 'Psychology',
        psych: 'Psychological Features',
        logistics: 'Logistics & Routine',
        goals: 'Goals & Dreams',
        custom: 'Additional',
        communication: 'Communication',
        finance: 'Finance',
        intimacy: 'Intimacy',
        family: 'Family',
        career: 'Career',
        culture: 'Culture'
      },
      fields: {
        fullName: 'Full Name',
        dob: 'Date of Birth',
        character: 'Character Traits',
        dreams: 'Dreams & Wishes',
        likes: 'Likes',
        memories: 'Memories',
        dislikes: 'Dislikes',
        anti_triggers: 'Triggers & Irritants',
        anti_topics: 'Uncomfortable Topics',
        anti_places: 'Disliked Places',
        anti_sounds: 'Unpleasant Sounds/Smells',
        anti_situations: 'Uncomfortable Situations',
        gift_wishlist: 'Wishlist',
        gift_sizes: 'Sizes',
        gift_brands: 'Favorite Brands',
        gift_anti: 'Anti-gifts',
        gift_history: 'Gift History',
        love_language: 'Love Language',
        values: 'Core Values',
        psy_conflict_style: 'Conflict Behavior Style',
        psy_compliments: 'How Likes to Receive Compliments',
        psy_stress_relief: 'Stress Relief Methods',
        log_places: 'Favorite Places',
        log_social_circle: 'Social Circle',
        log_schedule_peak: 'Peak Activity Hours',
        log_media: 'Media Preferences',
        short_goals: 'Short-term Goals',
        goal_travel: 'Travel Dreams',
        goal_traditions: 'Traditions to Create',
        goal_cozy_ideal: 'Perfect Cozy Evening',
        contact_phone: 'Phone',
        contact_email: 'Email',
        city: 'City / Location',
        anniversary: 'Anniversary / Important Date',
        attachment_style: 'Attachment Style',
        humor_style: 'Sense of Humor',
        personal_boundaries: 'Personal Boundaries',
        cuisines_fav: 'Favorite Cuisines',
        allergies: 'Allergies / Sensitivities',
        aesthetics: 'Aesthetics / Styles',
        fav_colors: 'Favorite Colors',
        anti_allergies: 'Forbidden Due to Allergies',
        anti_people_types: 'Difficult People Types',
        gift_price_range: 'Comfortable Gift Budget',
        gift_stores: 'Favorite Stores / Platforms',
        psy_anxiety_triggers: 'Anxiety Triggers',
        psy_motivators: 'Motivators',
        psy_calming_words: 'Support Words/Phrases',
        log_transport: 'Usual Transport',
        log_work_hours: 'Work/Study Hours',
        log_routines: 'Daily Routines',
        log_food_schedule: 'Food Schedule',
        long_goals: 'Long-term Goals',
        learning_topics: 'Wants to Learn',
        bucket_list: 'Bucket List',
        notes_private: 'Personal Notes',
        comm_style: 'Communication Style',
        comm_frequency: 'Desired Contact Frequency',
        comm_topics_good: 'Comfortable Topics',
        comm_topics_bad: 'Difficult Topics',
        comm_love_language: 'Love Language in Communication',
        finance_habits: 'Financial Habits',
        finance_attitude: 'Attitude Towards Money',
        finance_goals: 'Shared Financial Goals',
        finance_split: 'Expense Split',
        intimacy_language: 'Language of Intimacy',
        intimacy_boundaries: 'Boundaries & Comfort',
        intimacy_gestures: 'Romantic Gestures',
        family_info: 'Family Information',
        family_important: 'Important People',
        family_traditions: 'Family Traditions',
        family_attitude: 'Attitude Towards Family',
        career_goals: 'Professional Goals',
        career_schedule: 'Work Schedule',
        career_dreams: 'Career Dreams',
        career_balance: 'Work-life Balance',
        culture_religion: 'Religious Views',
        culture_politics: 'Political Beliefs',
        culture_traditions: 'Cultural Traditions',
        culture_principles: 'Life Principles'
      },
      nested: {
        food: 'Food',
        activities: 'Activities',
        sweet: 'Sweets',
        drinks: 'Drinks',
        active: 'Active',
        calm: 'Calm',
        tastes: 'Tastes',
        dishes: 'Dishes',
        social: 'Social',
        personal: 'Personal',
        behaviors: 'Behavior',
        communication: 'Communication',
        habits: 'Habits'
      },
      messages: {
        dataSaved: 'Data saved',
        exported: 'Exported',
        imported: 'Imported',
        invalidFile: 'Invalid file format',
        fileReadError: 'File read error',
        dataCleared: 'Data cleared',
        confirmClear: 'Are you sure you want to clear all data? This action is irreversible!',
        fillAllFields: 'Fill in all fields',
        fieldExists: 'A field with this ID already exists',
        fieldUpdated: 'Field updated',
        fieldCreated: 'Field created',
        categoryExists: 'A category with this ID already exists',
        categoryUpdated: 'Category updated',
        categoryCreated: 'Category created',
        valueUpdated: 'Value updated',
        fieldDeleted: 'Field deleted',
        confirmDeleteField: 'Delete this field?',
        syncError: 'Sync error',
        syncComplete: 'Sync completed',
        syncInitError: 'Initialization error',
        needAuth: 'Google authorization required',
        enterUrl: 'Enter URL:',
        connectionRestored: 'Connection restored',
        offlineMode: 'Offline mode',
        localSave: 'Data saved locally',
        showFilled: 'Shown: filled fields',
        showEmpty: 'Shown: empty fields',
        showAll: 'Shown: all fields',
        allImportance: 'Shown fields of all importance levels',
        syncing: 'Syncing...',
        noFieldsWithFilters: 'No fields with selected filters',
        noFilledFields: 'No filled fields with selected filters',
        noEmptyFields: 'No empty fields with selected filters',
        noFieldsWithImportance: 'No fields with selected importance levels',
        enterClientId: 'Enter Client ID',
        passwordMinLength: 'Password must be at least 6 characters',
        passwordsNotMatch: 'Passwords do not match',
        settingsSaved: 'Settings saved',
        passwordNotStored: 'Password is not stored!',
        writeItDown: 'Write it down in a safe place.',
        noNestedCategories: 'No nested categories',
        errorNotAuthorized: 'Not authorized',
        errorSpreadsheetIdNotSet: 'Spreadsheet ID not set',
        errorDataNotFound: 'Data not found',
        errorDataEncrypted: 'Data is encrypted. Enter password to decrypt.',
        errorNotAuthorizedGoogle: 'Not authorized with Google',
        errorGoogleApiNotLoaded: 'Google API not loaded',
        errorGoogleIdentityNotLoaded: 'Google Identity Services not loaded',
        errorTokenClientNotInitialized: 'Token client not initialized'
      },
      modal: {
        confirmAction: 'Confirmation',
        editField: 'Edit Field',
        newField: 'New Field',
        editCategory: 'Edit Category',
        newCategory: 'New Category',
        editValue: 'Edit',
        syncSettings: 'Sync Settings',
        fieldId: 'Field ID',
        fieldName: 'Field Name',
        type: 'Type',
        importance: 'Importance',
        category: 'Category',
        required: 'Required field',
        categoryId: 'Category ID',
        categoryName: 'Category Name',
        icon: 'Icon (Font Awesome)',
        customCategoryNote: 'Changing the name of a custom category changes it for all languages',
        password: 'Password',
        confirmPassword: 'Confirmation',
        enterPassword: 'Enter password',
        confirmPasswordPlaceholder: 'Confirm password'
      },
      types: {
        text: 'Text',
        textarea: 'Text Area',
        date: 'Date',
        tags: 'Tags',
        nested: 'Nested'
      },
      importance: {
        high: 'High',
        medium: 'Medium',
        low: 'Low',
        highShort: 'High',
        mediumShort: 'Medium',
        lowShort: 'Low',
        highPlural: 'High',
        mediumPlural: 'Medium',
        lowPlural: 'Low'
      },
      tooltips: {
        menu: 'Menu',
        editValue: 'Edit value',
        fieldSettings: 'Field settings',
        deleteField: 'Delete',
        changeLanguage: 'Change language'
      },
      fillStatus: {
        all: 'All',
        filled: 'Filled',
        empty: 'Empty',
        filledness: 'Fill Status'
      },
      sync: {
        storageMode: 'Storage Mode',
        localMode: 'üíæ Local Storage',
        localModeDesc: 'Data is stored in the browser. Fast, but only accessible from this device.',
        googleSheetsMode: '‚òÅÔ∏è Google Sheets',
        googleSheetsModeDesc: 'Sync with Google spreadsheet. Access from any device, automatic saving.',
        manualMode: 'üìÅ Manual Files',
        manualModeDesc: 'Import/Export JSON files. Full control over data.',
        googleSheetsSettings: 'Google Sheets Settings',
        stepByStepInstructions: 'Step-by-step setup instructions',
        step1: 'Step 1: Google Cloud Console',
        step2: 'Step 2: Enable API',
        step3: 'Step 3: Create OAuth Client',
        projectName: 'Name',
        clientId: 'Client ID',
        spreadsheetId: 'Spreadsheet ID',
        authorizeGoogle: 'Authorize with Google',
        createSpreadsheet: 'Create Spreadsheet',
        openSpreadsheet: 'Open Spreadsheet',
        autoSync: 'Automatic synchronization',
        interval: 'Interval',
        encryption: 'Data encryption (recommended)',
        migrationData: 'Data Migration',
        exportToSheets: 'Export Local ‚Üí Google Sheets',
        importFromSheets: 'Import Google Sheets ‚Üí Local',
        syncNow: 'Sync Now',
        initializing: 'Initializing Google API...',
        authorized: 'Authorized with Google',
        spreadsheetCreated: 'Spreadsheet created!',
        openLink: 'Open',
        uploadingData: 'Uploading data...',
        downloadingData: 'Downloading data...',
        errorAuth: 'Authorization error',
        errorCreateSheet: 'Error creating spreadsheet',
        minute1: '1 minute',
        minutes5: '5 minutes',
        minutes15: '15 minutes',
        minutes30: '30 minutes',
        hour1: '1 hour',
        securityTitle: 'About Your Security',
        securityItem1: 'Data is stored in YOUR Google spreadsheet',
        securityItem2: 'We do NOT have access to your data',
        securityItem3: 'Access tokens are only in your browser',
        securityItem4: 'With encryption, data is unreadable without password',
        securityItem5: 'You can revoke access at any time',
        migrationAndStats: 'Migration and Statistics',
        fieldsFilled: 'Fields filled',
        lastSync: 'Last sync',
        never: 'Never'
      },
      hints: {
        formatting: 'Markdown formatting supported: **bold**, *italic*, ~~strikethrough~~',
        selectTextForFormatting: 'Select text for quick formatting',
        separateTagsWithCommas: 'Separate tags with commas',
        tagsPlaceholder: 'tag1, tag2, tag3',
        valuesPlaceholder: 'Values separated by comma',
        iconPlaceholder: 'fa-folder',
        clientIdPlaceholder: '1234567890-abc123...',
        nestedCategories: 'Create categories and subcategories for structured data storage'
      },
      emptyStates: {
        noFieldsInCategory: 'No fields in this category',
        clickAddFieldToCreate: 'Click "Add field" to create a new field'
      },
      instructions: {
        goTo: 'Go to',
        click: 'Click',
        find: 'Find',
        yourDomain: 'your domain',
        copyClientId: 'COPY'
      }
    },
    ru: {
      app: {
        title: '–î–æ—Å—å–µ –ª—é–±–∏–º–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞ (BETA)',
        filePrefix: 'dose',
        spreadsheetTitle: '–î–æ—Å—å–µ'
      },
      ui: {
        localMode: '–õ–æ–∫–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º',
        save: '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å',
        addField: '–î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ',
        more: '–ë–æ–ª—å—à–µ',
        sync: '–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è',
        export: '–≠–∫—Å–ø–æ—Ä—Ç',
        import: '–ò–º–ø–æ—Ä—Ç',
        clear: '–û—á–∏—Å—Ç–∏—Ç—å',
        searchPlaceholder: '–ü–æ–∏—Å–∫ –ø–æ –≤—Å–µ–º –ø–æ–ª—è–º...',
        clearSearch: '–û—á–∏—Å—Ç–∏—Ç—å –ø–æ–∏—Å–∫',
        fillProgress: '–ü—Ä–æ–≥—Ä–µ—Å—Å –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è',
        selectCategory: '–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é',
        categories: '–ö–∞—Ç–µ–≥–æ—Ä–∏–∏',
        addCategory: '–î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é',
        selectCategoryLeft: '–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é —Å–ª–µ–≤–∞',
        clickCategory: '–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—é, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –ø–æ–ª—è',
        changeFilters: '–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã',
        modal: '–ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ',
        close: '–ó–∞–∫—Ä—ã—Ç—å',
        cancel: '–û—Ç–º–µ–Ω–∏—Ç—å',
        storageMode: '–†–µ–∂–∏–º —Ö—Ä–∞–Ω–µ–Ω–∏—è',
        filled: '–ó–∞–ø–æ–ª–Ω–µ–Ω–æ',
        empty: '–ü—É—Å—Ç–æ',
        all: '–í—Å–µ',
        high: '–í—ã—Å–æ–∫–∏–π',
        medium: '–°—Ä–µ–¥–Ω–∏–π',
        low: '–ù–∏–∑–∫–∏–π',
        filters: '–§–∏–ª—å—Ç—Ä—ã',
        importance: '–í–∞–∂–Ω–æ—Å—Ç—å',
        edit: '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å',
        delete: '–£–¥–∞–ª–∏—Ç—å',
        addSubcategory: '–î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—é',
        emptyValue: '–ù–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ',
        searchResults: '—Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤',
        searchResultsTitle: '–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞',
        noResults: '–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ',
        changeSearchQuery: '–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å',
        privateBadge: 'üîí –ü—Ä–∏–≤–∞—Ç–Ω–∞—è',
        of: '–∏–∑',
        fields: '–ø–æ–ª–µ–π',
        filledProgress: '–ó–∞–ø–æ–ª–Ω–µ–Ω–æ',
        inCategory: '–≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏',
        manageCategories: '–£–ø—Ä–∞–≤–ª—è—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏',
        values: '–ó–Ω–∞—á–µ–Ω–∏—è'
      },
      format: {
        bold: '–ñ–∏—Ä–Ω—ã–π (Ctrl+B)',
        italic: '–ö—É—Ä—Å–∏–≤ (Ctrl+I)',
        strikethrough: '–ó–∞—á—ë—Ä–∫–Ω—É—Ç—ã–π',
        link: '–°—Å—ã–ª–∫–∞ (Ctrl+K)',
        chip: '–¢–µ–≥'
      },
      categories: {
        base: '–ë–∞–∑–æ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è',
        character: '–•–∞—Ä–∞–∫—Ç–µ—Ä',
        preferences: '–ü—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è',
        antipreferences: '–ê–Ω—Ç–∏–ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è',
        gifts: '–ü–æ–¥–∞—Ä–∫–∏',
        psychology: '–ü—Å–∏—Ö–æ–ª–æ–≥–∏—è',
        psych: '–ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏',
        logistics: '–õ–æ–≥–∏—Å—Ç–∏–∫–∞ –∏ –±—ã—Ç',
        goals: '–¶–µ–ª–∏ –∏ –º–µ—á—Ç—ã',
        custom: '–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ',
        communication: '–ö–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è',
        finance: '–§–∏–Ω–∞–Ω—Å—ã',
        intimacy: '–ò–Ω—Ç–∏–º–Ω–æ—Å—Ç—å',
        family: '–°–µ–º—å—è',
        career: '–ö–∞—Ä—å–µ—Ä–∞',
        culture: '–ö—É–ª—å—Ç—É—Ä–∞'
      },
      fields: {
        fullName: '–§–ò–û',
        dob: '–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è',
        character: '–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∞',
        dreams: '–ú–µ—á—Ç—ã –∏ –∂–µ–ª–∞–Ω–∏—è',
        likes: '–ß—Ç–æ –ª—é–±–∏—Ç',
        memories: '–ü–∞–º—è—Ç—å –∏ –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏—è',
        dislikes: '–ß—Ç–æ –Ω–µ –ª—é–±–∏—Ç',
        anti_triggers: '–¢—Ä–∏–≥–≥–µ—Ä—ã –∏ —Ä–∞–∑–¥—Ä–∞–∂–∏—Ç–µ–ª–∏',
        anti_topics: '–ù–µ—É–¥–æ–±–Ω—ã–µ —Ç–µ–º—ã',
        anti_places: '–ù–µ–ª—é–±–∏–º—ã–µ –º–µ—Å—Ç–∞',
        anti_sounds: '–ù–µ–ø—Ä–∏—è—Ç–Ω—ã–µ –∑–≤—É–∫–∏/–∑–∞–ø–∞—Ö–∏',
        anti_situations: '–ù–µ—É–¥–æ–±–Ω—ã–µ —Å–∏—Ç—É–∞—Ü–∏–∏',
        gift_wishlist: '–°–ø–∏—Å–æ–∫ –∂–µ–ª–∞–Ω–∏–π',
        gift_sizes: '–†–∞–∑–º–µ—Ä—ã',
        gift_brands: '–õ—é–±–∏–º—ã–µ –±—Ä–µ–Ω–¥—ã',
        gift_anti: '–ê–Ω—Ç–∏-–ø–æ–¥–∞—Ä–∫–∏',
        gift_history: '–ò—Å—Ç–æ—Ä–∏—è –ø–æ–¥–∞—Ä–∫–æ–≤',
        love_language: '–Ø–∑—ã–∫ –ª—é–±–≤–∏',
        values: '–û—Å–Ω–æ–≤–Ω—ã–µ —Ü–µ–Ω–Ω–æ—Å—Ç–∏',
        psy_conflict_style: '–°—Ç–∏–ª—å –ø–æ–≤–µ–¥–µ–Ω–∏—è –≤ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞—Ö',
        psy_compliments: '–ö–∞–∫ –ª—é–±–∏—Ç –ø–æ–ª—É—á–∞—Ç—å –∫–æ–º–ø–ª–∏–º–µ–Ω—Ç—ã',
        psy_stress_relief: '–°–ø–æ—Å–æ–±—ã —Å–Ω—è—Ç–∏—è —Å—Ç—Ä–µ—Å—Å–∞',
        log_places: '–õ—é–±–∏–º—ã–µ –º–µ—Å—Ç–∞',
        log_social_circle: '–ö—Ä—É–≥ –æ–±—â–µ–Ω–∏—è',
        log_schedule_peak: '–ß–∞—Å—ã –ø–∏–∫–æ–≤–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏',
        log_media: '–ú–µ–¥–∏–∞ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è',
        short_goals: '–ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω—ã–µ —Ü–µ–ª–∏',
        goal_travel: '–ú–µ—á—Ç—ã –æ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è—Ö',
        goal_traditions: '–¢—Ä–∞–¥–∏—Ü–∏–∏ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è',
        goal_cozy_ideal: '–ò–¥–µ–∞–ª—å–Ω—ã–π —É—é—Ç–Ω—ã–π –≤–µ—á–µ—Ä',
        contact_phone: '–¢–µ–ª–µ—Ñ–æ–Ω',
        contact_email: 'Email',
        city: '–ì–æ—Ä–æ–¥ / –õ–æ–∫–∞—Ü–∏—è',
        anniversary: '–ì–æ–¥–æ–≤—â–∏–Ω–∞ / –í–∞–∂–Ω–∞—è –¥–∞—Ç–∞',
        attachment_style: '–°—Ç–∏–ª—å –ø—Ä–∏–≤—è–∑–∞–Ω–Ω–æ—Å—Ç–∏',
        humor_style: '–ß—É–≤—Å—Ç–≤–æ —é–º–æ—Ä–∞',
        personal_boundaries: '–õ–∏—á–Ω—ã–µ –≥—Ä–∞–Ω–∏—Ü—ã',
        cuisines_fav: '–õ—é–±–∏–º—ã–µ –∫—É—Ö–Ω–∏',
        allergies: '–ê–ª–ª–µ—Ä–≥–∏–∏ / –ß—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏',
        aesthetics: '–≠—Å—Ç–µ—Ç–∏–∫–∞ / –°—Ç–∏–ª–∏',
        fav_colors: '–õ—é–±–∏–º—ã–µ —Ü–≤–µ—Ç–∞',
        anti_allergies: '–ó–∞–ø—Ä–µ—â–µ–Ω–æ –∏–∑-–∑–∞ –∞–ª–ª–µ—Ä–≥–∏–∏',
        anti_people_types: '–°–ª–æ–∂–Ω—ã–µ —Ç–∏–ø—ã –ª—é–¥–µ–π',
        gift_price_range: '–ö–æ–º—Ñ–æ—Ä—Ç–Ω—ã–π –±—é–¥–∂–µ—Ç –ø–æ–¥–∞—Ä–∫–∞',
        gift_stores: '–õ—é–±–∏–º—ã–µ –º–∞–≥–∞–∑–∏–Ω—ã / –ü–ª–∞—Ç—Ñ–æ—Ä–º—ã',
        psy_anxiety_triggers: '–¢—Ä–∏–≥–≥–µ—Ä—ã —Ç—Ä–µ–≤–æ–∂–Ω–æ—Å—Ç–∏',
        psy_motivators: '–ú–æ—Ç–∏–≤–∞—Ç–æ—Ä—ã',
        psy_calming_words: '–°–ª–æ–≤–∞/—Ñ—Ä–∞–∑—ã –ø–æ–¥–¥–µ—Ä–∂–∫–∏',
        log_transport: '–û–±—ã—á–Ω—ã–π —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç',
        log_work_hours: '–ß–∞—Å—ã —Ä–∞–±–æ—Ç—ã/—É—á—ë–±—ã',
        log_routines: '–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ —Ä—É—Ç–∏–Ω—ã',
        log_food_schedule: '–ì—Ä–∞—Ñ–∏–∫ –ø–∏—Ç–∞–Ω–∏—è',
        long_goals: '–î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ —Ü–µ–ª–∏',
        learning_topics: '–•–æ—á–µ—Ç –∏–∑—É—á–∏—Ç—å',
        bucket_list: '–°–ø–∏—Å–æ–∫ –º–µ—á—Ç',
        notes_private: '–õ–∏—á–Ω—ã–µ –∑–∞–º–µ—Ç–∫–∏',
        comm_style: '–°—Ç–∏–ª—å –æ–±—â–µ–Ω–∏—è',
        comm_frequency: '–ñ–µ–ª–∞–µ–º–∞—è —á–∞—Å—Ç–æ—Ç–∞ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤',
        comm_topics_good: '–ö–æ–º—Ñ–æ—Ä—Ç–Ω—ã–µ —Ç–µ–º—ã',
        comm_topics_bad: '–°–ª–æ–∂–Ω—ã–µ —Ç–µ–º—ã',
        comm_love_language: '–Ø–∑—ã–∫ –ª—é–±–≤–∏ –≤ –æ–±—â–µ–Ω–∏–∏',
        finance_habits: '–§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –ø—Ä–∏–≤—ã—á–∫–∏',
        finance_attitude: '–û—Ç–Ω–æ—à–µ–Ω–∏–µ –∫ –¥–µ–Ω—å–≥–∞–º',
        finance_goals: '–û–±—â–∏–µ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Ü–µ–ª–∏',
        finance_split: '–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Ä–∞—Å—Ö–æ–¥–æ–≤',
        intimacy_language: '–Ø–∑—ã–∫ –∏–Ω—Ç–∏–º–Ω–æ—Å—Ç–∏',
        intimacy_boundaries: '–ì—Ä–∞–Ω–∏—Ü—ã –∏ –∫–æ–º—Ñ–æ—Ä—Ç',
        intimacy_gestures: '–†–æ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–µ –∂–µ—Å—Ç—ã',
        family_info: '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–µ–º—å–µ',
        family_important: '–í–∞–∂–Ω—ã–µ –ª—é–¥–∏',
        family_traditions: '–°–µ–º–µ–π–Ω—ã–µ —Ç—Ä–∞–¥–∏—Ü–∏–∏',
        family_attitude: '–û—Ç–Ω–æ—à–µ–Ω–∏–µ –∫ —Å–µ–º—å–µ',
        career_goals: '–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ü–µ–ª–∏',
        career_schedule: '–ì—Ä–∞—Ñ–∏–∫ —Ä–∞–±–æ—Ç—ã',
        career_dreams: '–ö–∞—Ä—å–µ—Ä–Ω—ã–µ –º–µ—á—Ç—ã',
        career_balance: '–ë–∞–ª–∞–Ω—Å —Ä–∞–±–æ—Ç—ã –∏ –∂–∏–∑–Ω–∏',
        culture_religion: '–†–µ–ª–∏–≥–∏–æ–∑–Ω—ã–µ –≤–∑–≥–ª—è–¥—ã',
        culture_politics: '–ü–æ–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ —É–±–µ–∂–¥–µ–Ω–∏—è',
        culture_traditions: '–ö—É–ª—å—Ç—É—Ä–Ω—ã–µ —Ç—Ä–∞–¥–∏—Ü–∏–∏',
        culture_principles: '–ñ–∏–∑–Ω–µ–Ω–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã'
      },
      nested: {
        food: '–ï–¥–∞',
        activities: '–ó–∞–Ω—è—Ç–∏—è',
        sweet: '–°–ª–∞–¥–∫–æ–µ',
        drinks: '–ù–∞–ø–∏—Ç–∫–∏',
        active: '–ê–∫—Ç–∏–≤–Ω—ã–µ',
        calm: '–°–ø–æ–∫–æ–π–Ω—ã–µ',
        tastes: '–í–∫—É—Å—ã',
        dishes: '–ë–ª—é–¥–∞',
        social: '–°–æ—Ü–∏–∞–ª—å–Ω—ã–µ',
        personal: '–õ–∏—á–Ω—ã–µ',
        behaviors: '–ü–æ–≤–µ–¥–µ–Ω–∏–µ',
        communication: '–ö–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è',
        habits: '–ü—Ä–∏–≤—ã—á–∫–∏'
      },
      messages: {
        dataSaved: '–î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã',
        exported: '–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ',
        imported: '–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ',
        invalidFile: '–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞',
        fileReadError: '–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞',
        dataCleared: '–î–∞–Ω–Ω—ã–µ –æ—á–∏—â–µ–Ω—ã',
        confirmClear: '–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ!',
        fillAllFields: '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è',
        fieldExists: '–ü–æ–ª–µ —Å —Ç–∞–∫–∏–º ID —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç',
        fieldUpdated: '–ü–æ–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–æ',
        fieldCreated: '–ü–æ–ª–µ —Å–æ–∑–¥–∞–Ω–æ',
        categoryExists: '–ö–∞—Ç–µ–≥–æ—Ä–∏—è —Å —Ç–∞–∫–∏–º ID —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç',
        categoryUpdated: '–ö–∞—Ç–µ–≥–æ—Ä–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞',
        categoryCreated: '–ö–∞—Ç–µ–≥–æ—Ä–∏—è —Å–æ–∑–¥–∞–Ω–∞',
        valueUpdated: '–ó–Ω–∞—á–µ–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–æ',
        fieldDeleted: '–ü–æ–ª–µ —É–¥–∞–ª–µ–Ω–æ',
        confirmDeleteField: '–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ –ø–æ–ª–µ?',
        syncError: '–û—à–∏–±–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏',
        syncComplete: '–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞',
        syncInitError: '–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏',
        needAuth: '–¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –≤ Google',
        syncing: '–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è...',
        enterClientId: '–í–≤–µ–¥–∏—Ç–µ Client ID',
        passwordMinLength: '–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤',
        passwordsNotMatch: '–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç',
        settingsSaved: '–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã',
        enterUrl: '–í–≤–µ–¥–∏—Ç–µ URL:',
        connectionRestored: '–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ',
        offlineMode: '–û—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º',
        localSave: '–î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –ª–æ–∫–∞–ª—å–Ω–æ',
        showFilled: '–ü–æ–∫–∞–∑–∞–Ω–æ: –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –ø–æ–ª—è',
        showEmpty: '–ü–æ–∫–∞–∑–∞–Ω–æ: –ø—É—Å—Ç—ã–µ –ø–æ–ª—è',
        showAll: '–ü–æ–∫–∞–∑–∞–Ω–æ: –≤—Å–µ –ø–æ–ª—è',
        allImportance: '–ü–æ–∫–∞–∑–∞–Ω—ã –ø–æ–ª—è –≤—Å–µ—Ö —É—Ä–æ–≤–Ω–µ–π –≤–∞–∂–Ω–æ—Å—Ç–∏',
        noFieldsWithFilters: '–ù–µ—Ç –ø–æ–ª–µ–π —Å –≤—ã–±—Ä–∞–Ω–Ω—ã–º–∏ —Ñ–∏–ª—å—Ç—Ä–∞–º–∏',
        noFilledFields: '–ù–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –ø–æ–ª–µ–π —Å –≤—ã–±—Ä–∞–Ω–Ω—ã–º–∏ —Ñ–∏–ª—å—Ç—Ä–∞–º–∏',
        noEmptyFields: '–ù–µ—Ç –ø—É—Å—Ç—ã—Ö –ø–æ–ª–µ–π —Å –≤—ã–±—Ä–∞–Ω–Ω—ã–º–∏ —Ñ–∏–ª—å—Ç—Ä–∞–º–∏',
        noFieldsWithImportance: '–ù–µ—Ç –ø–æ–ª–µ–π —Å –≤—ã–±—Ä–∞–Ω–Ω—ã–º–∏ —É—Ä–æ–≤–Ω—è–º–∏ –≤–∞–∂–Ω–æ—Å—Ç–∏',
        passwordNotStored: '–ü–∞—Ä–æ–ª—å –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è!',
        writeItDown: '–ó–∞–ø–∏—à–∏—Ç–µ –µ–≥–æ –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ–º –º–µ—Å—Ç–µ.',
        noNestedCategories: '–ù–µ—Ç –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π',
        errorNotAuthorized: '–ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–æ',
        errorSpreadsheetIdNotSet: 'Spreadsheet ID –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω',
        errorDataNotFound: '–î–∞–Ω–Ω—ã–µ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã',
        errorDataEncrypted: '–î–∞–Ω–Ω—ã–µ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ã. –í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –¥–ª—è —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∏.',
        errorNotAuthorizedGoogle: '–ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–æ –≤ Google',
        errorGoogleApiNotLoaded: 'Google API –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω',
        errorGoogleIdentityNotLoaded: 'Google Identity Services –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω',
        errorTokenClientNotInitialized: 'Token client –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω'
      },
      modal: {
        confirmAction: '–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ',
        editField: '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª–µ',
        newField: '–ù–æ–≤–æ–µ –ø–æ–ª–µ',
        editCategory: '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é',
        newCategory: '–ù–æ–≤–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è',
        syncSettings: '–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏',
        fieldId: 'ID –ø–æ–ª—è',
        fieldName: '–ù–∞–∑–≤–∞–Ω–∏–µ –ø–æ–ª—è',
        type: '–¢–∏–ø',
        importance: '–í–∞–∂–Ω–æ—Å—Ç—å',
        category: '–ö–∞—Ç–µ–≥–æ—Ä–∏—è',
        required: '–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ',
        password: '–ü–∞—Ä–æ–ª—å',
        confirmPassword: '–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ',
        editValue: '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å',
        categoryId: 'ID –∫–∞—Ç–µ–≥–æ—Ä–∏–∏',
        categoryName: '–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏',
        icon: '–ò–∫–æ–Ω–∫–∞ (Font Awesome)',
        customCategoryNote: '–ò–∑–º–µ–Ω–µ–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏–∑–º–µ–Ω—è–µ—Ç –µ—ë –¥–ª—è –≤—Å–µ—Ö —è–∑—ã–∫–æ–≤',
        enterPassword: '–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å',
        confirmPasswordPlaceholder: '–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å'
      },
      types: {
        text: '–¢–µ–∫—Å—Ç',
        textarea: '–¢–µ–∫—Å—Ç–æ–≤–∞—è –æ–±–ª–∞—Å—Ç—å',
        date: '–î–∞—Ç–∞',
        tags: '–¢–µ–≥–∏',
        nested: '–í–ª–æ–∂–µ–Ω–Ω—ã–µ'
      },
      importance: {
        high: '–í—ã—Å–æ–∫–∞—è',
        medium: '–°—Ä–µ–¥–Ω—è—è',
        low: '–ù–∏–∑–∫–∞—è',
        highPlural: '–í—ã—Å–æ–∫–∏–µ',
        mediumPlural: '–°—Ä–µ–¥–Ω–∏–µ',
        lowPlural: '–ù–∏–∑–∫–∏–µ',
        highShort: '–í—ã—Å–æ–∫–∞—è',
        mediumShort: '–°—Ä–µ–¥–Ω—è—è',
        lowShort: '–ù–∏–∑–∫–∞—è'
      },
      tooltips: {
        menu: '–ú–µ–Ω—é',
        editValue: '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ',
        fieldSettings: '–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—è',
        deleteField: '–£–¥–∞–ª–∏—Ç—å',
        changeLanguage: '–ò–∑–º–µ–Ω–∏—Ç—å —è–∑—ã–∫'
      },
      fillStatus: {
        all: '–í—Å–µ',
        filled: '–ó–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ',
        empty: '–ü—É—Å—Ç—ã–µ',
        filledness: '–ó–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ—Å—Ç—å'
      },
      sync: {
        storageMode: '–†–µ–∂–∏–º —Ö—Ä–∞–Ω–µ–Ω–∏—è',
        localMode: 'üíæ –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ',
        localModeDesc: '–î–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ. –ë—ã—Å—Ç—Ä–æ, –Ω–æ –¥–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ —Å —ç—Ç–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞.',
        googleSheetsMode: '‚òÅÔ∏è Google Sheets',
        googleSheetsModeDesc: '–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å Google —Ç–∞–±–ª–∏—Ü–µ–π. –î–æ—Å—Ç—É–ø —Å –ª—é–±–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞, –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ.',
        manualMode: 'üìÅ –†—É—á–Ω—ã–µ —Ñ–∞–π–ª—ã',
        manualModeDesc: '–ò–º–ø–æ—Ä—Ç/–≠–∫—Å–ø–æ—Ä—Ç JSON —Ñ–∞–π–ª–æ–≤. –ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –¥–∞–Ω–Ω—ã–º–∏.',
        googleSheetsSettings: '–ù–∞—Å—Ç—Ä–æ–π–∫–∏ Google Sheets',
        stepByStepInstructions: '–ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏',
        step1: '–®–∞–≥ 1: Google Cloud Console',
        step2: '–®–∞–≥ 2: –í–∫–ª—é—á–∏—Ç—å API',
        step3: '–®–∞–≥ 3: –°–æ–∑–¥–∞—Ç—å OAuth Client',
        projectName: '–ù–∞–∑–≤–∞–Ω–∏–µ',
        clientId: 'Client ID',
        spreadsheetId: 'Spreadsheet ID',
        authorizeGoogle: '–ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è –≤ Google',
        createSpreadsheet: '–°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É',
        openSpreadsheet: '–û—Ç–∫—Ä—ã—Ç—å —Ç–∞–±–ª–∏—Ü—É',
        autoSync: '–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è',
        interval: '–ò–Ω—Ç–µ—Ä–≤–∞–ª',
        encryption: '–®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ)',
        migrationData: '–ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö',
        exportToSheets: '–≠–∫—Å–ø–æ—Ä—Ç Local ‚Üí Google Sheets',
        importFromSheets: '–ò–º–ø–æ—Ä—Ç Google Sheets ‚Üí Local',
        syncNow: '–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–µ–π—á–∞—Å',
        initializing: '–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Google API...',
        authorized: '–ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–æ –≤ Google',
        spreadsheetCreated: '–¢–∞–±–ª–∏—Ü–∞ —Å–æ–∑–¥–∞–Ω–∞!',
        openLink: '–û—Ç–∫—Ä—ã—Ç—å',
        uploadingData: '–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...',
        downloadingData: '–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...',
        errorAuth: '–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏',
        errorCreateSheet: '–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã',
        minute1: '1 –º–∏–Ω—É—Ç–∞',
        minutes5: '5 –º–∏–Ω—É—Ç',
        minutes15: '15 –º–∏–Ω—É—Ç',
        minutes30: '30 –º–∏–Ω—É—Ç',
        hour1: '1 —á–∞—Å',
        securityTitle: '–û –≤–∞—à–µ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏',
        securityItem1: '–î–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –í–ê–®–ï–ô —Ç–∞–±–ª–∏—Ü–µ Google',
        securityItem2: '–ú—ã –ù–ï –∏–º–µ–µ–º –¥–æ—Å—Ç—É–ø–∞ –∫ –≤–∞—à–∏–º –¥–∞–Ω–Ω—ã–º',
        securityItem3: '–¢–æ–∫–µ–Ω—ã –¥–æ—Å—Ç—É–ø–∞ —Ç–æ–ª—å–∫–æ –≤ –≤–∞—à–µ–º –±—Ä–∞—É–∑–µ—Ä–µ',
        securityItem4: '–° —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ–º –¥–∞–Ω–Ω—ã–µ –Ω–µ—á–∏—Ç–∞–µ–º—ã –±–µ–∑ –ø–∞—Ä–æ–ª—è',
        securityItem5: '–í—ã –º–æ–∂–µ—Ç–µ –æ—Ç–æ–∑–≤–∞—Ç—å –¥–æ—Å—Ç—É–ø –≤ –ª—é–±–æ–µ –≤—Ä–µ–º—è',
        migrationAndStats: '–ú–∏–≥—Ä–∞—Ü–∏—è –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞',
        fieldsFilled: '–ü–æ–ª–µ–π –∑–∞–ø–æ–ª–Ω–µ–Ω–æ',
        lastSync: '–ü–æ—Å–ª–µ–¥–Ω—è—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è',
        never: '–ù–∏–∫–æ–≥–¥–∞'
      },
      hints: {
        formatting: '–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: **–∂–∏—Ä–Ω—ã–π**, *–∫—É—Ä—Å–∏–≤*, ~~–∑–∞—á—ë—Ä–∫–Ω—É—Ç—ã–π~~, [—Ç–µ–∫—Å—Ç](url)',
        selectTextForFormatting: '–í—ã–¥–µ–ª–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è',
        nestedCategories: '–°–æ–∑–¥–∞–π—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö',
        separateTagsWithCommas: '–†–∞–∑–¥–µ–ª—è–π—Ç–µ —Ç–µ–≥–∏ –∑–∞–ø—è—Ç—ã–º–∏',
        tagsPlaceholder: '—Ç–µ–≥1, —Ç–µ–≥2, —Ç–µ–≥3',
        valuesPlaceholder: '–∑–Ω–∞—á–µ–Ω–∏–µ1, –∑–Ω–∞—á–µ–Ω–∏–µ2',
        iconPlaceholder: 'fa-folder',
        clientIdPlaceholder: '1234567890-abc123...'
      },
      emptyStates: {
        noFieldsInCategory: '–ù–µ—Ç –ø–æ–ª–µ–π –≤ —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏',
        clickAddFieldToCreate: '–ù–∞–∂–º–∏—Ç–µ "–î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ", —á—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–µ –ø–æ–ª–µ'
      },
      instructions: {
        goTo: '–ü–µ—Ä–µ–π–¥–∏—Ç–µ',
        click: '–ù–∞–∂–º–∏—Ç–µ',
        find: '–ù–∞–π–¥–∏—Ç–µ',
        yourDomain: '–≤–∞—à –¥–æ–º–µ–Ω',
        copyClientId: '–°–ö–û–ü–ò–†–£–ô–¢–ï'
      }
    },
    pl: {
      app: {
        title: 'Kartoteka ukochanej osoby (BETA)',
        filePrefix: 'kartoteka',
        spreadsheetTitle: 'Kartoteka'
      },
      ui: {
        localMode: 'Tryb lokalny',
        save: 'Zapisz',
        addField: 'Dodaj pole',
        more: 'Wiƒôcej',
        sync: 'Synchronizacja',
        export: 'Eksport',
        import: 'Import',
        clear: 'Wyczy≈õƒá',
        searchPlaceholder: 'Szukaj we wszystkich polach...',
        clearSearch: 'Wyczy≈õƒá wyszukiwanie',
        fillProgress: 'Postƒôp wype≈Çniania',
        selectCategory: 'Wybierz kategoriƒô',
        categories: 'Kategorie',
        addCategory: 'Dodaj kategoriƒô',
        selectCategoryLeft: 'Wybierz kategoriƒô po lewej',
        clickCategory: 'Kliknij kategoriƒô, aby zobaczyƒá pola',
        changeFilters: 'Spr√≥buj zmieniƒá filtry',
        modal: 'Okno modalne',
        close: 'Zamknij',
        cancel: 'Anuluj',
        storageMode: 'Tryb przechowywania',
        filled: 'Wype≈Çnione',
        empty: 'Puste',
        all: 'Wszystkie',
        high: 'Wysoki',
        medium: '≈öredni',
        low: 'Niski',
        filters: 'Filtry',
        importance: 'Wa≈ºno≈õƒá',
        edit: 'Edytuj',
        delete: 'Usu≈Ñ',
        addSubcategory: 'Dodaj podkategoriƒô',
        emptyValue: 'Nie wype≈Çniono',
        searchResults: 'wynik√≥w',
        searchResultsTitle: 'Wyniki wyszukiwania',
        noResults: 'Nie znaleziono wynik√≥w',
        changeSearchQuery: 'Spr√≥buj zmieniƒá zapytanie wyszukiwania',
        privateBadge: 'üîí Prywatna',
        of: 'z',
        fields: 'p√≥l',
        filledProgress: 'Wype≈Çniono',
        inCategory: 'w kategorii',
        manageCategories: 'ZarzƒÖdzaj kategoriami',
        values: 'Warto≈õci'
      },
      format: {
        bold: 'Pogrubienie (Ctrl+B)',
        italic: 'Kursywa (Ctrl+I)',
        strikethrough: 'Przekre≈õlenie',
        link: 'Link (Ctrl+K)',
        chip: 'Tag'
      },
      categories: {
        base: 'Informacje podstawowe',
        character: 'Charakter',
        preferences: 'Preferencje',
        antipreferences: 'Antypreferencje',
        gifts: 'Prezenty',
        psychology: 'Psychologia',
        psych: 'Cechy psychologiczne',
        logistics: 'Logistyka i codzienno≈õƒá',
        goals: 'Cele i marzenia',
        custom: 'Dodatkowe',
        communication: 'Komunikacja',
        finance: 'Finanse',
        intimacy: 'Intymno≈õƒá',
        family: 'Rodzina',
        career: 'Kariera',
        culture: 'Kultura'
      },
      fields: {
        fullName: 'Imiƒô i nazwisko',
        dob: 'Data urodzenia',
        character: 'Cechy charakteru',
        dreams: 'Marzenia i ≈ºyczenia',
        likes: 'Co lubi',
        memories: 'Wspomnienia',
        dislikes: 'Czego nie lubi',
        anti_triggers: 'Wyzwalacze i irytacje',
        anti_topics: 'Niewygodne tematy',
        anti_places: 'Nielubiane miejsca',
        anti_sounds: 'Nieprzyjemne d≈∫wiƒôki/zapachy',
        anti_situations: 'Niewygodne sytuacje',
        gift_wishlist: 'Lista ≈ºycze≈Ñ',
        gift_sizes: 'Rozmiary',
        gift_brands: 'Ulubione marki',
        gift_anti: 'Anty-prezenty',
        gift_history: 'Historia prezent√≥w',
        love_language: 'Jƒôzyk mi≈Ço≈õci',
        values: 'Podstawowe warto≈õci',
        psy_conflict_style: 'Styl zachowania w konfliktach',
        psy_compliments: 'Jak lubi otrzymywaƒá komplementy',
        psy_stress_relief: 'Sposoby radzenia sobie ze stresem',
        log_places: 'Ulubione miejsca',
        log_social_circle: 'KrƒÖg spo≈Çeczny',
        log_schedule_peak: 'Godziny szczytowej aktywno≈õci',
        log_media: 'Preferencje medialne',
        short_goals: 'Cele kr√≥tkoterminowe',
        goal_travel: 'Marzenia podr√≥≈ºnicze',
        goal_traditions: 'Tradycje do stworzenia',
        goal_cozy_ideal: 'Idealny przytulny wiecz√≥r',
        contact_phone: 'Telefon',
        contact_email: 'Email',
        city: 'Miasto / Lokalizacja',
        anniversary: 'Rocznica / Wa≈ºna data',
        attachment_style: 'Styl przywiƒÖzania',
        humor_style: 'Poczucie humoru',
        personal_boundaries: 'Granice osobiste',
        cuisines_fav: 'Ulubione kuchnie',
        allergies: 'Alergie / Wra≈ºliwo≈õci',
        aesthetics: 'Estetyka / Style',
        fav_colors: 'Ulubione kolory',
        anti_allergies: 'Zabronione z powodu alergii',
        anti_people_types: 'Trudne typy os√≥b',
        gift_price_range: 'Komfortowy bud≈ºet na prezent',
        gift_stores: 'Ulubione sklepy / Platformy',
        psy_anxiety_triggers: 'Wyzwalacze lƒôku',
        psy_motivators: 'Motywatory',
        psy_calming_words: 'S≈Çowa/frazy wsparcia',
        log_transport: 'Zwyk≈Çy transport',
        log_work_hours: 'Godziny pracy/nauki',
        log_routines: 'Codzienne rutyny',
        log_food_schedule: 'Harmonogram posi≈Çk√≥w',
        long_goals: 'Cele d≈Çugoterminowe',
        learning_topics: 'Chce siƒô nauczyƒá',
        bucket_list: 'Lista ≈ºycze≈Ñ',
        notes_private: 'Notatki osobiste',
        comm_style: 'Styl komunikacji',
        comm_frequency: 'Po≈ºƒÖdana czƒôstotliwo≈õƒá kontakt√≥w',
        comm_topics_good: 'Wygodne tematy',
        comm_topics_bad: 'Trudne tematy',
        comm_love_language: 'Jƒôzyk mi≈Ço≈õci w komunikacji',
        finance_habits: 'Nawyki finansowe',
        finance_attitude: 'Stosunek do pieniƒôdzy',
        finance_goals: 'Wsp√≥lne cele finansowe',
        finance_split: 'Podzia≈Ç wydatk√≥w',
        intimacy_language: 'Jƒôzyk intymno≈õci',
        intimacy_boundaries: 'Granice i komfort',
        intimacy_gestures: 'Romantyczne gesty',
        family_info: 'Informacje o rodzinie',
        family_important: 'Wa≈ºne osoby',
        family_traditions: 'Tradycje rodzinne',
        family_attitude: 'Stosunek do rodziny',
        career_goals: 'Cele zawodowe',
        career_schedule: 'Harmonogram pracy',
        career_dreams: 'Marzenia zawodowe',
        career_balance: 'R√≥wnowaga praca-≈ºycie',
        culture_religion: 'PoglƒÖdy religijne',
        culture_politics: 'Przekonania polityczne',
        culture_traditions: 'Tradycje kulturowe',
        culture_principles: 'Zasady ≈ºyciowe'
      },
      nested: {
        food: 'Jedzenie',
        activities: 'Dzia≈Çania',
        sweet: 'S≈Çodycze',
        drinks: 'Napoje',
        active: 'Aktywne',
        calm: 'Spokojne',
        tastes: 'Smaki',
        dishes: 'Potrawy',
        social: 'Spo≈Çeczne',
        personal: 'Osobiste',
        behaviors: 'Zachowanie',
        communication: 'Komunikacja',
        habits: 'Nawyki'
      },
      messages: {
        dataSaved: 'Dane zapisane',
        exported: 'Wyeksportowano',
        imported: 'Zaimportowano',
        invalidFile: 'Nieprawid≈Çowy format pliku',
        fileReadError: 'B≈ÇƒÖd odczytu pliku',
        dataCleared: 'Dane wyczyszczone',
        confirmClear: 'Czy na pewno chcesz wyczy≈õciƒá wszystkie dane? Ta akcja jest nieodwracalna!',
        confirmDeleteField: 'UsunƒÖƒá to pole?',
        fillAllFields: 'Wype≈Çnij wszystkie pola',
        syncing: 'Synchronizacja...',
        syncInitError: 'B≈ÇƒÖd inicjalizacji',
        enterClientId: 'Wprowad≈∫ Client ID',
        passwordMinLength: 'Has≈Ço musi mieƒá co najmniej 6 znak√≥w',
        passwordsNotMatch: 'Has≈Ça siƒô nie zgadzajƒÖ',
        settingsSaved: 'Ustawienia zapisane',
        enterUrl: 'Wprowad≈∫ URL:',
        connectionRestored: 'Po≈ÇƒÖczenie przywr√≥cone',
        offlineMode: 'Tryb offline',
        localSave: 'Dane zapisane lokalnie',
        showFilled: 'Pokazano: wype≈Çnione pola',
        showEmpty: 'Pokazano: puste pola',
        showAll: 'Pokazano: wszystkie pola',
        allImportance: 'Pokazano pola wszystkich poziom√≥w wa≈ºno≈õci',
        noFieldsWithFilters: 'Brak p√≥l z wybranymi filtrami',
        noFilledFields: 'Brak wype≈Çnionych p√≥l z wybranymi filtrami',
        noEmptyFields: 'Brak pustych p√≥l z wybranymi filtrami',
        noFieldsWithImportance: 'Brak p√≥l z wybranymi poziomami wa≈ºno≈õci',
        fieldExists: 'Pole o tym ID ju≈º istnieje',
        fieldUpdated: 'Pole zaktualizowane',
        fieldCreated: 'Pole utworzone',
        categoryExists: 'Kategoria o tym ID ju≈º istnieje',
        categoryUpdated: 'Kategoria zaktualizowana',
        categoryCreated: 'Kategoria utworzona',
        valueUpdated: 'Warto≈õƒá zaktualizowana',
        fieldDeleted: 'Pole usuniƒôte',
        passwordNotStored: 'Has≈Ço nie jest przechowywane!',
        writeItDown: 'Zapisz je w bezpiecznym miejscu.',
        noNestedCategories: 'Brak zagnie≈ºd≈ºonych kategorii',
        syncError: 'B≈ÇƒÖd synchronizacji',
        syncComplete: 'Synchronizacja zako≈Ñczona',
        needAuth: 'Wymagana autoryzacja Google',
        errorNotAuthorized: 'Nie autoryzowano',
        errorSpreadsheetIdNotSet: 'Spreadsheet ID nie ustawiono',
        errorDataNotFound: 'Nie znaleziono danych',
        errorDataEncrypted: 'Dane sƒÖ zaszyfrowane. Wprowad≈∫ has≈Ço, aby odszyfrowaƒá.',
        errorNotAuthorizedGoogle: 'Nie autoryzowano w Google',
        errorGoogleApiNotLoaded: 'Google API nie za≈Çadowano',
        errorGoogleIdentityNotLoaded: 'Google Identity Services nie za≈Çadowano',
        errorTokenClientNotInitialized: 'Token client nie zainicjalizowano'
      },
      modal: {
        confirmAction: 'Potwierdzenie',
        editField: 'Edytuj pole',
        newField: 'Nowe pole',
        editCategory: 'Edytuj kategoriƒô',
        newCategory: 'Nowa kategoria',
        syncSettings: 'Ustawienia synchronizacji',
        fieldId: 'ID pola',
        fieldName: 'Nazwa pola',
        type: 'Typ',
        importance: 'Wa≈ºno≈õƒá',
        category: 'Kategoria',
        required: 'Pole wymagane',
        password: 'Has≈Ço',
        confirmPassword: 'Potwierdzenie',
        editValue: 'Edytuj',
        categoryId: 'ID kategorii',
        categoryName: 'Nazwa kategorii',
        icon: 'Ikona (Font Awesome)',
        customCategoryNote: 'Zmiana nazwy w≈Çasnej kategorii zmienia jƒÖ dla wszystkich jƒôzyk√≥w',
        enterPassword: 'Wprowad≈∫ has≈Ço',
        confirmPasswordPlaceholder: 'Potwierd≈∫ has≈Ço'
      },
      types: {
        text: 'Tekst',
        textarea: 'Obszar tekstowy',
        date: 'Data',
        tags: 'Tagi',
        nested: 'Zagnie≈ºd≈ºone'
      },
      importance: {
        high: 'Wysoka',
        medium: '≈örednia',
        low: 'Niska',
        highPlural: 'Wysokie',
        mediumPlural: '≈örednie',
        lowPlural: 'Niskie',
        highShort: 'Wysoka',
        mediumShort: '≈örednia',
        lowShort: 'Niska'
      },
      tooltips: {
        menu: 'Menu',
        editValue: 'Edytuj warto≈õƒá',
        fieldSettings: 'Ustawienia pola',
        deleteField: 'Usu≈Ñ',
        changeLanguage: 'Zmie≈Ñ jƒôzyk'
      },
      fillStatus: {
        all: 'Wszystkie',
        filled: 'Wype≈Çnione',
        empty: 'Puste',
        filledness: 'Status wype≈Çnienia'
      },
      sync: {
        storageMode: 'Tryb przechowywania',
        localMode: 'üíæ Pamiƒôƒá lokalna',
        localModeDesc: 'Dane sƒÖ przechowywane w przeglƒÖdarce. Szybkie, ale dostƒôpne tylko z tego urzƒÖdzenia.',
        googleSheetsMode: '‚òÅÔ∏è Google Sheets',
        googleSheetsModeDesc: 'Synchronizacja z arkuszem Google. Dostƒôp z dowolnego urzƒÖdzenia, automatyczny zapis.',
        manualMode: 'üìÅ Pliki rƒôczne',
        manualModeDesc: 'Import/Eksport plik√≥w JSON. Pe≈Çna kontrola nad danymi.',
        googleSheetsSettings: 'Ustawienia Google Sheets',
        stepByStepInstructions: 'Instrukcje krok po kroku',
        step1: 'Krok 1: Google Cloud Console',
        step2: 'Krok 2: W≈ÇƒÖcz API',
        step3: 'Krok 3: Utw√≥rz klienta OAuth',
        projectName: 'Nazwa',
        clientId: 'Client ID',
        spreadsheetId: 'Spreadsheet ID',
        authorizeGoogle: 'Autoryzuj w Google',
        createSpreadsheet: 'Utw√≥rz arkusz',
        openSpreadsheet: 'Otw√≥rz arkusz',
        autoSync: 'Automatyczna synchronizacja',
        interval: 'Interwa≈Ç',
        encryption: 'Szyfrowanie danych (zalecane)',
        migrationData: 'Migracja danych',
        exportToSheets: 'Eksport Local ‚Üí Google Sheets',
        importFromSheets: 'Import Google Sheets ‚Üí Local',
        syncNow: 'Synchronizuj teraz',
        initializing: 'Inicjalizacja Google API...',
        authorized: 'Autoryzowano w Google',
        spreadsheetCreated: 'Arkusz utworzony!',
        openLink: 'Otw√≥rz',
        uploadingData: 'Przesy≈Çanie danych...',
        downloadingData: 'Pobieranie danych...',
        errorAuth: 'B≈ÇƒÖd autoryzacji',
        errorCreateSheet: 'B≈ÇƒÖd tworzenia arkusza',
        minute1: '1 minuta',
        minutes5: '5 minut',
        minutes15: '15 minut',
        minutes30: '30 minut',
        hour1: '1 godzina',
        securityTitle: 'O Twoim bezpiecze≈Ñstwie',
        securityItem1: 'Dane sƒÖ przechowywane w TWOIM arkuszu Google',
        securityItem2: 'My NIE mamy dostƒôpu do Twoich danych',
        securityItem3: 'Tokeny dostƒôpu tylko w Twojej przeglƒÖdarce',
        securityItem4: 'Z szyfrowaniem dane sƒÖ nieczytelne bez has≈Ça',
        securityItem5: 'Mo≈ºesz cofnƒÖƒá dostƒôp w ka≈ºdej chwili',
        migrationAndStats: 'Migracja i statystyki',
        fieldsFilled: 'Wype≈Çnionych p√≥l',
        lastSync: 'Ostatnia synchronizacja',
        never: 'Nigdy'
      },
      hints: {
        formatting: 'Formatowanie: **pogrubienie**, *kursywa*, ~~przekre≈õlenie~~, [tekst](url)',
        selectTextForFormatting: 'Zaznacz tekst, aby szybko formatowaƒá',
        nestedCategories: 'Utw√≥rz kategorie i podkategorie do uporzƒÖdkowanego przechowywania danych',
        separateTagsWithCommas: 'Rozdziel tagi przecinkami',
        tagsPlaceholder: 'tag1, tag2, tag3',
        valuesPlaceholder: 'warto≈õƒá1, warto≈õƒá2',
        iconPlaceholder: 'fa-folder',
        clientIdPlaceholder: '1234567890-abc123...'
      },
      emptyStates: {
        noFieldsInCategory: 'Brak p√≥l w tej kategorii',
        clickAddFieldToCreate: 'Kliknij "Dodaj pole", aby utworzyƒá nowe pole'
      },
      instructions: {
        goTo: 'Przejd≈∫ do',
        click: 'Kliknij',
        find: 'Znajd≈∫',
        yourDomain: 'tw√≥j domena',
        copyClientId: 'SKOPIUJ'
      }
    }
  };

  // ============= I18N SYSTEM =============
  const i18n = {
    currentLang: State.language,
    
    // Get translation by key path (e.g., 'ui.save')
    t(key, lang = null) {
      const language = lang || this.currentLang;
      const keys = key.split('.');
      let value = TRANSLATIONS[language];
      
      for (const k of keys) {
        if (value && value[k] !== undefined) {
          value = value[k];
        } else {
          // Fallback to Ukrainian if translation missing
          value = TRANSLATIONS['uk'];
          for (const fallbackKey of keys) {
            if (value && value[fallbackKey] !== undefined) {
              value = value[fallbackKey];
            } else {
              return key; // Return key if not found
            }
          }
        }
      }
      
      return value;
    },
    
    // Apply translations to all elements with data-i18n attributes
    applyTranslations() {
      // Update document lang attribute
      document.getElementById('htmlRoot').setAttribute('lang', this.currentLang);
      
      // Translate text content
      document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.getAttribute('data-i18n');
        el.textContent = this.t(key);
      });
      
      // Translate placeholders
      document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
        const key = el.getAttribute('data-i18n-placeholder');
        el.placeholder = this.t(key);
      });
      
      // Translate titles
      document.querySelectorAll('[data-i18n-title]').forEach(el => {
        const key = el.getAttribute('data-i18n-title');
        el.title = this.t(key);
      });
      
      // Update category labels if config is loaded
      if (State.config.categories && State.config.categories.length > 0) {
        State.config.categories = State.config.categories.map(cat => {
          // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω—É –Ω–∞–∑–≤—É –ø—Ä–∏ –ø–µ—Ä—à–æ–º—É –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ
          if (!cat.originalLabel) {
            cat.originalLabel = cat.label;
          }
          
          // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ —î –ø–µ—Ä–µ–∫–ª–∞–¥ –¥–ª—è —Ü—ñ—î—ó –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó
          const translationKey = `categories.${cat.id}`;
          const translated = this.t(translationKey);
          
          // –Ø–∫—â–æ –ø–µ—Ä–µ–∫–ª–∞–¥ –ø–æ–≤–µ—Ä—Ç–∞—î —Ç–æ–π —Å–∞–º–∏–π –∫–ª—é—á - –∑–Ω–∞—á–∏—Ç—å –ø–µ—Ä–µ–∫–ª–∞–¥—É –Ω–µ–º–∞—î
          // –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω—É –Ω–∞–∑–≤—É (–¥–ª—è –∫–∞—Å—Ç–æ–º–Ω–∏—Ö –∫–∞—Ç–µ–≥–æ—Ä—ñ–π)
          const label = translated === translationKey ? cat.originalLabel : translated;
          
          return {
            ...cat,
            label: label
          };
        });
      }
      
      // Update field labels if config is loaded
      if (State.config.fields && State.config.fields.length > 0) {
        State.config.fields = State.config.fields.map(field => {
          // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω—É –Ω–∞–∑–≤—É –ø—Ä–∏ –ø–µ—Ä—à–æ–º—É –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ
          if (!field.originalLabel) {
            field.originalLabel = field.label;
          }
          
          // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ —î –ø–µ—Ä–µ–∫–ª–∞–¥ –¥–ª—è —Ü—å–æ–≥–æ –ø–æ–ª—è
          const translationKey = `fields.${field.id}`;
          const translated = this.t(translationKey);
          
          // –Ø–∫—â–æ –ø–µ—Ä–µ–∫–ª–∞–¥ –ø–æ–≤–µ—Ä—Ç–∞—î —Ç–æ–π —Å–∞–º–∏–π –∫–ª—é—á - –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ originalLabel
          let label = translated === translationKey ? field.originalLabel : translated;
          
          // –¢–∞–∫–æ–∂ –ø–µ—Ä–µ–∫–ª–∞–¥–∞—î–º–æ nested categories —ñ subcategories
          if (field.type === 'nested' && field.nestedCategories) {
            field.nestedCategories = field.nestedCategories.map(nestedCat => {
              const nestedTranslated = this.t(`nested.${nestedCat.id}`);
              const nestedLabel = nestedTranslated === `nested.${nestedCat.id}` ? nestedCat.label : nestedTranslated;
              
              return {
                ...nestedCat,
                label: nestedLabel,
                subcategories: nestedCat.subcategories ? nestedCat.subcategories.map(sub => {
                  const subTranslated = this.t(`nested.${sub.id}`);
                  const subLabel = subTranslated === `nested.${sub.id}` ? sub.label : subTranslated;
                  return {
                    ...sub,
                    label: subLabel
                  };
                }) : []
              };
            });
          }
          
          return {
            ...field,
            label: label
          };
        });
      }
    },
    
    // Change language
    setLanguage(lang) {
      if (TRANSLATIONS[lang]) {
        this.currentLang = lang;
        State.language = lang;
        localStorage.setItem('app_language', lang);
        this.applyTranslations();
        
        // Update language selector UI
        this.updateLanguageUI();
        
        // Re-render current view to apply translations
        Renderer.renderCategories();
        Renderer.renderContent();
        Progress.update(); // –û–Ω–æ–≤–ª—é—î–º–æ –ø—Ä–æ–≥—Ä–µ—Å –±–∞—Ä –∑ –Ω–æ–≤–æ—é –º–æ–≤–æ—é
      }
    },
    
    // Update language selector UI
    updateLanguageUI() {
      // Update checkmarks and find current language flag
      document.querySelectorAll('#languageDropdown .language-option').forEach(opt => {
        const lang = opt.getAttribute('data-lang');
        const check = opt.querySelector('.language-check');
        check.style.visibility = lang === this.currentLang ? 'visible' : 'hidden';
        if (lang === this.currentLang) {
          opt.classList.add('selected');
          // Update current language flag SVG
          const flagSVG = opt.querySelector('.language-flag svg').cloneNode(true);
          const currentLangElement = document.getElementById('currentLanguage');
          currentLangElement.innerHTML = '';
          currentLangElement.appendChild(flagSVG);
        } else {
          opt.classList.remove('selected');
        }
      });
    }
  };

  // ============= DEFAULT CONFIG =============
  // üí° –ö–∞—Ç–µ–≥–æ—Ä—ñ—ó –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å i18n.t() - –±—É–¥—É—Ç—å –Ω–∞ –º–æ–≤—ñ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º –ø—Ä–∏ –¥–µ–∫–ª–∞—Ä–∞—Ü—ñ—ó,
  //    –∞–ª–µ applyTranslations() –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ–Ω–æ–≤–∏—Ç—å —ó—Ö –ø—Ä–∏ –∑–º—ñ–Ω—ñ –º–æ–≤–∏
  // üí° Fields –∑ —É–∫—Ä–∞—ó–Ω—Å—å–∫–∏–º–∏ label - —Ü–µ OK! originalLabel –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è —è–∫ fallback,
  //    –∞ applyTranslations() –∑–∞–º—ñ–Ω—é—î –Ω–∞ –ø–µ—Ä–µ–∫–ª–∞–¥ —á–µ—Ä–µ–∑ fields.${id} —è–∫—â–æ –≤—ñ–Ω —ñ—Å–Ω—É—î
  const DefaultConfig = {
    categories: [
      {id: 'base', label: i18n.t('categories.base'), icon: 'fa-id-card'},
      {id: 'character', label: i18n.t('categories.character'), icon: 'fa-brain'},
      {id: 'preferences', label: i18n.t('categories.preferences'), icon: 'fa-heart'},
      {id: 'antipreferences', label: i18n.t('categories.antipreferences'), icon: 'fa-heart-broken'},
      {id: 'gifts', label: i18n.t('categories.gifts'), icon: 'fa-gift'},
      {id: 'psychology', label: i18n.t('categories.psychology'), icon: 'fa-user-circle'},
      {id: 'psych', label: i18n.t('categories.psych'), icon: 'fa-brain'},
      {id: 'logistics', label: i18n.t('categories.logistics'), icon: 'fa-map-marked-alt'},
      {id: 'goals', label: i18n.t('categories.goals'), icon: 'fa-star'},
      {id: 'custom', label: i18n.t('categories.custom'), icon: 'fa-plus-circle'},
      {id: 'communication', label: i18n.t('categories.communication'), icon: 'fa-comments'},
      {id: 'finance', label: i18n.t('categories.finance'), icon: 'fa-wallet'},
      {id: 'intimacy', label: i18n.t('categories.intimacy'), icon: 'fa-heart', isPrivate: true},
      {id: 'family', label: i18n.t('categories.family'), icon: 'fa-users'},
      {id: 'career', label: i18n.t('categories.career'), icon: 'fa-briefcase'},
      {id: 'culture', label: i18n.t('categories.culture'), icon: 'fa-globe'}
    ],
    // Fields: —É–∫—Ä–∞—ó–Ω—Å—å–∫—ñ label —î –ü–†–ê–í–ò–õ–¨–ù–ò–ú —Ä—ñ—à–µ–Ω–Ω—è–º!
    // –ü—Ä–∏—á–∏–Ω–∏:
    // 1. originalLabel –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –ø—Ä–∏ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó –¥–ª—è –∫–∞—Å—Ç–æ–º–Ω–∏—Ö –ø–æ–ª—ñ–≤
    // 2. –î–µ—Ñ–æ–ª—Ç–Ω—ñ –ø–æ–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø–µ—Ä–µ–∫–ª–∞–¥–∞—é—Ç—å—Å—è —á–µ—Ä–µ–∑ fields.${id}
    // 3. –ü—Ä–∏ –∑–º—ñ–Ω—ñ –º–æ–≤–∏ applyTranslations() –æ–Ω–æ–≤–ª—é—î –≤—Å—ñ label
    // 4. –¶–µ –¥–æ–∑–≤–æ–ª—è—î –ª–µ–≥–∫–æ —Ä–æ–∑—Ä—ñ–∑–Ω—è—Ç–∏ –¥–µ—Ñ–æ–ª—Ç–Ω—ñ —Ç–∞ –∫–∞—Å—Ç–æ–º–Ω—ñ –ø–æ–ª—è
    fields: [
      {id: 'fullName', label: '–ü–Ü–ë', type: 'text', category: 'base', importance: 'high', required: true},
      {id: 'dob', label: '–î–∞—Ç–∞ –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è', type: 'date', category: 'base', importance: 'high'},
      {id: 'character', label: '–û—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ —Ö–∞—Ä–∞–∫—Ç–µ—Ä—É', type: 'textarea', category: 'character', importance: 'high'},
      {id: 'dreams', label: '–ú—Ä—ñ—ó —Ç–∞ –±–∞–∂–∞–Ω–Ω—è', type: 'textarea', category: 'character', importance: 'medium'},
      {id: 'likes', label: '–©–æ –ª—é–±–∏—Ç—å', type: 'nested', category: 'preferences', importance: 'high',
        nestedCategories: [
          {id: 'food', label: '–á–∂–∞', subcategories: [
            {id: 'sweet', label: '–°–æ–ª–æ–¥–∫–µ'},
            {id: 'drinks', label: '–ù–∞–ø–æ—ó'}
          ]},
          {id: 'activities', label: '–ó–∞–Ω—è—Ç—Ç—è', subcategories: [
            {id: 'active', label: '–ê–∫—Ç–∏–≤–Ω—ñ'},
            {id: 'calm', label: '–°–ø–æ–∫—ñ–π–Ω—ñ'}
          ]}
        ]
      },
      {id: 'memories', label: '–ü–∞–º\'—è—Ç—å —ñ —Å–ø–æ–≥–∞–¥–∏', type: 'textarea', category: 'character', importance: 'high'},
      {id: 'dislikes', label: '–©–æ –Ω–µ –ª—é–±–∏—Ç—å', type: 'nested', category: 'antipreferences', importance: 'high',
        nestedCategories: [
          {id: 'food', label: '–á–∂–∞', subcategories: [
            {id: 'tastes', label: '–°–º–∞–∫–∏'},
            {id: 'dishes', label: '–°—Ç—Ä–∞–≤–∏'}
          ]},
          {id: 'activities', label: '–ó–∞–Ω—è—Ç—Ç—è', subcategories: [
            {id: 'social', label: '–°–æ—Ü—ñ–∞–ª—å–Ω—ñ'},
            {id: 'personal', label: '–û—Å–æ–±–∏—Å—Ç—ñ'}
          ]},
          {id: 'behaviors', label: '–ü–æ–≤–µ–¥—ñ–Ω–∫–∞', subcategories: [
            {id: 'communication', label: '–°–ø—ñ–ª–∫—É–≤–∞–Ω–Ω—è'},
            {id: 'habits', label: '–ó–≤–∏—á–∫–∏'}
          ]}
        ]
      },
      {id: 'anti_triggers', label: '–¢—Ä–∏–≥–µ—Ä–∏ —Ç–∞ —Ä–æ–∑–¥—Ä–∞—Ç—É–≤–∞–Ω–Ω—è', type: 'tags', category: 'antipreferences', importance: 'high'},
      {id: 'anti_topics', label: '–ù–µ–ø—Ä–∏—î–º–Ω—ñ —Ç–µ–º–∏ –¥–ª—è —Ä–æ–∑–º–æ–≤', type: 'tags', category: 'antipreferences', importance: 'medium'},
      {id: 'anti_places', label: '–ú—ñ—Å—Ü—è, —è–∫—ñ –Ω–µ –ø–æ–¥–æ–±–∞—é—Ç—å—Å—è', type: 'tags', category: 'antipreferences', importance: 'medium'},
      {id: 'anti_sounds', label: '–ù–µ–ø—Ä–∏—î–º–Ω—ñ –∑–≤—É–∫–∏/–∑–∞–ø–∞—Ö–∏', type: 'tags', category: 'antipreferences', importance: 'low'},
      {id: 'anti_situations', label: '–ù–µ–∫–æ–º—Ñ–æ—Ä—Ç–Ω—ñ —Å–∏—Ç—É–∞—Ü—ñ—ó', type: 'textarea', category: 'antipreferences', importance: 'medium'},
      {id: 'gift_wishlist', label: '–°–ø–∏—Å–æ–∫ –±–∞–∂–∞–Ω—å', type: 'tags', category: 'gifts', importance: 'high'},
      {id: 'gift_sizes', label: '–†–æ–∑–º—ñ—Ä–∏', type: 'text', category: 'gifts', importance: 'medium'},
      {id: 'gift_brands', label: '–£–ª—é–±–ª–µ–Ω—ñ –±—Ä–µ–Ω–¥–∏', type: 'tags', category: 'gifts', importance: 'medium'},
      {id: 'gift_anti', label: '–ê–Ω—Ç–∏–ø–æ–¥–∞—Ä—É–Ω–∫–∏', type: 'tags', category: 'gifts', importance: 'medium'},
      {id: 'gift_history', label: '–Ü—Å—Ç–æ—Ä—ñ—è –ø–æ–¥–∞—Ä—É–Ω–∫—ñ–≤', type: 'textarea', category: 'gifts', importance: 'low'},
      {id: 'love_language', label: '–ú–æ–≤–∞ –∫–æ—Ö–∞–Ω–Ω—è', type: 'text', category: 'psychology', importance: 'high'},
      {id: 'values', label: '–û—Å–Ω–æ–≤–Ω—ñ —Ü—ñ–Ω–Ω–æ—Å—Ç—ñ', type: 'tags', category: 'psychology', importance: 'high'},
      {id: 'psy_conflict_style', label: '–°—Ç–∏–ª—å –ø–æ–≤–µ–¥—ñ–Ω–∫–∏ –≤ –∫–æ–Ω—Ñ–ª—ñ–∫—Ç–∞—Ö', type: 'textarea', category: 'psych', importance: 'high'},
      {id: 'psy_compliments', label: '–Ø–∫ –ª—é–±–∏—Ç—å –æ—Ç—Ä–∏–º—É–≤–∞—Ç–∏ –∫–æ–º–ø–ª—ñ–º–µ–Ω—Ç–∏', type: 'textarea', category: 'psych', importance: 'medium'},
      {id: 'psy_stress_relief', label: '–°–ø–æ—Å–æ–±–∏ –∑–Ω—è—Ç—Ç—è —Å—Ç—Ä–µ—Å—É', type: 'tags', category: 'psych', importance: 'high'},
      {id: 'log_places', label: '–£–ª—é–±–ª–µ–Ω—ñ –º—ñ—Å—Ü—è', type: 'tags', category: 'logistics', importance: 'medium'},
      {id: 'log_social_circle', label: '–°–æ—Ü—ñ–∞–ª—å–Ω–µ –∫–æ–ª–æ', type: 'textarea', category: 'logistics', importance: 'medium'},
      {id: 'log_schedule_peak', label: '–ü—ñ–∫–æ–≤—ñ –≥–æ–¥–∏–Ω–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ', type: 'text', category: 'logistics', importance: 'low'},
      {id: 'log_media', label: '–ú–µ–¥—ñ–∞ –≤–ø–æ–¥–æ–±–∞–Ω–Ω—è', type: 'tags', category: 'logistics', importance: 'low'},
      {id: 'short_goals', label: '–ö–æ—Ä–æ—Ç–∫–æ—Å—Ç—Ä–æ–∫–æ–≤—ñ —Ü—ñ–ª—ñ', type: 'tags', category: 'goals', importance: 'high'},
      {id: 'goal_travel', label: '–ú—Ä—ñ—ó –ø—Ä–æ –ø–æ–¥–æ—Ä–æ–∂—ñ', type: 'tags', category: 'goals', importance: 'medium'},
      {id: 'goal_traditions', label: '–¢—Ä–∞–¥–∏—Ü—ñ—ó, —è–∫—ñ —Ö–æ—á–µ —Å—Ç–≤–æ—Ä–∏—Ç–∏', type: 'textarea', category: 'goals', importance: 'medium'},
      {id: 'goal_cozy_ideal', label: '–Ü–¥–µ–∞–ª—å–Ω–∏–π –∑–∞—Ç–∏—à–Ω–∏–π –≤–µ—á—ñ—Ä', type: 'textarea', category: 'goals', importance: 'low'},

      // ===== Base: –∫–æ–Ω—Ç–∞–∫—Ç–∏ —Ç–∞ –±–∞–∑–æ–≤—ñ –¥–µ—Ç–∞–ª—ñ =====
      {id: 'contact_phone', label: '–¢–µ–ª–µ—Ñ–æ–Ω', type: 'text', category: 'base', importance: 'high'},
      {id: 'contact_email', label: 'Email', type: 'text', category: 'base', importance: 'medium'},
      {id: 'city', label: '–ú—ñ—Å—Ç–æ / –õ–æ–∫–∞—Ü—ñ—è', type: 'text', category: 'base', importance: 'medium'},
      {id: 'anniversary', label: '–†—ñ—á–Ω–∏—Ü—è / –í–∞–∂–ª–∏–≤–∞ –¥–∞—Ç–∞', type: 'date', category: 'base', importance: 'medium'},

      // ===== Character: –≥–ª–∏–±—à—ñ —Ä–∏—Å–∏ =====
      {id: 'attachment_style', label: '–°—Ç–∏–ª—å –ø—Ä–∏—Ö–∏–ª—å–Ω–æ—Å—Ç—ñ', type: 'text', category: 'character', importance: 'medium'},
      {id: 'humor_style', label: '–ü–æ—á—É—Ç—Ç—è –≥—É–º–æ—Ä—É', type: 'tags', category: 'character', importance: 'low'},
      {id: 'personal_boundaries', label: '–û—Å–æ–±–∏—Å—Ç—ñ –∫–æ—Ä–¥–æ–Ω–∏', type: 'textarea', category: 'character', importance: 'high'},

      // ===== Preferences: —Ä–æ–∑—à–∏—Ä–µ–Ω—ñ =====
      {id: 'cuisines_fav', label: '–£–ª—é–±–ª–µ–Ω—ñ –∫—É—Ö–Ω—ñ', type: 'tags', category: 'preferences', importance: 'medium'},
      {id: 'allergies', label: '–ê–ª–µ—Ä–≥—ñ—ó / –ß—É—Ç–ª–∏–≤–æ—Å—Ç—ñ', type: 'tags', category: 'preferences', importance: 'high'},
      {id: 'aesthetics', label: '–ï—Å—Ç–µ—Ç–∏–∫–∏ / –°—Ç–∏–ª—ñ', type: 'tags', category: 'preferences', importance: 'medium'},
      {id: 'fav_colors', label: '–£–ª—é–±–ª–µ–Ω—ñ –∫–æ–ª—å–æ—Ä–∏', type: 'tags', category: 'preferences', importance: 'low'},

      // ===== Anti-preferences: —Ä–æ–∑—à–∏—Ä–µ–Ω—ñ =====
      {id: 'anti_allergies', label: '–ó–∞–±–æ—Ä–æ–Ω–µ–Ω—ñ —á–µ—Ä–µ–∑ –∞–ª–µ—Ä–≥—ñ—ó', type: 'tags', category: 'antipreferences', importance: 'high'},
      {id: 'anti_people_types', label: '–¢–∏–ø–∏ –ª—é–¥–µ–π, –∑ —è–∫–∏–º–∏ –≤–∞–∂–∫–æ', type: 'tags', category: 'antipreferences', importance: 'medium'},

      // ===== Gifts: –¥–æ–¥–∞—Ç–∫–æ–≤—ñ —ñ–¥–µ—ó =====
      {id: 'gift_price_range', label: '–ö–æ–º—Ñ–æ—Ä—Ç–Ω–∏–π –±—é–¥–∂–µ—Ç –ø–æ–¥–∞—Ä—É–Ω–∫—ñ–≤', type: 'text', category: 'gifts', importance: 'low'},
      {id: 'gift_stores', label: '–£–ª—é–±–ª–µ–Ω—ñ –º–∞–≥–∞–∑–∏–Ω–∏ / –ø–ª–∞—Ç—Ñ–æ—Ä–º–∏', type: 'tags', category: 'gifts', importance: 'low'},

      // ===== Psych: –¥–µ—Ç–∞–ª—ñ–∑–∞—Ü—ñ—è –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ =====
      {id: 'psy_anxiety_triggers', label: '–¢—Ä–∏–≥–µ—Ä–∏ —Ç—Ä–∏–≤–æ–≥–∏', type: 'tags', category: 'psych', importance: 'high'},
      {id: 'psy_motivators', label: '–©–æ –º–æ—Ç–∏–≤—É—î', type: 'tags', category: 'psych', importance: 'medium'},
      {id: 'psy_calming_words', label: '–°–ª–æ–≤–∞/—Ñ—Ä–∞–∑–∏ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏', type: 'tags', category: 'psych', importance: 'medium'},

      // ===== Logistics: —Ä—É—Ç–∏–Ω–∏ —Ç–∞ –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—è =====
      {id: 'log_transport', label: '–ó–≤–∏—á–Ω–∏–π —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç', type: 'tags', category: 'logistics', importance: 'low'},
      {id: 'log_work_hours', label: '–ì–æ–¥–∏–Ω–∏ —Ä–æ–±–æ—Ç–∏/–Ω–∞–≤—á–∞–Ω–Ω—è', type: 'text', category: 'logistics', importance: 'medium'},
      {id: 'log_routines', label: '–©–æ–¥–µ–Ω–Ω—ñ —Ä—É—Ç–∏–Ω–∏', type: 'textarea', category: 'logistics', importance: 'medium'},
      {id: 'log_food_schedule', label: '–•–∞—Ä—á–æ–≤–∏–π —Ä–µ–∂–∏–º', type: 'text', category: 'logistics', importance: 'low'},

      // ===== Goals: –¥–æ–≤–≥–æ—Å—Ç—Ä–æ–∫–æ–≤—ñ —Ç–∞ —Ü—ñ–∫–∞–≤—ñ –Ω–∞–ø—Ä—è–º–∫–∏ =====
      {id: 'long_goals', label: '–î–æ–≤–≥–æ—Å—Ç—Ä–æ–∫–æ–≤—ñ —Ü—ñ–ª—ñ', type: 'tags', category: 'goals', importance: 'high'},
      {id: 'learning_topics', label: '–©–æ —Ö–æ—á–µ –≤–∏–≤—á–∏—Ç–∏', type: 'tags', category: 'goals', importance: 'medium'},
      {id: 'bucket_list', label: 'Bucket list', type: 'tags', category: 'goals', importance: 'medium'},

      // ===== Custom: –≤—ñ–ª—å–Ω—ñ –Ω–æ—Ç–∞—Ç–∫–∏ =====
      {id: 'notes_private', label: '–û—Å–æ–±–∏—Å—Ç—ñ –Ω–æ—Ç–∞—Ç–∫–∏', type: 'textarea', category: 'custom', importance: 'low'},

      // ===== Communication: —Å—Ç–∏–ª—å —Å–ø—ñ–ª–∫—É–≤–∞–Ω–Ω—è =====
      {id: 'comm_style', label: '–°—Ç–∏–ª—å —Å–ø—ñ–ª–∫—É–≤–∞–Ω–Ω—è', type: 'tags', category: 'communication', importance: 'high'},
      {id: 'comm_frequency', label: '–ß–∞—Å—Ç–æ—Ç–∞ –±–∞–∂–∞–Ω–æ–≥–æ –∫–æ–Ω—Ç–∞–∫—Ç—É', type: 'text', category: 'communication', importance: 'medium'},
      {id: 'comm_topics_good', label: '–ö–æ–º—Ñ–æ—Ä—Ç–Ω—ñ —Ç–µ–º–∏', type: 'tags', category: 'communication', importance: 'medium'},
      {id: 'comm_topics_bad', label: '–°–∫–ª–∞–¥–Ω—ñ —Ç–µ–º–∏', type: 'tags', category: 'communication', importance: 'high'},
      {id: 'comm_love_language', label: '–ú–æ–≤–∞ –ª—é–±–æ–≤—ñ –≤ –∫–æ–º—É–Ω—ñ–∫–∞—Ü—ñ—ó', type: 'text', category: 'communication', importance: 'high'},

      // ===== Finance: —Ñ—ñ–Ω–∞–Ω—Å–æ–≤—ñ –∑–≤–∏—á–∫–∏ =====
      {id: 'finance_habits', label: '–§—ñ–Ω–∞–Ω—Å–æ–≤—ñ –∑–≤–∏—á–∫–∏', type: 'textarea', category: 'finance', importance: 'medium'},
      {id: 'finance_attitude', label: '–°—Ç–∞–≤–ª–µ–Ω–Ω—è –¥–æ –≥—Ä–æ—à–µ–π', type: 'textarea', category: 'finance', importance: 'medium'},
      {id: 'finance_goals', label: '–°–ø—ñ–ª—å–Ω—ñ —Ñ—ñ–Ω–∞–Ω—Å–æ–≤—ñ —Ü—ñ–ª—ñ', type: 'tags', category: 'finance', importance: 'high'},
      {id: 'finance_split', label: '–†–æ–∑–ø–æ–¥—ñ–ª –≤–∏—Ç—Ä–∞—Ç', type: 'text', category: 'finance', importance: 'medium'},

      // ===== Intimacy: —ñ–Ω—Ç–∏–º–Ω—ñ—Å—Ç—å (–ü–†–ò–í–ê–¢–ù–ê) =====
      {id: 'intimacy_language', label: '–ú–æ–≤–∞ —ñ–Ω—Ç–∏–º–Ω–æ—Å—Ç—ñ', type: 'textarea', category: 'intimacy', importance: 'high'},
      {id: 'intimacy_boundaries', label: 'Boundaries —Ç–∞ –∫–æ–º—Ñ–æ—Ä—Ç', type: 'textarea', category: 'intimacy', importance: 'high'},
      {id: 'intimacy_gestures', label: '–†–æ–º–∞–Ω—Ç–∏—á–Ω—ñ –∂–µ—Å—Ç–∏', type: 'tags', category: 'intimacy', importance: 'medium'},

      // ===== Family: —Å—ñ–º'—è —Ç–∞ —Ä–æ–¥–∏–Ω–Ω—ñ –∑–≤'—è–∑–∫–∏ =====
      {id: 'family_info', label: '–Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ —Ä–æ–¥–∏–Ω—É', type: 'textarea', category: 'family', importance: 'medium'},
      {id: 'family_important', label: '–í–∞–∂–ª–∏–≤—ñ –ª—é–¥–∏', type: 'tags', category: 'family', importance: 'high'},
      {id: 'family_traditions', label: '–°—ñ–º–µ–π–Ω—ñ —Ç—Ä–∞–¥–∏—Ü—ñ—ó', type: 'tags', category: 'family', importance: 'medium'},
      {id: 'family_attitude', label: '–°—Ç–∞–≤–ª–µ–Ω–Ω—è –¥–æ —Ä–æ–¥–∏–Ω–∏', type: 'textarea', category: 'family', importance: 'medium'},

      // ===== Career: –∫–∞—Ä'—î—Ä–∞ —Ç–∞ –ø—Ä–æ—Ñ–µ—Å—ñ–π–Ω—ñ —Ü—ñ–ª—ñ =====
      {id: 'career_goals', label: '–ü—Ä–æ—Ñ–µ—Å—ñ–π–Ω—ñ —Ü—ñ–ª—ñ', type: 'tags', category: 'career', importance: 'medium'},
      {id: 'career_schedule', label: '–†–æ–±–æ—á–∏–π –≥—Ä–∞—Ñ—ñ–∫', type: 'text', category: 'career', importance: 'low'},
      {id: 'career_dreams', label: '–ö–∞—Ä\'—î—Ä–Ω—ñ –º—Ä—ñ—ó', type: 'textarea', category: 'career', importance: 'medium'},
      {id: 'career_balance', label: 'Work-life balance', type: 'textarea', category: 'career', importance: 'medium'},

      // ===== Culture: –∫—É–ª—å—Ç—É—Ä–∞ —Ç–∞ –ø—Ä–∏–Ω—Ü–∏–ø–∏ =====
      {id: 'culture_religion', label: '–†–µ–ª—ñ–≥—ñ–π–Ω—ñ –ø–æ–≥–ª—è–¥–∏', type: 'text', category: 'culture', importance: 'medium'},
      {id: 'culture_politics', label: '–ü–æ–ª—ñ—Ç–∏—á–Ω—ñ –ø–µ—Ä–µ–∫–æ–Ω–∞–Ω–Ω—è', type: 'text', category: 'culture', importance: 'low'},
      {id: 'culture_traditions', label: '–ö—É–ª—å—Ç—É—Ä–Ω—ñ —Ç—Ä–∞–¥–∏—Ü—ñ—ó', type: 'tags', category: 'culture', importance: 'medium'},
      {id: 'culture_principles', label: '–ñ–∏—Ç—Ç—î–≤—ñ –ø—Ä–∏–Ω—Ü–∏–ø–∏', type: 'textarea', category: 'culture', importance: 'high'}
    ],
    values: {
      fullName: '–Ü–≤–∞–Ω–Ω–∞ –ü–µ—Ç—Ä–µ–Ω–∫–æ',
      dob: '1994-07-08',
      character: '–¢–∏—Ö–∞, —É–≤–∞–∂–Ω–∞, –≤—Ä–∞–∑–ª–∏–≤–∞, –∞–ª–µ —Ä—ñ—à—É—á–∞.',
      likes: {
        food: {
          sweet: ['—à–æ–∫–æ–ª–∞–¥', '—Ç—ñ—Ä–∞–º—ñ—Å—É'],
          drinks: ['–º–∞—Ç—á–∞']
        },
        activities: {
          active: ['–≤–µ–ª–æ—Å–ø–æ—Ä—Ç'],
          calm: ['—á–∏—Ç–∞–Ω–Ω—è']
        }
      }
    }
  };

  // ============= GOOGLE SHEETS SYNC =============
  const GoogleSheetsSync = {
    // –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è API
    config: {
      apiKey: null,
      clientId: null,
      spreadsheetId: null,
      scopes: 'https://www.googleapis.com/auth/spreadsheets',
      discoveryDocs: ['https://sheets.googleapis.com/$discovery/rest?version=v4']
    },
    
    // OAuth —Ç–æ–∫–µ–Ω –∫–ª—ñ—î–Ω—Ç
    tokenClient: null,
    accessToken: null,
    gapiInitialized: false,
    gisInitialized: false,
    
    // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è GAPI
    async initGapi() {
      return new Promise((resolve, reject) => {
        if (this.gapiInitialized) {
          resolve();
          return;
        }
        
        if (typeof gapi === 'undefined') {
          reject(new Error(i18n.t('messages.errorGoogleApiNotLoaded')));
          return;
        }
        
        gapi.load('client', async () => {
          try {
            await gapi.client.init({
              discoveryDocs: this.config.discoveryDocs,
            });
            this.gapiInitialized = true;
            resolve();
          } catch (error) {
            reject(error);
          }
        });
      });
    },
    
    // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è GIS (Google Identity Services)
    initGis(clientId) {
      return new Promise((resolve, reject) => {
        if (this.gisInitialized && this.config.clientId === clientId) {
          resolve();
          return;
        }
        
        if (typeof google === 'undefined') {
          reject(new Error(i18n.t('messages.errorGoogleIdentityNotLoaded')));
          return;
        }
        
        this.config.clientId = clientId;
        
        this.tokenClient = google.accounts.oauth2.initTokenClient({
          client_id: clientId,
          scope: this.config.scopes,
          callback: '', // –ë—É–¥–µ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –ø—ñ–∑–Ω—ñ—à–µ
        });
        
        this.gisInitialized = true;
        resolve();
      });
    },
    
    // OAuth –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è
    async authorize() {
      return new Promise((resolve, reject) => {
        if (!this.tokenClient) {
          reject(new Error(i18n.t('messages.errorTokenClientNotInitialized')));
          return;
        }
        
        this.tokenClient.callback = async (response) => {
          if (response.error !== undefined) {
            reject(response);
            return;
          }
          
          this.accessToken = response.access_token;
          // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –≤ sessionStorage (–ù–ï –≤ localStorage –¥–ª—è –±–µ–∑–ø–µ–∫–∏)
          sessionStorage.setItem('gapi_token', response.access_token);
          resolve(response);
        };
        
        // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ —î —Ç–æ–∫–µ–Ω –≤ sessionStorage
        const savedToken = sessionStorage.getItem('gapi_token');
        if (savedToken) {
          this.accessToken = savedToken;
          gapi.client.setToken({ access_token: savedToken });
          resolve({ access_token: savedToken });
        } else {
          // –ó–∞–ø–∏—Ç—É—î–º–æ –Ω–æ–≤–∏–π —Ç–æ–∫–µ–Ω
          this.tokenClient.requestAccessToken({ prompt: 'consent' });
        }
      });
    },
    
    // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó
    isAuthorized() {
      return this.accessToken !== null && gapi.client.getToken() !== null;
    },
    
    // –í—ñ–¥–∫–ª–∏–∫–∞—Ç–∏ –¥–æ—Å—Ç—É–ø
    revokeAccess() {
      const token = gapi.client.getToken();
      if (token !== null) {
        google.accounts.oauth2.revoke(token.access_token);
        gapi.client.setToken(null);
      }
      this.accessToken = null;
      sessionStorage.removeItem('gapi_token');
    },
    
    // –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–æ–≤–æ—ó —Ç–∞–±–ª–∏—Ü—ñ (–û–ü–¢–ò–ú–Ü–ó–û–í–ê–ù–û - 1 –ª–∏—Å—Ç!)
    async createSpreadsheet() {
      if (!this.isAuthorized()) {
        throw new Error(i18n.t('messages.errorNotAuthorized'));
      }
      
      const date = new Date().toISOString().split('T')[0];
      const title = `${i18n.t('app.spreadsheetTitle')} - ${date}`;
      
      try {
        const response = await gapi.client.sheets.spreadsheets.create({
          properties: {
            title: title
          },
          sheets: [
            { 
              properties: { 
                title: 'Data', 
                gridProperties: { frozenRowCount: 1 } 
              } 
            }
          ]
        });
        
        const spreadsheetId = response.result.spreadsheetId;
        this.config.spreadsheetId = spreadsheetId;
        
        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É—î–º–æ —Å—Ç—Ä—É–∫—Ç—É—Ä—É
        await this.initializeStructure(spreadsheetId);
        
        return {
          spreadsheetId: spreadsheetId,
          url: `https://docs.google.com/spreadsheets/d/${spreadsheetId}`
        };
      } catch (error) {
        console.error('–ü–æ–º–∏–ª–∫–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç–∞–±–ª–∏—Ü—ñ:', error);
        throw error;
      }
    },
    
    // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ —Ç–∞–±–ª–∏—Ü—ñ (–û–ü–¢–ò–ú–Ü–ó–û–í–ê–ù–û - 1 –ª–∏—Å—Ç!)
    async initializeStructure(spreadsheetId) {
      try {
        // –°—Ç–≤–æ—Ä—é—î–º–æ headers –¥–ª—è Data –ª–∏—Å—Ç–∞
        await gapi.client.sheets.spreadsheets.values.update({
          spreadsheetId: spreadsheetId,
          range: 'Data!A1:B1',
          valueInputOption: 'RAW',
          resource: {
            values: [['key', 'value']]
          }
        });
      } catch (error) {
        console.error('–ü–æ–º–∏–ª–∫–∞ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó —Å—Ç—Ä—É–∫—Ç—É—Ä–∏:', error);
        throw error;
      }
    },
    
    // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö —É Google Sheets (–û–ü–¢–ò–ú–Ü–ó–û–í–ê–ù–û - 1 –∑–∞–ø–∏—Ç!)
    async uploadData(config, values, encryptionPassword = null) {
      if (!this.isAuthorized()) {
        throw new Error(i18n.t('messages.errorNotAuthorized'));
      }
      
      const spreadsheetId = this.config.spreadsheetId;
      if (!spreadsheetId) {
        throw new Error(i18n.t('messages.errorSpreadsheetIdNotSet'));
      }
      
      try {
        const timestamp = new Date().toISOString();
        
        // –ì–æ—Ç—É—î–º–æ –≤–µ—Å—å payload –≤ –æ–¥–∏–Ω –æ–±'—î–∫—Ç
        const payload = {
          config: config,
          values: values,
          version: '2.0',
          lastSync: timestamp
        };
        
        let dataStr = JSON.stringify(payload);
        let encrypted = false;
        let salt = '';
        let iv = '';
        
        // –®–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ
        if (encryptionPassword) {
          const encryptedData = await this.encryption.encrypt(dataStr, encryptionPassword);
          dataStr = encryptedData.encrypted;
          encrypted = true;
          salt = encryptedData.salt;
          iv = encryptedData.iv;
        }
        
        // –í–°–Ü –¥–∞–Ω—ñ –≤ –û–î–ù–û–ú–£ –∑–∞–ø–∏—Ç—ñ!
        await gapi.client.sheets.spreadsheets.values.batchUpdate({
          spreadsheetId: spreadsheetId,
          resource: {
            valueInputOption: 'RAW',
            data: [
              {
                range: 'Data!A1:B5',
                values: [
                  ['key', 'value'],
                  ['data', dataStr],
                  ['encrypted', encrypted.toString()],
                  ['salt', salt],
                  ['iv', iv]
                ]
              }
            ]
          }
        });
        
        return { success: true, timestamp };
      } catch (error) {
        console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö:', error);
        throw error;
      }
    },
    
    // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö –∑ Google Sheets (–û–ü–¢–ò–ú–Ü–ó–û–í–ê–ù–û - 1 –∑–∞–ø–∏—Ç!)
    async downloadData(encryptionPassword = null) {
      if (!this.isAuthorized()) {
        throw new Error(i18n.t('messages.errorNotAuthorized'));
      }
      
      const spreadsheetId = this.config.spreadsheetId;
      if (!spreadsheetId) {
        throw new Error(i18n.t('messages.errorSpreadsheetIdNotSet'));
      }
      
      try {
        // –ß–∏—Ç–∞—î–º–æ –í–°–Ü –¥–∞–Ω—ñ –û–î–ù–ò–ú –∑–∞–ø–∏—Ç–æ–º!
        const response = await gapi.client.sheets.spreadsheets.values.get({
          spreadsheetId: spreadsheetId,
          range: 'Data!A1:B5'
        });
        
        const rows = response.result.values || [];
        
        // –ü–∞—Ä—Å–∏–º–æ –¥–∞–Ω—ñ (–ø—Ä–æ–ø—É—Å–∫–∞—î–º–æ header)
        let dataStr = '';
        let encrypted = false;
        let salt = '';
        let iv = '';
        
        for (let i = 1; i < rows.length; i++) {
          const [key, value] = rows[i];
          if (key === 'data') dataStr = value || '';
          if (key === 'encrypted') encrypted = value === 'true';
          if (key === 'salt') salt = value || '';
          if (key === 'iv') iv = value || '';
        }
        
        if (!dataStr) {
          throw new Error(i18n.t('messages.errorDataNotFound'));
        }
        
        // –î–µ—à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ
        if (encrypted && encryptionPassword) {
          dataStr = await this.encryption.decrypt(dataStr, encryptionPassword, salt, iv);
        } else if (encrypted && !encryptionPassword) {
          throw new Error(i18n.t('messages.errorDataEncrypted'));
        }
        
        // –ü–∞—Ä—Å–∏–º–æ JSON
        const payload = JSON.parse(dataStr);
        
        return {
          config: payload.config,
          values: payload.values,
          metadata: {
            version: payload.version,
            lastSync: payload.lastSync,
            encrypted: encrypted.toString()
          }
        };
      } catch (error) {
        console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö:', error);
        throw error;
      }
    },
    
    // –®–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è (AES-GCM)
    encryption: {
      // –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è –∫–ª—é—á–∞ –∑ –ø–∞—Ä–æ–ª—è
      async deriveKey(password, salt) {
        const encoder = new TextEncoder();
        const passwordBuffer = encoder.encode(password);
        const saltBuffer = typeof salt === 'string' ? 
          this.hexToBuffer(salt) : salt;
        
        const keyMaterial = await crypto.subtle.importKey(
          'raw',
          passwordBuffer,
          'PBKDF2',
          false,
          ['deriveBits', 'deriveKey']
        );
        
        return await crypto.subtle.deriveKey(
          {
            name: 'PBKDF2',
            salt: saltBuffer,
            iterations: 100000,
            hash: 'SHA-256'
          },
          keyMaterial,
          { name: 'AES-GCM', length: 256 },
          false,
          ['encrypt', 'decrypt']
        );
      },
      
      // –®–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è
      async encrypt(data, password) {
        const encoder = new TextEncoder();
        const dataBuffer = encoder.encode(data);
        
        // –ì–µ–Ω–µ—Ä—É—î–º–æ salt —Ç–∞ IV
        const salt = crypto.getRandomValues(new Uint8Array(16));
        const iv = crypto.getRandomValues(new Uint8Array(12));
        
        // –û—Ç—Ä–∏–º—É—î–º–æ –∫–ª—é—á
        const key = await this.deriveKey(password, salt);
        
        // –®–∏—Ñ—Ä—É—î–º–æ
        const encrypted = await crypto.subtle.encrypt(
          { name: 'AES-GCM', iv: iv },
          key,
          dataBuffer
        );
        
        return {
          encrypted: this.bufferToHex(new Uint8Array(encrypted)),
          iv: this.bufferToHex(iv),
          salt: this.bufferToHex(salt)
        };
      },
      
      // –î–µ—à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è
      async decrypt(encryptedHex, password, saltHex, ivHex) {
        const encryptedBuffer = this.hexToBuffer(encryptedHex);
        const iv = this.hexToBuffer(ivHex);
        
        // –û—Ç—Ä–∏–º—É—î–º–æ –∫–ª—é—á
        const key = await this.deriveKey(password, saltHex);
        
        // –î–µ—à–∏—Ñ—Ä—É—î–º–æ
        const decrypted = await crypto.subtle.decrypt(
          { name: 'AES-GCM', iv: iv },
          key,
          encryptedBuffer
        );
        
        const decoder = new TextDecoder();
        return decoder.decode(decrypted);
      },
      
      // –•–µ—à –ø–∞—Ä–æ–ª—è –¥–ª—è –≤–µ—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—ó
      async hashPassword(password) {
        const encoder = new TextEncoder();
        const data = encoder.encode(password);
        const hash = await crypto.subtle.digest('SHA-256', data);
        return this.bufferToHex(new Uint8Array(hash));
      },
      
      // Utilities
      bufferToHex(buffer) {
        return Array.from(buffer)
          .map(b => b.toString(16).padStart(2, '0'))
          .join('');
      },
      
      hexToBuffer(hex) {
        const bytes = new Uint8Array(hex.length / 2);
        for (let i = 0; i < hex.length; i += 2) {
          bytes[i / 2] = parseInt(hex.substr(i, 2), 16);
        }
        return bytes;
      }
    }
  };

  // ============= STORAGE =============
  const Storage = {
    key: 'love_dossier_v2',
    syncKey: 'love_dossier_sync_settings',
    
    // –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è (–≤—Ä–∞—Ö–æ–≤—É—î —Ä–µ–∂–∏–º —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó) + –û–ü–¢–ò–ú–Ü–ó–ê–¶–Ü–Ø
    async save() {
      const mode = State.sync.mode;
      
      // –ó–∞–≤–∂–¥–∏ –∑–±–µ—Ä—ñ–≥–∞—î–º–æ –≤ localStorage —è–∫ backup
      localStorage.setItem(this.key, JSON.stringify({
        config: State.config,
        values: State.values,
        savedAt: new Date().toISOString()
      }));
      
      // –Ø–∫—â–æ Google Sheets —Ä–µ–∂–∏–º - —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É—î–º–æ
      if (mode === 'googleSheets' && State.sync.googleSheets.enabled) {
        try {
          SyncManager.updateStatus('syncing', i18n.t('messages.syncing'));
          
          const password = State.sync.googleSheets.encryptionEnabled ? 
            sessionStorage.getItem('encryption_password') : null;
          
          await GoogleSheetsSync.uploadData(State.config, State.values, password);
          
          State.sync.googleSheets.lastSync = new Date().toISOString();
          this.saveSyncSettings();
          
          // –°–∫–∏–¥–∞—î–º–æ —Ñ–ª–∞–≥ –Ω–µ–∑–±–µ—Ä–µ–∂–µ–Ω–∏—Ö –∑–º—ñ–Ω
          SyncManager.hasUnsyncedChanges = false;
          
          SyncManager.updateStatus('synced', `${i18n.t('messages.syncComplete')} ${this.formatTime(new Date())}`);
          Toast.show('‚òÅÔ∏è ' + i18n.t('messages.syncComplete'));
        } catch (error) {
          console.error('Sync error:', error);
          State.sync.lastError = error.message;
          SyncManager.updateStatus('error', i18n.t('messages.syncError'));
          Toast.show('‚ùå ' + i18n.t('messages.syncError') + ': ' + error.message, 'error');
          
          // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –ª–æ–∫–∞–ª—å–Ω–æ —è–∫—â–æ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è –Ω–µ –≤–¥–∞–ª–∞—Å—å
          Toast.t('messages.localSave', 'warning');
        }
      } else {
        SyncManager.updateStatus('local', i18n.t('ui.localMode'));
      }
    },
    
    // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è (–≤—Ä–∞—Ö–æ–≤—É—î —Ä–µ–∂–∏–º —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó)
    async load() {
      const mode = State.sync.mode;
      
      // –Ø–∫—â–æ Google Sheets —Ä–µ–∂–∏–º
      if (mode === 'googleSheets' && State.sync.googleSheets.enabled) {
        try {
          if (!GoogleSheetsSync.isAuthorized()) {
            throw new Error(i18n.t('messages.errorNotAuthorizedGoogle'));
          }
          
          const password = State.sync.googleSheets.encryptionEnabled ? 
            sessionStorage.getItem('encryption_password') : null;
          
          const result = await GoogleSheetsSync.downloadData(password);
          Toast.t('messages.imported');
          return result;
        } catch (error) {
          console.error('Load from Google Sheets error:', error);
          Toast.t('messages.localSave', 'warning');
          // –ü–æ–≤–µ—Ä—Ç–∞—î–º–æ—Å—å –¥–æ localStorage
          return this.loadFromLocalStorage();
        }
      }
      
      // –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑ localStorage
      return this.loadFromLocalStorage();
    },
    
    // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑ localStorage
    loadFromLocalStorage() {
      try {
        const data = localStorage.getItem(this.key);
        if (!data) return null;
        return JSON.parse(data);
      } catch (e) {
        console.error('Error loading data:', e);
        return null;
      }
    },
    
    // –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó
    saveSyncSettings() {
      localStorage.setItem(this.syncKey, JSON.stringify({
        mode: State.sync.mode,
        googleSheets: {
          enabled: State.sync.googleSheets.enabled,
          clientId: State.sync.googleSheets.clientId,
          spreadsheetId: State.sync.googleSheets.spreadsheetId,
          lastSync: State.sync.googleSheets.lastSync,
          autoSyncEnabled: State.sync.googleSheets.autoSyncEnabled,
          autoSyncInterval: State.sync.googleSheets.autoSyncInterval,
          encryptionEnabled: State.sync.googleSheets.encryptionEnabled,
          encryptionPasswordHash: State.sync.googleSheets.encryptionPasswordHash
        }
      }));
    },
    
    // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó
    loadSyncSettings() {
      try {
        const data = localStorage.getItem(this.syncKey);
        if (!data) return null;
        return JSON.parse(data);
      } catch (e) {
        console.error('Error loading sync settings:', e);
        return null;
      }
    },
    
    // –û—á–∏—Å—Ç–∏—Ç–∏ –≤—Å—ñ –¥–∞–Ω—ñ
    clear() {
      localStorage.removeItem(this.key);
    },
    
    // –ï–∫—Å–ø–æ—Ä—Ç –≤ JSON —Ñ–∞–π–ª
    exportToFile() {
      const data = {
        config: State.config,
        values: State.values,
        exportedAt: new Date().toISOString(),
        version: '2.0'
      };
      
      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `${i18n.t('app.filePrefix')}-${new Date().toISOString().split('T')[0]}.json`;
      a.click();
      URL.revokeObjectURL(url);
    },
    
    // –§–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è —á–∞—Å—É
    formatTime(date) {
      const locale = {
        uk: 'uk-UA',
        en: 'en-US',
        ru: 'ru-RU',
        pl: 'pl-PL'
      }[i18n.currentLang] || 'uk-UA';
      return date.toLocaleTimeString(locale, { hour: '2-digit', minute: '2-digit' });
    }
  };

  // ============= SYNC MANAGER =============
  const SyncManager = {
    autoSyncInterval: null,
    hasUnsyncedChanges: false, // –§–ª–∞–≥ –Ω–µ–∑–±–µ—Ä–µ–∂–µ–Ω–∏—Ö –∑–º—ñ–Ω
    lastSyncData: null, // –û—Å—Ç–∞–Ω–Ω—ñ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–æ–≤–∞–Ω—ñ –¥–∞–Ω—ñ
    
    // –ü–æ–∑–Ω–∞—á–∏—Ç–∏ —â–æ —î –Ω–µ–∑–±–µ—Ä–µ–∂–µ–Ω—ñ –∑–º—ñ–Ω–∏
    markDirty() {
      this.hasUnsyncedChanges = true;
    },
    
    // –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–∞—Ç—É—Å—É —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó –≤ UI
    updateStatus(status, text) {
      State.sync.status = status;
      State.sync.statusText = text;
      
      const statusEl = document.getElementById('syncStatus');
      if (!statusEl) return;
      
      // –û—á–∏—â—É—î–º–æ –≤—Å—ñ –∫–ª–∞—Å–∏
      statusEl.className = 'sync-status';
      statusEl.classList.add(status);
      
      // –Ü–∫–æ–Ω–∫–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö —Å—Ç–∞—Ç—É—Å—ñ–≤
      const icons = {
        local: 'fa-laptop',
        synced: 'fa-check-circle',
        syncing: 'fa-sync-alt fa-spin',
        error: 'fa-exclamation-circle',
        offline: 'fa-wifi'
      };
      
      statusEl.innerHTML = `
        <i class="fas ${icons[status] || 'fa-laptop'}"></i>
        <span>${text}</span>
      `;
    },
    
    // –ó–∞–ø—É—Å–∫ –∞–≤—Ç–æ—Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó (–û–ü–¢–ò–ú–Ü–ó–û–í–ê–ù–û - —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É—î —Ç—ñ–ª—å–∫–∏ —è–∫—â–æ —î –∑–º—ñ–Ω–∏!)
    startAutoSync(intervalMinutes) {
      this.stopAutoSync();
      
      if (!State.sync.googleSheets.enabled || !State.sync.googleSheets.autoSyncEnabled) {
        return;
      }
      
      Debug.log(`üîÑ Auto-sync: –∫–æ–∂–Ω—ñ ${intervalMinutes} —Ö–≤ (—Ç—ñ–ª—å–∫–∏ —è–∫—â–æ —î –∑–º—ñ–Ω–∏)`);
      
      this.autoSyncInterval = setInterval(async () => {
        // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ —î –Ω–µ–∑–±–µ—Ä–µ–∂–µ–Ω—ñ –∑–º—ñ–Ω–∏
        if (!this.hasUnsyncedChanges) {
          Debug.log('‚è≠Ô∏è Auto-sync: –Ω–µ–º–∞—î –∑–º—ñ–Ω, –ø—Ä–æ–ø—É—Å–∫–∞—î–º–æ');
          return;
        }
        
        if (navigator.onLine && GoogleSheetsSync.isAuthorized()) {
          try {
            Debug.log('üîÑ Auto-sync: —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è...');
            await Storage.save();
            this.hasUnsyncedChanges = false;
          } catch (error) {
            Debug.error('Auto-sync failed:', error);
          }
        } else {
          Debug.log('‚ö†Ô∏è Auto-sync: offline –∞–±–æ –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–æ');
        }
      }, intervalMinutes * 60 * 1000);
    },
    
    // –ó—É–ø–∏–Ω–∫–∞ –∞–≤—Ç–æ—Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó
    stopAutoSync() {
      if (this.autoSyncInterval) {
        clearInterval(this.autoSyncInterval);
        this.autoSyncInterval = null;
        Debug.log('Auto-sync stopped');
      }
    },
    
    // –†—É—á–Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è
    async manualSync() {
      if (!GoogleSheetsSync.isAuthorized()) {
        Toast.t('messages.needAuth', 'error');
        return;
      }
      
      try {
        this.updateStatus('syncing', i18n.t('messages.syncing'));
        await Storage.save();
        Toast.t('messages.syncComplete');
      } catch (error) {
        console.error('Manual sync error:', error);
        Toast.show('‚ùå ' + i18n.t('messages.syncError') + ': ' + error.message, 'error');
      }
    },
    
    // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è (–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Ç–∞ –∑–∞–ø—É—Å—Ç–∏—Ç–∏ –∞–≤—Ç–æ—Å–∏–Ω—Ö)
    async init() {
      // –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó
      const syncSettings = Storage.loadSyncSettings();
      if (syncSettings) {
        State.sync.mode = syncSettings.mode;
        Object.assign(State.sync.googleSheets, syncSettings.googleSheets);
        
        // –Ø–∫—â–æ Google Sheets —Ä–µ–∂–∏–º
        if (syncSettings.mode === 'googleSheets' && syncSettings.googleSheets.enabled) {
          try {
            // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É—î–º–æ Google API
            await GoogleSheetsSync.initGapi();
            await GoogleSheetsSync.initGis(syncSettings.googleSheets.clientId);
            
            GoogleSheetsSync.config.spreadsheetId = syncSettings.googleSheets.spreadsheetId;
            
            // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—é –∑ sessionStorage
            const savedToken = sessionStorage.getItem('gapi_token');
            if (savedToken) {
              GoogleSheetsSync.accessToken = savedToken;
              if (typeof gapi !== 'undefined' && gapi.client) {
                gapi.client.setToken({ access_token: savedToken });
              }
            }
            
            // –ó–∞–ø—É—Å–∫–∞—î–º–æ –∞–≤—Ç–æ—Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—é
            if (syncSettings.googleSheets.autoSyncEnabled) {
              this.startAutoSync(syncSettings.googleSheets.autoSyncInterval);
            }
            
            const lastSync = syncSettings.googleSheets.lastSync;
            if (lastSync) {
              const date = new Date(lastSync);
              this.updateStatus('synced', `${i18n.t('messages.syncComplete')} ${Storage.formatTime(date)}`);
            } else {
              this.updateStatus('synced', 'Google Sheets');
            }
          } catch (error) {
            console.error('Sync init error:', error);
            this.updateStatus('error', i18n.t('messages.syncInitError'));
          }
        } else {
          this.updateStatus('local', i18n.t('ui.localMode'));
        }
      } else {
        this.updateStatus('local', i18n.t('ui.localMode'));
      }
      
      // –û–±—Ä–æ–±–∫–∞ online/offline
      window.addEventListener('online', () => {
        if (State.sync.mode === 'googleSheets' && State.sync.lastError) {
          Toast.t('messages.connectionRestored');
          this.updateStatus('synced', 'Online');
          this.manualSync();
        }
      });
      
      window.addEventListener('offline', () => {
        if (State.sync.mode === 'googleSheets') {
          Toast.t('messages.offlineMode', 'warning');
          this.updateStatus('offline', i18n.t('messages.offlineMode'));
        }
      });
    }
  };

  // ============= FORMAT MENU =============
  const FormatMenu = {
    menu: document.getElementById('formatMenu'),
    activeInput: null,
    selectionStart: 0,
    selectionEnd: 0,
    
    init() {
      // –û–±—Ä–æ–±–∫–∞ –≤–∏–¥—ñ–ª–µ–Ω–Ω—è —Ç–µ–∫—Å—Ç—É –≤ input —Ç–∞ textarea
      const handleSelectionEvent = (e) => {
        const target = e.target;
        if (target.matches('.form-input, .form-textarea')) {
          this.handleSelection(target, e);
        } else {
          this.hide();
        }
      };
      
      document.addEventListener('mouseup', handleSelectionEvent);
      document.addEventListener('touchend', handleSelectionEvent);
      
      // –û–±—Ä–æ–±–∫–∞ –∫–ª—ñ–∫—ñ–≤ –ø–æ –∫–Ω–æ–ø–∫–∞—Ö —Ñ–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è
      this.menu.querySelectorAll('.format-menu-btn').forEach(btn => {
        const handleFormatClick = (e) => {
          e.preventDefault();
          e.stopPropagation();
          const format = btn.dataset.format;
          this.applyFormat(format);
        };
        
        btn.addEventListener('mousedown', handleFormatClick);
        btn.addEventListener('touchstart', handleFormatClick);
      });
      
      // –ü—Ä–∏—Ö–æ–≤–∞—Ç–∏ –º–µ–Ω—é –ø—Ä–∏ –∫–ª—ñ–∫—É –ø–æ–∑–∞ –Ω–∏–º
      const handleClickOutside = (e) => {
        if (!this.menu.contains(e.target) && !e.target.matches('.form-input, .form-textarea')) {
          this.hide();
        }
      };
      
      document.addEventListener('mousedown', handleClickOutside);
      document.addEventListener('touchstart', handleClickOutside);
      
      // –ì–∞—Ä—è—á—ñ –∫–ª–∞–≤—ñ—à—ñ
      document.addEventListener('keydown', (e) => {
        if (!this.activeInput) return;
        
        if (e.ctrlKey || e.metaKey) {
          if (e.key === 'b') {
            e.preventDefault();
            this.applyFormat('bold');
          } else if (e.key === 'i') {
            e.preventDefault();
            this.applyFormat('italic');
          } else if (e.key === 'k') {
            e.preventDefault();
            this.applyFormat('link');
          }
        }
      });
    },
    
    handleSelection(input, event) {
      // –ù–µ–≤–µ–ª–∏–∫–∞ –∑–∞—Ç—Ä–∏–º–∫–∞ –¥–ª—è –º–æ–±—ñ–ª—å–Ω–∏—Ö, —â–æ–± –≤–∏–¥—ñ–ª–µ–Ω–Ω—è –≤—Å—Ç–∏–≥–ª–æ –≤—ñ–¥–±—É—Ç–∏—Å—è
      setTimeout(() => {
        const selectedText = this.getSelectedText(input);
        
        if (selectedText && selectedText.length > 0) {
          this.activeInput = input;
          // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –ø–æ–∑–∏—Ü—ñ—ó –≤–∏–¥—ñ–ª–µ–Ω–Ω—è
          this.selectionStart = input.selectionStart;
          this.selectionEnd = input.selectionEnd;
          
          // –û—Ç—Ä–∏–º—É—î–º–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ –¥–ª—è touch –∞–±–æ mouse –ø–æ–¥—ñ—ó
          let x, y;
          if (event.type.startsWith('touch')) {
            const touch = event.changedTouches[0] || event.touches[0];
            x = touch.pageX;
            y = touch.pageY;
          } else {
            x = event.pageX;
            y = event.pageY;
          }
          
          this.show(x, y);
        } else {
          this.hide();
        }
      }, 50);
    },
    
    getSelectedText(input) {
      const start = input.selectionStart;
      const end = input.selectionEnd;
      return input.value.substring(start, end);
    },
    
    show(x, y) {
      this.menu.style.left = `${x}px`;
      this.menu.style.top = `${y - 50}px`;
      this.menu.classList.add('active');
    },
    
    hide() {
      this.menu.classList.remove('active');
      this.activeInput = null;
    },
    
    async applyFormat(format) {
      if (!this.activeInput) return;
      
      const input = this.activeInput;
      // –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –∑–±–µ—Ä–µ–∂–µ–Ω—ñ –ø–æ–∑–∏—Ü—ñ—ó
      const start = this.selectionStart;
      const end = this.selectionEnd;
      const selectedText = input.value.substring(start, end);
      
      if (!selectedText) return;
      
      let formattedText = '';
      
      switch(format) {
        case 'bold':
          formattedText = `**${selectedText}**`;
          break;
        case 'italic':
          formattedText = `*${selectedText}*`;
          break;
        case 'strikethrough':
          formattedText = `~~${selectedText}~~`;
          break;
        case 'link':
          const urlLabel = i18n.t('messages.enterUrl') || '–í–≤–µ–¥—ñ—Ç—å URL';
          const url = await Modal.prompt(urlLabel, '', 'https://');
          if (url) {
            formattedText = `[${selectedText}](${url})`;
          } else {
            return;
          }
          break;
        case 'chip':
          formattedText = `<chip>${selectedText}</chip>`;
          break;
      }
      
      // –ó–∞–º—ñ–Ω—é—î–º–æ –≤–∏–¥—ñ–ª–µ–Ω–∏–π —Ç–µ–∫—Å—Ç –Ω–∞ —Ñ–æ—Ä–º–∞—Ç–æ–≤–∞–Ω–∏–π
      const newValue = input.value.substring(0, start) + formattedText + input.value.substring(end);
      input.value = newValue;
      
      // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –∫—É—Ä—Å–æ—Ä –ø—ñ—Å–ª—è –≤—Å—Ç–∞–≤–ª–µ–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç—É
      const newCursorPos = start + formattedText.length;
      input.setSelectionRange(newCursorPos, newCursorPos);
      input.focus();
      
      this.hide();
    }
  };

  // ============= TOAST =============
  const Toast = {
    container: document.getElementById('toastContainer'),
    
    // –ü–æ–∫–∞–∑–∞—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∑ –ø–µ—Ä–µ–∫–ª–∞–¥–æ–º
    t(key, type = 'success') {
      const message = i18n.t(key);
      this.show(message, type);
    },
    
    show(message, type = 'success') {
      // –í–∏–∑–Ω–∞—á–∞—î–º–æ —Ç—Ä–∏–≤–∞–ª—ñ—Å—Ç—å —Ç–∞ —Å—Ç–∏–ª—å –≤ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ –≤—ñ–¥ —Ç–∏–ø—É
      const config = {
        success: { 
          duration: 3000, 
          icon: 'fa-check-circle', 
          class: 'toast-success' 
        },
        error: { 
          duration: 6000,  // ‚ùó –ü–æ–º–∏–ª–∫–∏ –ø–æ–∫–∞–∑—É—é—Ç—å—Å—è –¥–æ–≤—à–µ!
          icon: 'fa-exclamation-circle', 
          class: 'toast-error' 
        },
        warning: { 
          duration: 5000,  // ‚ö†Ô∏è –ü–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è —Ç–µ–∂ –¥–æ–≤—à–µ
          icon: 'fa-exclamation-triangle', 
          class: 'toast-warning' 
        },
        info: { 
          duration: 4000, 
          icon: 'fa-info-circle', 
          class: 'toast-info' 
        }
      };
      
      const settings = config[type] || config.success;
      
      const toast = document.createElement('div');
      toast.className = `toast ${settings.class}`;
      toast.innerHTML = `
        <i class="fas ${settings.icon}"></i>
        <span>${message}</span>
      `;
      
      this.container.appendChild(toast);
      
      // –ê–Ω—ñ–º–∞—Ü—ñ—è –ø–æ—è–≤–∏
      setTimeout(() => toast.classList.add('show'), DELAYS.TOAST_SHOW);
      
      // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –ø—Ä–∏—Ö–æ–≤—É–≤–∞–Ω–Ω—è
      setTimeout(() => {
        toast.classList.remove('show');
        toast.classList.add('removing');
        setTimeout(() => toast.remove(), DELAYS.TOAST_REMOVE);
      }, settings.duration);
      
      // –ó–∞–∫—Ä–∏—Ç—Ç—è –ø–æ –∫–ª—ñ–∫—É
      toast.addEventListener('click', () => {
        toast.classList.remove('show');
        toast.classList.add('removing');
        setTimeout(() => toast.remove(), DELAYS.TOAST_REMOVE);
      });
    }
  };

  // ============= i18n HELPERS =============
  // Wrapper –¥–ª—è confirm –∑ –ø–µ—Ä–µ–∫–ª–∞–¥–æ–º (deprecated - –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ Modal.confirm)
  window.confirmT = async function(messageKey) {
    const message = i18n.t(messageKey);
    return await Modal.confirm(message);
  };
  
  // Wrapper –¥–ª—è prompt –∑ –ø–µ—Ä–µ–∫–ª–∞–¥–æ–º (deprecated - –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ Modal.prompt)
  window.promptT = async function(messageKey, defaultValue = '') {
    const message = i18n.t(messageKey);
    return await Modal.prompt(message, '', defaultValue);
  };
  
  // –í–∞–ª—ñ–¥–∞—Ü—ñ—è ID (—Ç—ñ–ª—å–∫–∏ –±—É–∫–≤–∏, —Ü–∏—Ñ—Ä–∏, _, -)
  window.validateId = function(id) {
    if (!id) return false;
    const regex = /^[a-z0-9_-]+$/i;
    return regex.test(id);
  };
  
  // ============= DEBUG =============
  const Debug = {
    enabled: localStorage.getItem('debug') === 'true',
    log(...args) {
      if (this.enabled) {
        console.log(...args);
      }
    },
    error(...args) {
      console.error(...args); // –ü–æ–º–∏–ª–∫–∏ –∑–∞–≤–∂–¥–∏ –ø–æ–∫–∞–∑—É—î–º–æ
    }
  };
  
  // ============= SANITIZER =============
  const Sanitizer = {
    // –ï–∫—Ä–∞–Ω—É–≤–∞–Ω–Ω—è HTML –¥–ª—è –±–µ–∑–ø–µ—á–Ω–æ–≥–æ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è
    escapeHtml(text) {
      if (text === null || text === undefined) return '';
      const div = document.createElement('div');
      div.textContent = String(text);
      return div.innerHTML;
    },
    
    // –ë–∞–∑–æ–≤–∞ sanitization HTML
    sanitize(html) {
      if (!html) return '';
      return String(html)
        .replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi, '')
        .replace(/on\w+\s*=\s*["'][^"']*["']/gi, '')
        .replace(/on\w+\s*=\s*[^\s>]*/gi, '')
        .replace(/javascript:/gi, '');
    }
  };

  // ============= MODAL =============
  const Modal = {
    backdrop: document.getElementById('modalBackdrop'),
    title: document.getElementById('modalTitle'),
    titleIcon: document.getElementById('modalTitleIcon'),
    body: document.getElementById('modalBody'),
    saveBtn: document.getElementById('modalSave'),
    cancelBtn: document.getElementById('modalCancel'),
    closeBtn: document.getElementById('modalClose'),
    modalStack: [], // –°—Ç–µ–∫ –º–æ–¥–∞–ª—å–Ω–∏—Ö –≤—ñ–∫–æ–Ω
    baseZIndex: 1000, // –ë–∞–∑–æ–≤–∏–π z-index
    
    open(title, contentHtml, options = {}) {
      const { onSave, icon = 'fa-edit', size = 'medium', onOpen } = options;
      
      // –Ø–∫—â–æ —Ü–µ –ø–µ—Ä—à–µ –º–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ - –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –æ—Å–Ω–æ–≤–Ω–∏–π backdrop
      if (this.modalStack.length === 0) {
        this.title.textContent = title;
        this.titleIcon.className = `fas ${icon} modal-title-icon`;
        this.body.innerHTML = contentHtml;
        
        // –î–æ–¥–∞—î–º–æ –∫–ª–∞—Å —Ä–æ–∑–º—ñ—Ä—É –¥–æ –º–æ–¥–∞–ª–∫–∏
        const modal = this.backdrop.querySelector('.modal');
        modal.classList.remove('modal-large', 'modal-small');
        if (size === 'large') {
          modal.classList.add('modal-large');
        } else if (size === 'small') {
          modal.classList.add('modal-small');
        }
        
        // –í–∏–¥–∞–ª—è—î–º–æ closing —è–∫—â–æ –≤—ñ–Ω –∑–∞–ª–∏—à–∏–≤—Å—è
        this.backdrop.classList.remove('closing');
        
        // –ü–æ–∫–∞–∑—É—î–º–æ backdrop –±–µ–∑ –∞–Ω—ñ–º–∞—Ü—ñ—ó
        this.backdrop.style.display = 'flex';
        
        // –î–æ–¥–∞—î–º–æ active –∑ –Ω–µ–≤–µ–ª–∏–∫–æ—é –∑–∞—Ç—Ä–∏–º–∫–æ—é –¥–ª—è –∞–Ω—ñ–º–∞—Ü—ñ—ó
        requestAnimationFrame(() => {
          requestAnimationFrame(() => {
            this.backdrop.classList.add('active');
          });
        });
        
        this.saveBtn.onclick = async () => {
          if (onSave) {
            const result = await onSave();
            if (result !== false) {
              this.close();
            }
          } else {
            this.close();
          }
        };
        
        // –î–æ–¥–∞—î–º–æ –≤ —Å—Ç–µ–∫
        this.modalStack.push({
          backdrop: this.backdrop,
          isMain: true
        });
        
        // –í–∏–∫–ª–∏–∫–∞—î–º–æ onOpen callback –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –≤—ñ–∫–Ω–∞
        if (onOpen) {
          setTimeout(() => onOpen(), DELAYS.DROPDOWN_CLOSE);
        }
      } else {
        // –°—Ç–≤–æ—Ä—é—î–º–æ –Ω–æ–≤–µ –º–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –ø–æ–≤–µ—Ä—Ö —ñ—Å–Ω—É—é—á–æ–≥–æ
        this.createOverlayModal(title, contentHtml, { onSave, icon, size, onOpen });
      }
    },
    
    createOverlayModal(title, contentHtml, options = {}) {
      const { onSave, icon = 'fa-edit', size = 'medium', onOpen } = options;
      
      // –°—Ç–≤–æ—Ä—é—î–º–æ –Ω–æ–≤–∏–π backdrop
      const newBackdrop = document.createElement('div');
      newBackdrop.className = 'modal-backdrop';
      newBackdrop.style.cssText = `
        z-index: ${this.baseZIndex + this.modalStack.length};
        display: flex;
      `;
      
      // –°—Ç–≤–æ—Ä—é—î–º–æ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –≤—ñ–∫–Ω–∞
      const modalClass = size === 'large' ? 'modal modal-large' : size === 'small' ? 'modal modal-small' : 'modal';
      newBackdrop.innerHTML = `
        <div class="${modalClass}">
          <div class="modal-header">
            <div class="modal-title-wrapper">
              <i class="fas ${icon} modal-title-icon"></i>
              <h3 class="modal-title">${Sanitizer.escapeHtml(title)}</h3>
            </div>
            <button class="modal-close-btn">
              <i class="fas fa-times"></i>
            </button>
          </div>
          <div class="modal-body">${contentHtml}</div>
          <div class="modal-footer">
            <button class="btn btn-secondary modal-cancel-btn" data-i18n="ui.cancel">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
            <button class="btn btn-primary modal-save-btn" data-i18n="ui.save">–ó–±–µ—Ä–µ–≥—Ç–∏</button>
          </div>
        </div>
      `;
      
      document.body.appendChild(newBackdrop);
      
      // –û—Ç—Ä–∏–º—É—î–º–æ –µ–ª–µ–º–µ–Ω—Ç–∏
      const saveBtn = newBackdrop.querySelector('.modal-save-btn');
      const cancelBtn = newBackdrop.querySelector('.modal-cancel-btn');
      const closeBtn = newBackdrop.querySelector('.modal-close-btn');
      
      // –î–æ–¥–∞—î–º–æ –≤ —Å—Ç–µ–∫ –í–Ü–î–†–ê–ó–£ (—â–æ–± onCancel –º—ñ–≥ –±—É—Ç–∏ –¥–æ–¥–∞–Ω–∏–π –∑ prompt/confirm)
      const modalStackItem = {
        backdrop: newBackdrop,
        isMain: false,
        close: null // –í—Å—Ç–∞–Ω–æ–≤–∏–º–æ –ø—ñ–∑–Ω—ñ—à–µ
      };
      this.modalStack.push(modalStackItem);
      
      // –ü–æ–∫–∞–∑—É—î–º–æ –∑ –∞–Ω—ñ–º–∞—Ü—ñ—î—é
      requestAnimationFrame(() => {
        requestAnimationFrame(() => {
          newBackdrop.classList.add('active');
        });
      });
      
      // –û–±—Ä–æ–±–Ω–∏–∫–∏ –ø–æ–¥—ñ–π
      const closeModal = () => {
        // –í–∏–∫–ª–∏–∫–∞—î–º–æ onCancel –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä–∏—Ç—Ç—è–º
        if (modalStackItem.onCancel) {
          modalStackItem.onCancel();
        }
        
        newBackdrop.classList.add('closing');
        newBackdrop.classList.remove('active');
        
        setTimeout(() => {
          newBackdrop.remove();
          const index = this.modalStack.indexOf(modalStackItem);
          if (index > -1) {
            this.modalStack.splice(index, 1);
          }
        }, 200);
      };
      
      // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ close –º–µ—Ç–æ–¥
      modalStackItem.close = closeModal;
      
      saveBtn.onclick = async () => {
        if (onSave) {
          const result = await onSave();
          if (result !== false) {
            closeModal();
          }
        } else {
          closeModal();
        }
      };
      
      cancelBtn.onclick = closeModal;
      closeBtn.onclick = closeModal;
      
      newBackdrop.onclick = (e) => {
        if (e.target === newBackdrop) closeModal();
      };
      
      // –í–∏–∫–ª–∏–∫–∞—î–º–æ onOpen callback
      if (onOpen) {
        setTimeout(() => onOpen(), DELAYS.DROPDOWN_CLOSE);
      }
    },
    
    close() {
      if (this.modalStack.length === 0) return;
      
      const topModal = this.modalStack[this.modalStack.length - 1];
      
      if (topModal.isMain) {
        // –í–∏–∫–ª–∏–∫–∞—î–º–æ onCancel –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä–∏—Ç—Ç—è–º
        if (topModal.onCancel) {
          topModal.onCancel();
        }
        
        // –ó–∞–∫—Ä–∏–≤–∞—î–º–æ –æ—Å–Ω–æ–≤–Ω–µ –º–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ
        this.backdrop.classList.add('closing');
        this.backdrop.classList.remove('active');
        
        setTimeout(() => {
          this.backdrop.classList.remove('closing');
          this.backdrop.style.display = 'none';
          State.ui.modalData = null;
          this.modalStack.pop();
        }, 200);
      } else {
        // –ó–∞–∫—Ä–∏–≤–∞—î–º–æ overlay –º–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ
        if (topModal.close) {
          topModal.close();
        }
      }
    },
    
    init() {
      this.cancelBtn.onclick = () => this.close();
      this.closeBtn.onclick = () => this.close();
      this.backdrop.onclick = (e) => {
        if (e.target === this.backdrop) this.close();
      };
    },
    
    // –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –¥–ª—è –≤–≤–µ–¥–µ–Ω–Ω—è —Ç–µ–∫—Å—Ç—É (–∑–∞–º—ñ–Ω–∞ prompt)
    prompt(title, placeholder = '', defaultValue = '') {
      return new Promise((resolve) => {
        const inputId = 'modalPromptInput_' + Date.now();
        const contentHtml = `
          <div class="form-group">
            <input 
              type="text" 
              class="form-input" 
              id="${inputId}" 
              placeholder="${Sanitizer.escapeHtml(placeholder)}" 
              value="${Sanitizer.escapeHtml(defaultValue)}" 
              autofocus>
          </div>
        `;
        
        let resolved = false;
        
        this.open(title, contentHtml, {
          icon: 'fa-keyboard',
          size: 'small',
          onSave: () => {
            const input = document.getElementById(inputId);
            const value = input ? input.value.trim() : '';
            resolved = true;
            resolve(value || null);
            return true;
          },
          onOpen: () => {
            const input = document.getElementById(inputId);
            if (input) {
              input.focus();
              input.select();
              
              // Enter –¥–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è
              input.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                  e.preventDefault();
                  // –ù–∞—Ç–∏—Å–∫–∞—î–º–æ –Ω–∞ –∫–Ω–æ–ø–∫—É –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ–≥–æ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –≤—ñ–∫–Ω–∞
                  const topModal = this.modalStack[this.modalStack.length - 1];
                  if (topModal.isMain) {
                    this.saveBtn.click();
                  } else {
                    const saveBtn = topModal.backdrop.querySelector('.modal-save-btn');
                    if (saveBtn) saveBtn.click();
                  }
                }
              });
            }
          }
        });
        
        // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ resolve –≤ —Å—Ç–µ–∫—É –¥–ª—è –≤–∏–∫–ª–∏–∫—É –ø—Ä–∏ –∑–∞–∫—Ä–∏—Ç—Ç—ñ
        const topModal = this.modalStack[this.modalStack.length - 1];
        topModal.onCancel = () => {
          if (!resolved) {
            resolve(null);
          }
        };
      });
    },
    
    // –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –¥–ª—è –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è (–∑–∞–º—ñ–Ω–∞ confirm)
    confirm(message, title = null) {
      return new Promise((resolve) => {
        const displayTitle = title || i18n.t('modal.confirmAction') || '–ü—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è';
        const contentHtml = `
          <div style="padding: 1rem 0; font-size: 1rem; line-height: 1.6;">
            ${Sanitizer.escapeHtml(message)}
          </div>
        `;
        
        let resolved = false;
        
        this.open(displayTitle, contentHtml, {
          icon: 'fa-question-circle',
          size: 'small',
          onSave: () => {
            resolved = true;
            resolve(true);
            return true;
          }
        });
        
        // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ resolve –≤ —Å—Ç–µ–∫—É –¥–ª—è –≤–∏–∫–ª–∏–∫—É –ø—Ä–∏ –∑–∞–∫—Ä–∏—Ç—Ç—ñ
        const topModal = this.modalStack[this.modalStack.length - 1];
        topModal.onCancel = () => {
          if (!resolved) {
            resolve(false);
          }
        };
      });
    }
  };

  // ============= CUSTOM SELECT =============
  const CustomSelect = {
    activeSelect: null, // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –∞–∫—Ç–∏–≤–Ω–∏–π select
    
    init(selectElement, options) {
      const container = document.createElement('div');
      container.className = 'custom-select';
      
      const selectedOption = options.find(opt => opt.selected) || options[0];
      
      // Trigger
      const trigger = document.createElement('div');
      trigger.className = 'custom-select-trigger';
      trigger.innerHTML = `
        ${selectedOption.icon ? `<i class="fas ${selectedOption.icon} custom-select-icon"></i>` : ''}
        <span class="custom-select-text">${selectedOption.label}</span>
      `;
      
      // Dropdown
      const dropdown = document.createElement('div');
      dropdown.className = 'custom-select-dropdown';
      
      options.forEach(opt => {
        const option = document.createElement('div');
        option.className = 'custom-select-option';
        if (opt.value === selectedOption.value) option.classList.add('selected');
        option.dataset.value = opt.value;
        option.innerHTML = `
          ${opt.icon ? `<i class="fas ${opt.icon} custom-select-option-icon"></i>` : ''}
          <span class="custom-select-option-text">${opt.label}</span>
        `;
        
        option.onclick = () => {
          // Update trigger
          trigger.innerHTML = `
            ${opt.icon ? `<i class="fas ${opt.icon} custom-select-icon"></i>` : ''}
            <span class="custom-select-text">${opt.label}</span>
          `;
          
          // Update selected
          dropdown.querySelectorAll('.custom-select-option').forEach(o => o.classList.remove('selected'));
          option.classList.add('selected');
          
          // Update original select
          selectElement.value = opt.value;
          selectElement.dispatchEvent(new Event('change'));
          
          // Close dropdown
          container.classList.remove('active');
          dropdown.classList.remove('active');
        };
        
        dropdown.appendChild(option);
      });
      
      // Position dropdown
      const positionDropdown = () => {
        const rect = trigger.getBoundingClientRect();
        const dropdownHeight = dropdown.offsetHeight || 300; // max-height
        const viewportHeight = window.innerHeight;
        const viewportWidth = window.innerWidth;
        const spaceBelow = viewportHeight - rect.bottom;
        const spaceAbove = rect.top;
        
        // –í–∏–∑–Ω–∞—á–∞—î–º–æ —á–∏ –ø–æ–∫–∞–∑—É–≤–∞—Ç–∏ dropdown –∑–≤–µ—Ä—Ö—É —á–∏ –∑–Ω–∏–∑—É
        let top;
        if (spaceBelow < dropdownHeight && spaceAbove > spaceBelow) {
          // –ü–æ–∫–∞–∑—É—î–º–æ –∑–≤–µ—Ä—Ö—É
          top = rect.top - dropdownHeight - 8;
          dropdown.style.transformOrigin = 'bottom';
        } else {
          // –ü–æ–∫–∞–∑—É—î–º–æ –∑–Ω–∏–∑—É
          top = rect.bottom + 8;
          dropdown.style.transformOrigin = 'top';
        }
        
        // –û–±–º–µ–∂—É—î–º–æ –≤–∏—Å–æ—Ç—É —è–∫—â–æ –Ω–µ –≤–º—ñ—â–∞—î—Ç—å—Å—è
        const maxHeight = Math.min(300, Math.max(spaceBelow, spaceAbove) - 16);
        dropdown.style.maxHeight = `${maxHeight}px`;
        
        dropdown.style.top = `${Math.max(8, top)}px`;
        
        // –†–æ–∑—Ä–∞—Ö–æ–≤—É—î–º–æ —à–∏—Ä–∏–Ω—É –∑ —É—Ä–∞—Ö—É–≤–∞–Ω–Ω—è–º min-width
        const minWidth = parseInt(getComputedStyle(dropdown).minWidth) || rect.width;
        const dropdownWidth = Math.max(rect.width, minWidth);
        dropdown.style.width = `${dropdownWidth}px`;
        
        // –ü–æ–∑–∏—Ü—ñ–æ–Ω—É—î–º–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ –∑ —É—Ä–∞—Ö—É–≤–∞–Ω–Ω—è–º –º–µ–∂ viewport
        const padding = 8; // –í—ñ–¥—Å—Ç—É–ø –≤—ñ–¥ –∫—Ä–∞—é –µ–∫—Ä–∞–Ω—É
        let left = rect.left - 16; // –ó–º—ñ—â—É—î–º–æ –Ω–∞ 1rem –≤–ª—ñ–≤–æ
        
        // –û–±–º–µ–∂—É—î–º–æ –ø–æ–∑–∏—Ü—ñ—é –≤ –º–µ–∂–∞—Ö viewport
        const maxLeft = viewportWidth - dropdownWidth - padding;
        const minLeft = padding;
        
        // –ó–∞—Å—Ç–æ—Å–æ–≤—É—î–º–æ –æ–±–º–µ–∂–µ–Ω–Ω—è
        left = Math.max(minLeft, Math.min(left, maxLeft));
        
        dropdown.style.left = `${left}px`;
      };
      
      // Toggle dropdown
      trigger.onclick = (e) => {
        e.stopPropagation();
        const wasActive = container.classList.contains('active');
        
        // Close previously active select
        if (CustomSelect.activeSelect && CustomSelect.activeSelect !== container) {
          CustomSelect.activeSelect.classList.remove('active');
          CustomSelect.activeSelect.querySelector('.custom-select-dropdown')?.classList.remove('active');
        }
        
        if (!wasActive) {
          container.classList.add('active');
          dropdown.classList.add('active');
          CustomSelect.activeSelect = container;
          positionDropdown();
        } else {
          CustomSelect.activeSelect = null;
        }
      };
      
      // Reposition on scroll/resize with throttling
      let scrollTimeout;
      window.addEventListener('scroll', () => {
        if (!container.classList.contains('active')) return;
        
        clearTimeout(scrollTimeout);
        scrollTimeout = setTimeout(() => {
          positionDropdown();
        }, DELAYS.THROTTLE_SCROLL);
      }, true);
      
      let resizeTimeout;
      window.addEventListener('resize', () => {
        if (!container.classList.contains('active')) return;
        
        clearTimeout(resizeTimeout);
        resizeTimeout = setTimeout(() => {
          positionDropdown();
        }, DELAYS.THROTTLE_SCROLL);
      });
      
      // Close on outside click
      document.addEventListener('click', () => {
        if (CustomSelect.activeSelect === container) {
          container.classList.remove('active');
          dropdown.classList.remove('active');
          CustomSelect.activeSelect = null;
        }
      });
      
      container.appendChild(trigger);
      document.body.appendChild(dropdown);
      
      // Replace original select
      selectElement.style.display = 'none';
      selectElement.parentNode.insertBefore(container, selectElement);
      
      // Cleanup on container removal
      const observer = new MutationObserver((mutations) => {
        mutations.forEach((mutation) => {
          mutation.removedNodes.forEach((node) => {
            if (node === container || node.contains(container)) {
              dropdown.remove();
              observer.disconnect();
            }
          });
        });
      });
      observer.observe(document.body, { childList: true, subtree: true });
      
      return container;
    }
  };

  // ============= SEARCH =============
  const Search = {
    query: '',
    debounceTimeout: null,
    
    // Debounce helper
    debounce(func, wait) {
      return (...args) => {
        clearTimeout(this.debounceTimeout);
        this.debounceTimeout = setTimeout(() => func(...args), wait);
      };
    },
    
    // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –ø–æ—à—É–∫—É
    init() {
      const searchInput = document.getElementById('searchInput');
      const searchClearBtn = document.getElementById('searchClearBtn');
      
      if (!searchInput) return;
      
      // –û–±—Ä–æ–±–Ω–∏–∫ –≤–≤–µ–¥–µ–Ω–Ω—è –∑ debounce
      const handleSearch = this.debounce((query) => {
        this.query = query;
        this.performSearch();
      }, 300);
      
      searchInput.addEventListener('input', (e) => {
        const query = e.target.value;
        
        // –ü–æ–∫–∞–∑—É—î–º–æ/—Ö–æ–≤–∞—î–º–æ –∫–Ω–æ–ø–∫—É –æ—á–∏—â–µ–Ω–Ω—è
        if (query) {
          searchClearBtn.classList.add('visible');
        } else {
          searchClearBtn.classList.remove('visible');
        }
        
        handleSearch(query);
      });
      
      // –ö–Ω–æ–ø–∫–∞ –æ—á–∏—â–µ–Ω–Ω—è
      if (searchClearBtn) {
        searchClearBtn.addEventListener('click', () => {
          searchInput.value = '';
          searchClearBtn.classList.remove('visible');
          this.query = '';
          this.performSearch();
          searchInput.focus();
        });
      }
      
      // –û—á–∏—â–µ–Ω–Ω—è –ø–æ—à—É–∫—É –ø—Ä–∏ Escape
      searchInput.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
          searchInput.value = '';
          searchClearBtn.classList.remove('visible');
          this.query = '';
          this.performSearch();
        }
      });
    },
    
    // –í–∏–∫–æ–Ω—É—î –ø–æ—à—É–∫
    performSearch() {
      // –Ø–∫—â–æ —î –∞–∫—Ç–∏–≤–Ω–∏–π –ø–æ—à—É–∫, –ø–æ–∫–∞–∑—É—î–º–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ –ø–æ –≤—Å—ñ—Ö –∫–∞—Ç–µ–≥–æ—Ä—ñ—è—Ö
      if (this.query) {
        State.ui.searchActive = true;
        State.ui.activeCategory = null; // –°–∫–∏–¥–∞—î–º–æ –∞–∫—Ç–∏–≤–Ω—É –∫–∞—Ç–µ–≥–æ—Ä—ñ—é
      } else {
        State.ui.searchActive = false;
        State.ui.activeCategory = State.ui.lastActiveCategory || 'base';
      }
      
      Renderer.renderCategories();
      Renderer.renderContent();
      Progress.update();
    },
    
    // –§—ñ–ª—å—Ç—Ä—É—î –ø–æ–ª—è –∑–∞ –∑–∞–ø–∏—Ç–æ–º
    filterFields(fields) {
      if (!this.query) return fields;
      
      const lowerQuery = this.query.toLowerCase();
      
      return fields.filter(field => {
        // –ü–æ—à—É–∫ –≤ –Ω–∞–∑–≤—ñ –ø–æ–ª—è
        if (field.label.toLowerCase().includes(lowerQuery)) return true;
        
        // –ü–æ—à—É–∫ –≤ –∑–Ω–∞—á–µ–Ω–Ω—ñ
        const value = State.values[field.id];
        if (!value) return false;
        
        // –î–ª—è —Ç–µ–∫—Å—Ç–æ–≤–∏—Ö –ø–æ–ª—ñ–≤
        if (typeof value === 'string') {
          return value.toLowerCase().includes(lowerQuery);
        }
        
        // –î–ª—è —Ç–µ–≥—ñ–≤
        if (Array.isArray(value)) {
          return value.some(v => v.toLowerCase().includes(lowerQuery));
        }
        
        // –î–ª—è nested –ø–æ–ª—ñ–≤
        if (typeof value === 'object') {
          return JSON.stringify(value).toLowerCase().includes(lowerQuery);
        }
        
        return false;
      });
    },
    
    // Highlight –∑–Ω–∞–π–¥–µ–Ω–∏—Ö –∑–±—ñ–≥—ñ–≤
    highlightText(text) {
      if (!this.query || !text) return text;
      
      const regex = new RegExp(`(${this.escapeRegex(this.query)})`, 'gi');
      return text.replace(regex, '<span class="search-highlight">$1</span>');
    },
    
    // Escape regex —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª—ñ–≤
    escapeRegex(str) {
      return str.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
    }
  };

  // ============= PROGRESS =============
  const Progress = {
    // –ü–µ—Ä–µ–≤—ñ—Ä—è—î —á–∏ –ø–æ–ª–µ –∑–∞–ø–æ–≤–Ω–µ–Ω–µ
    isFieldFilled(fieldId) {
      const field = State.config.fields.find(f => f.id === fieldId);
      if (!field) return false;
      
      const value = State.values[fieldId];
      
      // text/textarea: value !== '' && value !== null && value !== undefined
      if (field.type === 'text' || field.type === 'textarea') {
        return value !== '' && value !== null && value !== undefined;
      }
      
      // date: value !== '' && value !== null
      if (field.type === 'date') {
        return value !== '' && value !== null && value !== undefined;
      }
      
      // tags: array.length > 0
      if (field.type === 'tags') {
        return Array.isArray(value) && value.length > 0;
      }
      
      // nested: —Ö–æ—á–∞ –± –æ–¥–∏–Ω –ø—ñ–¥–ø—É–Ω–∫—Ç –∑–∞–ø–æ–≤–Ω–µ–Ω–∏–π
      if (field.type === 'nested') {
        if (!value || typeof value !== 'object') return false;
        
        for (const catKey in value) {
          for (const subKey in value[catKey]) {
            const items = value[catKey][subKey];
            if (Array.isArray(items) && items.length > 0) {
              return true;
            }
          }
        }
        return false;
      }
      
      return false;
    },
    
    // –†–æ–∑—Ä–∞—Ö–æ–≤—É—î –ø—Ä–æ–≥—Ä–µ—Å –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó
    calculateProgress(categoryId) {
      if (!categoryId) {
        return { filled: 0, total: 0, percentage: 0 };
      }
      
      const fields = State.config.fields.filter(f => f.category === categoryId);
      const total = fields.length;
      
      if (total === 0) {
        return { filled: 0, total: 0, percentage: 0 };
      }
      
      const filled = fields.filter(f => this.isFieldFilled(f.id)).length;
      const percentage = Math.round((filled / total) * 100);
      
      return { filled, total, percentage };
    },
    
    // –û–Ω–æ–≤–ª—é—î UI –ø—Ä–æ–≥—Ä–µ—Å-–±–∞—Ä—É
    update() {
      const progressBarFill = document.getElementById('progressBarFill');
      const progressBarText = document.getElementById('progressBarText');
      
      if (!progressBarFill || !progressBarText) return;
      
      const categoryId = State.ui.activeCategory;
      
      if (!categoryId) {
        progressBarFill.style.width = '0%';
        progressBarText.textContent = i18n.t('ui.selectCategory');
        return;
      }
      
      const { filled, total, percentage } = this.calculateProgress(categoryId);
      const category = State.config.categories.find(c => c.id === categoryId);
      const categoryName = category ? category.label : i18n.t('ui.selectCategory');
      
      progressBarFill.style.width = `${percentage}%`;
      
      progressBarText.textContent = `${filled} ${i18n.t('ui.of')} ${total} ${i18n.t('ui.fields')} (${Math.round(percentage)}%)`;
      
      // –û–Ω–æ–≤–ª—é—î–º–æ tooltip
      const container = progressBarFill.parentElement;
      if (container) {
        
        container.title = `${filled} ${i18n.t('ui.of')} ${total} ${i18n.t('ui.fields')} ${i18n.t('ui.inCategory')} "${categoryName}"`;
      }
    }
  };

  // ============= RENDERER =============
  const Renderer = {
    // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è —Ñ–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è —Ç–µ–∫—Å—Ç—É –∑ –ø—ñ–¥—Ç—Ä–∏–º–∫–æ—é markdown-–ø–æ–¥—ñ–±–Ω–æ–≥–æ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å—É
    // –ü—Ä–∏–∫–ª–∞–¥–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è:
    // **–∂–∏—Ä–Ω–∏–π —Ç–µ–∫—Å—Ç** –∞–±–æ __–∂–∏—Ä–Ω–∏–π —Ç–µ–∫—Å—Ç__ ‚Üí <strong>–∂–∏—Ä–Ω–∏–π —Ç–µ–∫—Å—Ç</strong>
    // *–∫—É—Ä—Å–∏–≤* –∞–±–æ _–∫—É—Ä—Å–∏–≤_ ‚Üí <em>–∫—É—Ä—Å–∏–≤</em>
    // ~~–∑–∞–∫—Ä–µ—Å–ª–µ–Ω–∏–π~~ ‚Üí <del>–∑–∞–∫—Ä–µ—Å–ª–µ–Ω–∏–π</del>
    // [—Ç–µ–∫—Å—Ç](url) ‚Üí <a href="url">—Ç–µ–∫—Å—Ç</a>
    formatText(text) {
      if (!text || typeof text !== 'string') return text;
      
      // –°–ø–æ—á–∞—Ç–∫—É –æ–±—Ä–æ–±–ª—è—î–º–æ –ø–æ—Å–∏–ª–∞–Ω–Ω—è [—Ç–µ–∫—Å—Ç](url) –î–û –µ–∫—Ä–∞–Ω—É–≤–∞–Ω–Ω—è
      // –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ —É–Ω—ñ–∫–∞–ª—å–Ω–∏–π –º–∞—Ä–∫–µ—Ä —è–∫–∏–π –Ω–µ –±—É–¥–µ –µ–∫—Ä–∞–Ω–æ–≤–∞–Ω–∏–π
      const links = [];
      text = text.replace(/\[(.+?)\]\((.+?)\)/g, (match, linkText, url) => {
        const placeholder = `¬ß¬ß¬ßLINK${links.length}¬ß¬ß¬ß`;
        links.push({ text: linkText, url: url });
        return placeholder;
      });
      
      // –û–±—Ä–æ–±–ª—è—î–º–æ <chip>—Ç–µ–∫—Å—Ç</chip> –î–û –µ–∫—Ä–∞–Ω—É–≤–∞–Ω–Ω—è
      const chips = [];
      text = text.replace(/<chip>(.+?)<\/chip>/g, (match, chipText) => {
        const placeholder = `¬ß¬ß¬ßCHIP${chips.length}¬ß¬ß¬ß`;
        chips.push(chipText);
        return placeholder;
      });
      
      // –ï–∫—Ä–∞–Ω—É—î–º–æ HTML —Ç–µ–≥–∏ –¥–ª—è –±–µ–∑–ø–µ–∫–∏ (–∞–ª–µ –Ω–µ –Ω–∞—à—ñ –º–∞—Ä–∫–µ—Ä–∏ ¬ß¬ß¬ß)
      text = text.replace(/</g, '&lt;').replace(/>/g, '&gt;');
      
      // **–∂–∏—Ä–Ω–∏–π** –∞–±–æ __–∂–∏—Ä–Ω–∏–π__ (–∑–±–µ—Ä—ñ–≥–∞—î–º–æ –ø—Ä–æ–±—ñ–ª–∏ –Ω–∞–≤–∫–æ–ª–æ)
      text = text.replace(/(\s?)\*\*(.+?)\*\*(\s?)/g, (match, before, content, after) => {
        return `${before}<strong>${content}</strong>${after}`;
      });
      text = text.replace(/(\s?)__(.+?)__(\s?)/g, (match, before, content, after) => {
        return `${before}<strong>${content}</strong>${after}`;
      });
      
      // *–∫—É—Ä—Å–∏–≤* –∞–±–æ _–∫—É—Ä—Å–∏–≤_ (–∑–±–µ—Ä—ñ–≥–∞—î–º–æ –ø—Ä–æ–±—ñ–ª–∏ –Ω–∞–≤–∫–æ–ª–æ)
      text = text.replace(/(\s?)\*(.+?)\*(\s?)/g, (match, before, content, after) => {
        return `${before}<em>${content}</em>${after}`;
      });
      text = text.replace(/(\s?)_(.+?)_(\s?)/g, (match, before, content, after) => {
        return `${before}<em>${content}</em>${after}`;
      });
      
      // ~~–∑–∞–∫—Ä–µ—Å–ª–µ–Ω–∏–π~~ (–∑–±–µ—Ä—ñ–≥–∞—î–º–æ –ø—Ä–æ–±—ñ–ª–∏ –Ω–∞–≤–∫–æ–ª–æ)
      text = text.replace(/(\s?)~~(.+?)~~(\s?)/g, (match, before, content, after) => {
        return `${before}<del>${content}</del>${after}`;
      });
      
      // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –º–Ω–æ–∂–∏–Ω–Ω—ñ –ø—Ä–æ–±—ñ–ª–∏ (–∑–∞–º—ñ–Ω—é—î–º–æ –ø–æ–¥–≤—ñ–π–Ω—ñ –ø—Ä–æ–±—ñ–ª–∏ –Ω–∞ &nbsp;)
      text = text.replace(/  /g, ' &nbsp;');
      
      // –í—ñ–¥–Ω–æ–≤–ª—é—î–º–æ chip —Ç–µ–≥–∏ –∑ –º–∞—Ä–∫–µ—Ä—ñ–≤ –ü–ï–†–ï–î –æ–±—Ä–æ–±–∫–æ—é –ø—Ä–æ–±—ñ–ª—ñ–≤
      chips.forEach((chipText, index) => {
        const chipHtml = `<span class="chip">${chipText}</span>`;
        text = text.replace(`¬ß¬ß¬ßCHIP${index}¬ß¬ß¬ß`, chipHtml);
      });
      
      // –í—ñ–¥–Ω–æ–≤–ª—é—î–º–æ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –∑ –º–∞—Ä–∫–µ—Ä—ñ–≤ –ü–ï–†–ï–î –æ–±—Ä–æ–±–∫–æ—é –ø—Ä–æ–±—ñ–ª—ñ–≤
      links.forEach((link, index) => {
        const linkHtml = `<a href="${link.url}" target="_blank" rel="noopener noreferrer">${link.text}</a>`;
        text = text.replace(`¬ß¬ß¬ßLINK${index}¬ß¬ß¬ß`, linkHtml);
      });
      
      // –í–ê–ñ–õ–ò–í–û: –ó–∞–º—ñ–Ω—é—î–º–æ –ø—Ä–æ–±—ñ–ª–∏ –º—ñ–∂ –∑–∞–∫—Ä–∏–≤–∞—é—á–∏–º —Ç–∞ –≤—ñ–¥–∫—Ä–∏–≤–∞—é—á–∏–º —Ç–µ–≥–∞–º–∏ –Ω–∞ &nbsp;
      text = text.replace(/(<\/[^>]+>)\s+(<[^>]+>)/g, '$1&nbsp;$2');
      
      // –ü–µ—Ä–µ–Ω–æ—Å–∏ —Ä—è–¥–∫—ñ–≤
      text = text.replace(/\n/g, '<br>');
      
      return text;
    },
    
    renderCategories() {
      const nav = document.getElementById('categoryNav');
      nav.innerHTML = '';
      
      State.config.categories.forEach(cat => {
        const fieldsCount = State.config.fields.filter(f => f.category === cat.id).length;
        const item = document.createElement('div');
        item.className = 'category-item';
        if (State.ui.activeCategory === cat.id) {
          item.classList.add('active');
        }
        
        item.innerHTML = `
          <div class="category-icon">
            <i class="fas ${cat.icon}"></i>
          </div>
          <div class="category-label">${cat.label}</div>
          <div class="category-count">${fieldsCount}</div>
        `;
        
        item.onclick = () => {
          // –û—á–∏—â—É—î–º–æ –ø–æ—à—É–∫ –ø—Ä–∏ –≤–∏–±–æ—Ä—ñ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó
          const searchInput = document.getElementById('searchInput');
          const searchClearBtn = document.getElementById('searchClearBtn');
          if (searchInput && searchInput.value) {
            searchInput.value = '';
            if (searchClearBtn) searchClearBtn.classList.remove('visible');
            Search.query = '';
          }
          
          State.ui.searchActive = false;
          State.ui.activeCategory = cat.id;
          State.ui.lastActiveCategory = cat.id;
          this.renderCategories();
          this.renderContent();
          Progress.update(); // –û–Ω–æ–≤–ª—é—î–º–æ –ø—Ä–æ–≥—Ä–µ—Å –ø—Ä–∏ –∑–º—ñ–Ω—ñ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó
        };
        
        nav.appendChild(item);
      });
    },
    
    renderContent() {
      const contentTitle = document.getElementById('contentTitle');
      const contentActions = document.getElementById('contentActions');
      const contentBody = document.getElementById('contentBody');
      
      // –†–µ–∂–∏–º –ø–æ—à—É–∫—É
      if (State.ui.searchActive && Search.query) {
        const allFields = State.config.fields;
        const filteredFields = Search.filterFields(allFields);
        
        contentTitle.innerHTML = `
          <i class="fas fa-search"></i>
          <span>${i18n.t('ui.searchResultsTitle')}</span>
        `;
        
        contentActions.innerHTML = '';
        
        if (filteredFields.length === 0) {
          contentBody.innerHTML = `
            <div class="empty-state">
              <div class="empty-state-icon"><i class="fas fa-search"></i></div>
              <div class="empty-state-text">${i18n.t('ui.noResults')}</div>
              <p>${i18n.t('ui.changeSearchQuery')}</p>
            </div>
          `;
          return;
        }
        
        contentBody.innerHTML = '<div class="fields-grid"></div>';
        const grid = contentBody.querySelector('.fields-grid');
        
        filteredFields.forEach(field => {
          grid.appendChild(this.renderField(field, true));
        });
        
        return;
      }
      
      if (!State.ui.activeCategory) {
        contentTitle.innerHTML = `
          <i class="fas fa-hand-pointer"></i>
          <span>${i18n.t('ui.selectCategory')}</span>
        `;
        contentActions.innerHTML = '';
        contentBody.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon"><i class="fas fa-hand-pointer"></i></div>
            <div class="empty-state-text">${i18n.t('ui.selectCategoryLeft')}</div>
            <p>${i18n.t('ui.clickCategory')}</p>
          </div>
        `;
        return;
      }
      
      const category = State.config.categories.find(c => c.id === State.ui.activeCategory);
      const fields = State.config.fields.filter(f => f.category === State.ui.activeCategory);
      
      // –ü—Ä–∏—Ö–æ–≤—É—î–º–æ –ø—Ä–∏–≤–∞—Ç–Ω—ñ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ
      const isPrivateCategory = category && category.isPrivate;
      
      contentTitle.innerHTML = `
        <i class="fas ${category.icon}"></i>
        <span>${category.label}</span>
        ${isPrivateCategory ? `<span class="badge badge-high" style="margin-left: 0.5rem;">${i18n.t('ui.privateBadge')}</span>` : ''}
      `;
      
      // –ü—ñ–¥—Ä–∞—Ö–æ–≤—É—î–º–æ –∞–∫—Ç–∏–≤–Ω—ñ —Ñ—ñ–ª—å—Ç—Ä–∏
      const activeFiltersCount = 
        (State.ui.fillFilter !== 'all' ? 1 : 0) + 
        State.ui.importanceFilters.length;
      
      const filtersBadge = activeFiltersCount > 0 
        ? `<span class="filters-badge">${activeFiltersCount}</span>` 
        : '';
      
      contentActions.innerHTML = `
        <button class="filters-toggle-btn" data-action="App.toggleFiltersDropdown" id="filtersToggleBtn">
          <i class="fas fa-filter"></i>
          <span>${i18n.t('ui.filters')}</span>
          ${filtersBadge}
        </button>
        
        <button class="btn btn-secondary btn-sm" data-action="App.editCategory" data-param="${category.id}">
          <i class="fas fa-edit"></i>
          <span>${i18n.t('ui.edit')}</span>
        </button>
        
        <div class="filters-dropdown" id="filtersDropdown">
          <div class="filters-dropdown-section">
            <div class="filters-dropdown-label">
              <i class="fas fa-check-square"></i>
              ${i18n.t('fillStatus.filledness')}
            </div>
            <div class="fill-filter">
              <button class="fill-filter-btn ${State.ui.fillFilter === 'all' ? 'active' : ''}" data-action="App.setFillFilter" data-param="all">
                <i class="fas fa-list"></i> ${i18n.t('fillStatus.all')}
              </button>
              <button class="fill-filter-btn ${State.ui.fillFilter === 'filled' ? 'active' : ''}" data-action="App.setFillFilter" data-param="filled">
                <i class="fas fa-check-circle"></i> ${i18n.t('fillStatus.filled')}
              </button>
              <button class="fill-filter-btn ${State.ui.fillFilter === 'empty' ? 'active' : ''}" data-action="App.setFillFilter" data-param="empty">
                <i class="fas fa-circle"></i> ${i18n.t('fillStatus.empty')}
              </button>
            </div>
          </div>
          <div class="filters-dropdown-section">
            <div class="filters-dropdown-label">
              <i class="fas fa-star"></i>
              ${i18n.t('modal.importance')}
            </div>
            <div class="importance-filter">
              <button class="importance-filter-btn ${State.ui.importanceFilters.includes('high') ? 'active high' : ''}" data-action="App.toggleImportanceFilter" data-param="high">
                <i class="fas fa-exclamation-circle"></i>
                <span>${i18n.t('importance.highPlural')}</span>
              </button>
              <button class="importance-filter-btn ${State.ui.importanceFilters.includes('medium') ? 'active medium' : ''}" data-action="App.toggleImportanceFilter" data-param="medium">
                <i class="fas fa-minus-circle"></i>
                <span>${i18n.t('importance.mediumPlural')}</span>
              </button>
              <button class="importance-filter-btn ${State.ui.importanceFilters.includes('low') ? 'active low' : ''}" data-action="App.toggleImportanceFilter" data-param="low">
                <i class="fas fa-info-circle"></i>
                <span>${i18n.t('importance.lowPlural')}</span>
              </button>
            </div>
          </div>
        </div>
      `;
      
      if (fields.length === 0) {
        contentBody.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon"><i class="fas fa-inbox"></i></div>
            <div class="empty-state-text">${i18n.t('emptyStates.noFieldsInCategory')}</div>
            <p>${i18n.t('emptyStates.clickAddFieldToCreate')}
          </div>
        `;
        return;
      }
      
      // –§—ñ–ª—å—Ç—Ä—É—î–º–æ –ø–æ–ª—è –∑–∞ –∑–∞–ø–æ–≤–Ω–µ–Ω—ñ—Å—Ç—é
      let filteredFields = fields;
      if (State.ui.fillFilter === 'filled') {
        filteredFields = fields.filter(f => Progress.isFieldFilled(f.id));
      } else if (State.ui.fillFilter === 'empty') {
        filteredFields = fields.filter(f => !Progress.isFieldFilled(f.id));
      }
      
      // –§—ñ–ª—å—Ç—Ä—É—î–º–æ –ø–æ–ª—è –∑–∞ –≤–∞–∂–ª–∏–≤—ñ—Å—Ç—é
      if (State.ui.importanceFilters.length > 0) {
        filteredFields = filteredFields.filter(f => State.ui.importanceFilters.includes(f.importance));
      }
      
      if (filteredFields.length === 0) {
        let emptyMessage = i18n.t('messages.noFieldsWithFilters');
        if (State.ui.fillFilter === 'filled') {
          emptyMessage = i18n.t('messages.noFilledFields');
        } else if (State.ui.fillFilter === 'empty') {
          emptyMessage = i18n.t('messages.noEmptyFields');
        } else if (State.ui.importanceFilters.length > 0) {
          emptyMessage = i18n.t('messages.noFieldsWithImportance');
        }
        contentBody.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon"><i class="fas fa-filter"></i></div>
            <div class="empty-state-text">${emptyMessage}</div>
            <p>${i18n.t('ui.changeFilters')}</p>
          </div>
        `;
        return;
      }
      
      contentBody.innerHTML = '<div class="fields-grid"></div>';
      const grid = contentBody.querySelector('.fields-grid');
      
      filteredFields.forEach(field => {
        grid.appendChild(this.renderField(field));
      });
    },
    
    renderField(field, showCategory = false) {
      const card = document.createElement('div');
      card.className = 'field-card fade-in';
      
      const value = State.values[field.id];
      const hasValue = value !== undefined && value !== null && value !== '';
      
      let valueHtml = '';
      
      if (field.type === 'nested') {
        if (value && typeof value === 'object') {
          valueHtml = '<div class="nested-container">';
          (field.nestedCategories || []).forEach(cat => {
            valueHtml += `
              <div class="nested-category">
                <div class="nested-category-title">${cat.label}</div>
            `;
            (cat.subcategories || []).forEach(sub => {
              const items = (value[cat.id] && value[cat.id][sub.id]) || [];
              const formattedItems = items.map(item => {
                const formatted = this.formatText(item);
                return Search.query ? Search.highlightText(formatted) : formatted;
              });
              valueHtml += `
                <div class="nested-subcategory">
                  <div class="nested-label">${sub.label}</div>
                  <div class="chips-container">
                    ${formattedItems.length ? formattedItems.map(item => `<div class="chip">${item}</div>`).join('') : '<span class="empty">‚Äî</span>'}
                  </div>
                </div>
              `;
            });
            valueHtml += '</div>';
          });
          valueHtml += '</div>';
        } else {
          valueHtml = `<div class="field-value empty">${i18n.t('ui.emptyValue')}</div>`;
        }
      } else if (field.type === 'tags') {
        const tags = Array.isArray(value) ? value : (value ? value.split(',').map(t => t.trim()) : []);
        const formattedTags = tags.map(tag => {
          const formatted = this.formatText(tag);
          return Search.query ? Search.highlightText(formatted) : formatted;
        });
        valueHtml = `
          <div class="field-value ${tags.length ? '' : 'empty'}">${tags.length ? `<div class="chips-container">${formattedTags.map(tag => `<div class="chip">${tag}</div>`).join('')}</div>`:i18n.t('ui.emptyValue')}</div>`;
      } else {
        let formattedValue = hasValue ? this.formatText(value) : i18n.t('ui.emptyValue');
        if (hasValue && Search.query) {
          formattedValue = Search.highlightText(formattedValue);
        }
        valueHtml = `<div class="field-value ${hasValue ? '' : 'empty'}">${formattedValue}</div>`;
      }
      
      // –í–∏–∑–Ω–∞—á–∞—î–º–æ –∫–∞—Ç–µ–≥–æ—Ä—ñ—é –ø–æ–ª—è –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è
      let categoryBadge = '';
      if (showCategory) {
        const category = State.config.categories.find(c => c.id === field.category);
        if (category) {
          categoryBadge = `<span class="search-result-badge"><i class="fas ${category.icon}"></i> ${category.label}</span>`;
        }
      }
      
      // Highlight –≤ –Ω–∞–∑–≤—ñ –ø–æ–ª—è
      const highlightedLabel = Search.query ? Search.highlightText(field.label) : field.label;
      
      card.innerHTML = `
        <div class="field-header">
          <div class="field-info">
            <div class="field-label">
              <span>${highlightedLabel}${field.required ? '<span style="color: var(--danger)">*</span>' : ''}</span>
              ${categoryBadge}
            </div>
            <div class="field-meta">
              <span class="badge badge-${field.importance}">${this.getImportanceLabel(field.importance)}</span>
              <span>${this.getTypeLabel(field.type)}</span>
            </div>
          </div>
          <div class="field-controls">
            <button class="btn btn-icon btn-secondary btn-sm field-controls-menu-btn" data-action="App.toggleFieldMenu" data-field-id="${field.id}" title="${i18n.t('tooltips.menu')}">
              <i class="fas fa-ellipsis-v"></i>
            </button>
            <button class="btn btn-icon btn-secondary btn-sm" data-action="App.editFieldValue" data-param="${field.id}" title="${i18n.t('tooltips.editValue')}">
              <i class="fas fa-edit"></i>
            </button>
            <button class="btn btn-icon btn-secondary btn-sm" data-action="App.editField" data-param="${field.id}" title="${i18n.t('tooltips.fieldSettings')}">
              <i class="fas fa-cog"></i>
            </button>
            <button class="btn btn-icon btn-secondary btn-sm" data-action="App.deleteField" data-param="${field.id}" title="${i18n.t('tooltips.deleteField')}">
              <i class="fas fa-trash"></i>
            </button>
            <div class="field-controls-popup" id="fieldMenu_${field.id}">
              <button class="btn btn-secondary btn-sm" data-action="App.editFieldValue" data-param="${field.id}" data-close-menu="${field.id}">
                <i class="fas fa-edit"></i> ${i18n.t('ui.edit')}
              </button>
              <button class="btn btn-secondary btn-sm" data-action="App.editField" data-param="${field.id}" data-close-menu="${field.id}">
                <i class="fas fa-cog"></i> ${i18n.t('tooltips.fieldSettings')}
              </button>
              <button class="btn btn-danger btn-sm" data-action="App.deleteField" data-param="${field.id}" data-close-menu="${field.id}">
                <i class="fas fa-trash"></i> ${i18n.t('ui.delete')}
              </button>
            </div>
          </div>
        </div>
        ${valueHtml}
      `;
      
      return card;
    },
    
    getImportanceLabel(importance) {
      const labels = {
        high: `<i class="fas fa-exclamation-circle"></i> ${i18n.t('importance.highShort')}`,
        medium: `<i class="fas fa-minus-circle"></i> ${i18n.t('importance.mediumShort')}`,
        low: `<i class="fas fa-info-circle"></i> ${i18n.t('importance.lowShort')}`
      };
      return labels[importance] || importance;
    },
    
    getTypeLabel(type) {
      return i18n.t(`types.${type}`) || type;
    },
  };

  // ============= APP =============
  const App = {
    async init() {
      // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É—î–º–æ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—é –°–ü–û–ß–ê–¢–ö–£
      await SyncManager.init();
      
      // Load data
      const saved = await Storage.load();
      if (saved) {
        // –ú—ñ–≥—Ä–∞—Ü—ñ—è: –¥–æ–¥–∞—î–º–æ originalLabel –¥–ª—è —ñ—Å–Ω—É—é—á–∏—Ö –∫–∞—Ç–µ–≥–æ—Ä—ñ–π
        saved.config.categories = saved.config.categories.map(cat => {
          if (!cat.originalLabel) {
            cat.originalLabel = cat.label;
          }
          return cat;
        });
        
        // –ú—ñ–≥—Ä–∞—Ü—ñ—è: –¥–æ–¥–∞—î–º–æ originalLabel –¥–ª—è —ñ—Å–Ω—É—é—á–∏—Ö –ø–æ–ª—ñ–≤
        saved.config.fields = saved.config.fields.map(field => {
          if (!field.originalLabel) {
            field.originalLabel = field.label;
          }
          return field;
        });
        
        // Merge existing config with new default categories and fields
        const existingCategoryIds = saved.config.categories.map(c => c.id);
        const existingFieldIds = saved.config.fields.map(f => f.id);
        
        // Add new categories that don't exist
        const newCategories = DefaultConfig.categories
          .filter(c => !existingCategoryIds.includes(c.id))
          .map(cat => ({
            ...cat,
            originalLabel: cat.label // –î–æ–¥–∞—î–º–æ originalLabel –¥–ª—è –Ω–æ–≤–∏—Ö –¥–µ—Ñ–æ–ª—Ç–Ω–∏—Ö –∫–∞—Ç–µ–≥–æ—Ä—ñ–π
          }));
        const newFields = DefaultConfig.fields
          .filter(f => !existingFieldIds.includes(f.id))
          .map(field => ({
            ...field,
            originalLabel: field.label // –î–æ–¥–∞—î–º–æ originalLabel –¥–ª—è –Ω–æ–≤–∏—Ö –¥–µ—Ñ–æ–ª—Ç–Ω–∏—Ö –ø–æ–ª—ñ–≤
          }));
        
        State.config = {
          categories: [...saved.config.categories, ...newCategories],
          fields: [...saved.config.fields, ...newFields]
        };
        State.values = saved.values;
        
        // Save updated config if new items were added
        if (newCategories.length > 0 || newFields.length > 0) {
          await Storage.save();
        }
      } else {
        State.config = {
          categories: DefaultConfig.categories.map(cat => ({
            ...cat,
            originalLabel: cat.label // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω—É –Ω–∞–∑–≤—É –¥–ª—è –¥–µ—Ñ–æ–ª—Ç–Ω–∏—Ö –∫–∞—Ç–µ–≥–æ—Ä—ñ–π
          })),
          fields: DefaultConfig.fields.map(field => ({
            ...field,
            originalLabel: field.label // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω—É –Ω–∞–∑–≤—É –¥–ª—è –¥–µ—Ñ–æ–ª—Ç–Ω–∏—Ö –ø–æ–ª—ñ–≤
          }))
        };
        State.values = {...DefaultConfig.values};
        await Storage.save();
      }
      
      // Apply translations
      i18n.applyTranslations();
      i18n.updateLanguageUI();
      
      // Initialize UI
      Modal.init();
      FormatMenu.init();
      Search.init();
      this.bindEvents();
      this.bindLanguageSelector();
      
      // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤—ñ–¥–∫—Ä–∏–≤–∞—î–º–æ –∫–∞—Ç–µ–≥–æ—Ä—ñ—é "–ë–∞–∑–æ–≤–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è" –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ
      State.ui.activeCategory = 'base';
      State.ui.lastActiveCategory = 'base';
      
      Renderer.renderCategories();
      Renderer.renderContent();
      Progress.update(); // –û–Ω–æ–≤–ª—é—î–º–æ –ø—Ä–æ–≥—Ä–µ—Å –ø—Ä–∏ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó
    },
    
    bindEvents() {
      // Sidebar toggle –¥–ª—è –º–æ–±—ñ–ª—å–Ω–∏—Ö
      const sidebar = document.getElementById('sidebar');
      const sidebarToggle = document.getElementById('sidebarToggle');
      
      if (sidebarToggle) {
        // –ó–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º sidebar –∑–≥–æ—Ä–Ω—É—Ç–∏–π –Ω–∞ –ø–ª–∞–Ω—à–µ—Ç–∞—Ö —ñ –º–æ–±—ñ–ª—å–Ω–∏—Ö
        if (window.innerWidth <= 1024) {
          sidebar.classList.add('collapsed');
        }
        
        sidebarToggle.addEventListener('click', () => {
          sidebar.classList.toggle('collapsed');
          sidebarToggle.classList.toggle('active');
        });
        
        // –û–Ω–æ–≤–ª—é—î–º–æ —Å—Ç–∞–Ω –ø—Ä–∏ –∑–º—ñ–Ω—ñ —Ä–æ–∑–º—ñ—Ä—É –≤—ñ–∫–Ω–∞
        window.addEventListener('resize', () => {
          if (window.innerWidth > 1024) {
            sidebar.classList.remove('collapsed');
            sidebarToggle.classList.remove('active');
          }
        });
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–≥–æ—Ä—Ç–∞—î–º–æ sidebar –ø—Ä–∏ –≤–∏–±–æ—Ä—ñ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó
        document.getElementById('categoryNav').addEventListener('click', (e) => {
          if (e.target.closest('.category-item') && window.innerWidth <= 1024) {
            sidebar.classList.add('collapsed');
            sidebarToggle.classList.remove('active');
          }
        });
      }
      
      document.getElementById('btnSave').onclick = async () => {
        await Storage.save();
        if (State.sync.mode === 'localStorage') {
          Toast.t('messages.dataSaved');
        }
      };
      
      document.getElementById('btnSync').onclick = () => {
        this.openSyncSettings();
      };
      
      document.getElementById('btnExport').onclick = () => {
        const data = JSON.stringify({config: State.config, values: State.values}, null, 2);
        const blob = new Blob([data], {type: 'application/json'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `${i18n.t('app.filePrefix')}_${new Date().toISOString().split('T')[0]}.json`;
        a.click();
        URL.revokeObjectURL(url);
        Toast.t('messages.exported');
      };
      
      document.getElementById('btnImport').onclick = () => {
        document.getElementById('fileInput').click();
      };
      
      document.getElementById('fileInput').onchange = (e) => {
        const file = e.target.files[0];
        if (!file) return;
        
        const reader = new FileReader();
        reader.onload = async (event) => {
          try {
            const data = JSON.parse(event.target.result);
            if (data.config && data.values) {
              State.config = data.config;
              State.values = data.values;
              SyncManager.markDirty(); // –ü–æ–∑–Ω–∞—á–∞—î–º–æ –∑–º—ñ–Ω–∏
              await Storage.save();
              Renderer.renderCategories();
              Renderer.renderContent();
              Toast.t('messages.imported');
            } else {
              Toast.t('messages.invalidFile', 'error');
            }
          } catch (error) {
            Toast.t('messages.fileReadError', 'error');
          }
        };
        reader.readAsText(file);
        e.target.value = '';
      };
      
      document.getElementById('btnClear').onclick = async () => {
        const confirmMessage = i18n.t('messages.confirmClear') || '–í–∏–¥–∞–ª–∏—Ç–∏ –≤—Å—ñ –¥–∞–Ω—ñ?';
        if (await Modal.confirm(confirmMessage)) {
          Storage.clear();
          State.config = {
            categories: [...DefaultConfig.categories],
            fields: [...DefaultConfig.fields]
          };
          State.values = {...DefaultConfig.values};
          State.ui.activeCategory = null;
          Renderer.renderCategories();
          Renderer.renderContent();
          Toast.t('messages.dataCleared');
        }
      };
      
      document.getElementById('btnAddField').onclick = () => {
        this.showFieldModal();
      };
      
      document.getElementById('btnAddCategory').onclick = () => {
        this.showCategoryModal();
      };
    },
    
    bindLanguageSelector() {
      const languageSelector = document.getElementById('languageSelector');
      const languageTrigger = document.getElementById('languageTrigger');
      const languageDropdown = document.getElementById('languageDropdown');
      
      // Toggle dropdown
      languageTrigger.addEventListener('click', (e) => {
        e.stopPropagation();
        languageSelector.classList.toggle('active');
        languageDropdown.classList.toggle('active');
        
        // Position dropdown
        if (languageDropdown.classList.contains('active')) {
          const rect = languageTrigger.getBoundingClientRect();
          const viewportWidth = window.innerWidth;
          const padding = 8;
          
          languageDropdown.style.top = `${rect.bottom + 8}px`;
          
          // –†–æ–∑—Ä–∞—Ö–æ–≤—É—î–º–æ —à–∏—Ä–∏–Ω—É dropdown
          const minWidth = parseInt(getComputedStyle(languageDropdown).minWidth) || 200;
          const dropdownWidth = Math.max(200, minWidth);
          languageDropdown.style.width = `${dropdownWidth}px`;
          
          // –ü–æ–∑–∏—Ü—ñ–æ–Ω—É—î–º–æ –∑ —É—Ä–∞—Ö—É–≤–∞–Ω–Ω—è–º –º–µ–∂ viewport (–∑–º—ñ—â–µ–Ω–æ –Ω–∞ 1rem –≤–ª—ñ–≤–æ)
          let left = rect.left - 16;
          const maxLeft = viewportWidth - dropdownWidth - padding;
          const minLeft = padding;
          left = Math.max(minLeft, Math.min(left, maxLeft));
          
          // –í–∏–¥–∞–ª—è—î–º–æ right —ñ –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ left
          languageDropdown.style.right = '';
          languageDropdown.style.left = `${left}px`;
        }
      });
      
      // Language selection
      languageDropdown.querySelectorAll('.custom-select-option').forEach(option => {
        option.addEventListener('click', (e) => {
          e.stopPropagation();
          const lang = option.getAttribute('data-lang');
          i18n.setLanguage(lang);
          languageSelector.classList.remove('active');
          languageDropdown.classList.remove('active');
        });
      });
      
      // Close dropdown when clicking outside
      document.addEventListener('click', (e) => {
        if (!languageSelector.contains(e.target)) {
          languageSelector.classList.remove('active');
          languageDropdown.classList.remove('active');
        }
      });
      
      // ============= GLOBAL EVENT DELEGATION =============
      // Password toggle
      document.addEventListener('click', (e) => {
        if (e.target.closest('.password-toggle')) {
          const button = e.target.closest('.password-toggle');
          const input = button.previousElementSibling;
          if (input && input.tagName === 'INPUT') {
            input.type = input.type === 'password' ? 'text' : 'password';
          }
          return;
        }
        
        // Instruction toggle
        if (e.target.closest('.instruction-toggle')) {
          const toggle = e.target.closest('.instruction-toggle');
          const content = toggle.nextElementSibling;
          toggle.classList.toggle('expanded');
          if (content) content.classList.toggle('show');
          return;
        }
      });
      
      // –û–±—Ä–æ–±–∫–∞ –≤—Å—ñ—Ö App –º–µ—Ç–æ–¥—ñ–≤ —á–µ—Ä–µ–∑ data-action
      document.addEventListener('click', (e) => {
        const target = e.target.closest('[data-action]');
        if (!target) return;
        
        const action = target.dataset.action;
        const param = target.dataset.param;
        const param2 = target.dataset.param2;
        const closeMenu = target.dataset.closeMenu;
        
        // –†–æ–∑–±–∏—Ä–∞—î–º–æ action –Ω–∞ –æ–±'—î–∫—Ç —ñ –º–µ—Ç–æ–¥
        const parts = action.split('.');
        if (parts.length !== 2 || parts[0] !== 'App') return;
        
        const method = parts[1];
        
        // –í–∏–∫–ª–∏–∫–∞—î–º–æ –º–µ—Ç–æ–¥ –∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
        if (typeof this[method] === 'function') {
          if (param2) {
            this[method](param, param2);
          } else if (param) {
            this[method](param);
          } else if (method === 'toggleFieldMenu') {
            this[method](e, target.dataset.fieldId);
          } else {
            this[method]();
          }
          
          // –ó–∞–∫—Ä–∏–≤–∞—î–º–æ –º–µ–Ω—é —è–∫—â–æ —î data-close-menu
          if (closeMenu) {
            this.closeFieldMenu(closeMenu);
          }
        }
      });
    },
    
    showFieldModal(fieldId = null) {
      const field = fieldId ? State.config.fields.find(f => f.id === fieldId) : null;
      const isEdit = !!field;
      
      const categories = State.config.categories.map(c => 
        `<option value="${c.id}" ${field && field.category === c.id ? 'selected' : ''}>${c.label}</option>`
      ).join('');
      
      Modal.open(
        i18n.t(isEdit ? 'modal.editField' : 'modal.newField'),
        `
          <div class="form-group">
            <label class="form-label">${i18n.t('modal.fieldId')}</label>
            <input type="text" class="form-input" id="fieldId" value="${field ? field.id : ''}" ${isEdit ? 'readonly' : ''} required>
          </div>
          <div class="form-group">
            <label class="form-label">${i18n.t('modal.fieldName')}</label>
            <input type="text" class="form-input" id="fieldLabel" value="${field ? field.label : ''}" required>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">${i18n.t('modal.type')}</label>
              <select class="form-select" id="fieldType">
                <option value="text" ${field && field.type === 'text' ? 'selected' : ''}>${i18n.t('types.text')}</option>
                <option value="textarea" ${field && field.type === 'textarea' ? 'selected' : ''}>${i18n.t('types.textarea')}</option>
                <option value="date" ${field && field.type === 'date' ? 'selected' : ''}>${i18n.t('types.date')}</option>
                <option value="tags" ${field && field.type === 'tags' ? 'selected' : ''}>${i18n.t('types.tags')}</option>
                <option value="nested" ${field && field.type === 'nested' ? 'selected' : ''}>${i18n.t('types.nested')}</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">${i18n.t('modal.importance')}</label>
              <select class="form-select" id="fieldImportance">
                <option value="high" ${field && field.importance === 'high' ? 'selected' : ''}>${i18n.t('importance.high')}</option>
                <option value="medium" ${field && field.importance === 'medium' ? 'selected' : ''}>${i18n.t('importance.medium')}</option>
                <option value="low" ${field && field.importance === 'low' ? 'selected' : ''}>${i18n.t('importance.low')}</option>
              </select>
            </div>
          </div>
          <div class="form-group">
            <label class="form-label">${i18n.t('modal.category')}</label>
            <select class="form-select" id="fieldCategory">
              ${categories}
            </select>
          </div>
          <div class="form-checkbox">
            <input type="checkbox" id="fieldRequired" ${field && field.required ? 'checked' : ''}>
            <label for="fieldRequired">${i18n.t('modal.required')}</label>
          </div>
          
          <div id="nestedCategoriesContainer" style="display: ${field && field.type === 'nested' ? 'block' : 'none'}; margin-top: 1rem; padding: 1rem; background: var(--bg-secondary); border-radius: 8px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
              <strong>–í–∫–ª–∞–¥–µ–Ω—ñ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó</strong>
              <button type="button" class="btn btn-primary btn-sm" id="btnAddNestedCategory">
                <i class="fas fa-plus"></i> –î–æ–¥–∞—Ç–∏ –∫–∞—Ç–µ–≥–æ—Ä—ñ—é
              </button>
            </div>
            <div id="nestedCategoriesList"></div>
          </div>
        `,
        {
          icon: 'fa-plus-circle',
          onSave: async () => {
            const id = document.getElementById('fieldId').value.trim();
            const label = document.getElementById('fieldLabel').value.trim();
            const type = document.getElementById('fieldType').value;
            const importance = document.getElementById('fieldImportance').value;
            const category = document.getElementById('fieldCategory').value;
            const required = document.getElementById('fieldRequired').checked;
            
            if (!id || !label) {
              Toast.t('messages.fillAllFields', 'error');
              return false;
            }
            
            if (!isEdit && State.config.fields.find(f => f.id === id)) {
              Toast.t('messages.fieldExists', 'error');
              return false;
            }
            
            const fieldData = {id, label, type, importance, category, required};
            
            if (type === 'nested') {
              // Collect nested categories from the UI
              const nestedCategoriesList = document.getElementById('nestedCategoriesList');
              const categoryElements = nestedCategoriesList.querySelectorAll('.nested-cat-item');
              fieldData.nestedCategories = [];
              
              categoryElements.forEach(catEl => {
                const catId = catEl.dataset.catId;
                const catLabel = catEl.querySelector('.nested-cat-label').textContent;
                const subcategoryElements = catEl.querySelectorAll('.nested-subcat-item');
                const subcategories = [];
                
                subcategoryElements.forEach(subEl => {
                  subcategories.push({
                    id: subEl.dataset.subId,
                    label: subEl.querySelector('.nested-subcat-label').textContent
                  });
                });
                
                fieldData.nestedCategories.push({
                  id: catId,
                  label: catLabel,
                  subcategories: subcategories
                });
              });
            }
            
            if (isEdit) {
              const index = State.config.fields.findIndex(f => f.id === fieldId);
              State.config.fields[index] = fieldData;
            } else {
              State.config.fields.push(fieldData);
            }
            
            SyncManager.markDirty(); // –ü–æ–∑–Ω–∞—á–∞—î–º–æ –∑–º—ñ–Ω–∏
            await Storage.save();
            Renderer.renderContent();
            Progress.update();
            Toast.t(isEdit ? 'messages.fieldUpdated' : 'messages.fieldCreated');
            return true;
          },
          onOpen: () => {
            // Local variable to store nested categories during editing
            let tempNestedCategories = [];
            if (field && field.nestedCategories) {
              try {
                tempNestedCategories = JSON.parse(JSON.stringify(field.nestedCategories));
              } catch (e) {
                Debug.error('Error copying nestedCategories:', e);
                Toast.t('messages.errorLoadingData', 'error');
                tempNestedCategories = [];
              }
            }
            
            // Initialize custom selects
            setTimeout(() => {
              const typeSelect = document.getElementById('fieldType');
              if (typeSelect) {
                CustomSelect.init(typeSelect, [
                  {value: 'text', label: i18n.t('types.text'), icon: 'fa-font', selected: field && field.type === 'text'},
                  {value: 'textarea', label: i18n.t('types.textarea'), icon: 'fa-align-left', selected: field && field.type === 'textarea'},
                  {value: 'date', label: i18n.t('types.date'), icon: 'fa-calendar', selected: field && field.type === 'date'},
                  {value: 'tags', label: i18n.t('types.tags'), icon: 'fa-tags', selected: field && field.type === 'tags'},
                  {value: 'nested', label: i18n.t('types.nested'), icon: 'fa-layer-group', selected: field && field.type === 'nested'}
                ]);
              }
              
              const importanceSelect = document.getElementById('fieldImportance');
              if (importanceSelect) {
                CustomSelect.init(importanceSelect, [
                  {value: 'high', label: i18n.t('importance.high'), icon: 'fa-exclamation-circle', selected: field && field.importance === 'high'},
                  {value: 'medium', label: i18n.t('importance.medium'), icon: 'fa-minus-circle', selected: field && field.importance === 'medium'},
                  {value: 'low', label: i18n.t('importance.low'), icon: 'fa-info-circle', selected: field && field.importance === 'low'}
                ]);
              }
              
              const categorySelect = document.getElementById('fieldCategory');
              if (categorySelect) {
                const categoryOptions = State.config.categories.map(c => ({
                  value: c.id,
                  label: c.label,
                  icon: c.icon || 'fa-folder',
                  selected: field && field.category === c.id
                }));
                CustomSelect.init(categorySelect, categoryOptions);
              }
              
              // Handle nested categories container visibility
              const nestedContainer = document.getElementById('nestedCategoriesContainer');
              const updateNestedVisibility = () => {
                const selectedType = typeSelect.value;
                nestedContainer.style.display = selectedType === 'nested' ? 'block' : 'none';
              };
              
              typeSelect.addEventListener('change', updateNestedVisibility);
              
              // Function to render nested categories
              const renderNestedCategories = () => {
                const nestedCategoriesList = document.getElementById('nestedCategoriesList');
                
                if (tempNestedCategories.length === 0) {
                  nestedCategoriesList.innerHTML = '<div style="color: var(--text-muted); padding: 1rem; text-align: center;">–ù–µ–º–∞—î –≤–∫–ª–∞–¥–µ–Ω–∏—Ö –∫–∞—Ç–µ–≥–æ—Ä—ñ–π. –î–æ–¥–∞–π—Ç–µ –ø–µ—Ä—à—É –∫–∞—Ç–µ–≥–æ—Ä—ñ—é.</div>';
                } else {
                  nestedCategoriesList.innerHTML = tempNestedCategories.map((cat, catIndex) => `
                    <div class="nested-cat-item" data-cat-id="${Sanitizer.escapeHtml(cat.id)}" style="margin-bottom: 1rem; padding: 1rem; background: var(--bg-primary); border-radius: 6px;">
                      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                        <strong class="nested-cat-label">${Sanitizer.escapeHtml(cat.label)}</strong>
                        <div>
                          <button type="button" class="btn btn-sm btn-add-subcat-shortcut" data-cat-index="${catIndex}" style="padding: 0.25rem 0.5rem; margin-right: 0.25rem;">
                            <i class="fas fa-plus"></i>
                          </button>
                          <button type="button" class="btn btn-sm btn-edit-nested-cat" data-cat-index="${catIndex}" style="padding: 0.25rem 0.5rem; margin-right: 0.25rem;">
                            <i class="fas fa-edit"></i>
                          </button>
                          <button type="button" class="btn btn-sm btn-danger btn-delete-nested-cat" data-cat-index="${catIndex}" style="padding: 0.25rem 0.5rem;">
                            <i class="fas fa-trash"></i>
                          </button>
                        </div>
                      </div>
                      <div class="nested-subcats-list" style="margin-left: 1rem;">
                        ${(cat.subcategories || []).map((sub, subIndex) => `
                          <div class="nested-subcat-item" data-sub-id="${Sanitizer.escapeHtml(sub.id)}" style="display: flex; justify-content: space-between; align-items: center; padding: 0.5rem; margin-bottom: 0.25rem; background: var(--bg-secondary); border-radius: 4px;">
                            <span class="nested-subcat-label">${Sanitizer.escapeHtml(sub.label)}</span>
                            <div>
                              <button type="button" class="btn btn-sm btn-edit-nested-subcat" data-cat-index="${catIndex}" data-sub-index="${subIndex}" style="padding: 0.25rem 0.5rem; margin-right: 0.25rem;">
                                <i class="fas fa-edit"></i>
                              </button>
                              <button type="button" class="btn btn-sm btn-danger btn-delete-nested-subcat" data-cat-index="${catIndex}" data-sub-index="${subIndex}" style="padding: 0.25rem 0.5rem;">
                                <i class="fas fa-trash"></i>
                              </button>
                            </div>
                          </div>
                        `).join('')}
                      </div>
                      <button type="button" class="btn btn-sm nested-subcat-add-btn" data-cat-index="${catIndex}" style="margin-top: 0.5rem; padding: 0.25rem 0.5rem;">
                        <i class="fas fa-plus"></i> –î–æ–¥–∞—Ç–∏ –ø—ñ–¥–∫–∞—Ç–µ–≥–æ—Ä—ñ—é
                      </button>
                    </div>
                  `).join('');
                }
              };
              
              // Initial render
              renderNestedCategories();
              
              // Add nested category button
              document.getElementById('btnAddNestedCategory').addEventListener('click', async () => {
                const catId = await Modal.prompt('–í–≤–µ–¥—ñ—Ç—å ID –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó', '—Ç—ñ–ª—å–∫–∏ –ª–∞—Ç–∏–Ω–∏—Ü—è, —Ü–∏—Ñ—Ä–∏, _, -');
                if (!catId) return;
                
                if (!validateId(catId)) {
                  await Modal.confirm('–ù–µ–∫–æ—Ä–µ–∫—Ç–Ω–∏–π ID! –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ —Ç—ñ–ª—å–∫–∏ –ª–∞—Ç–∏–Ω—Å—å–∫—ñ –±—É–∫–≤–∏, —Ü–∏—Ñ—Ä–∏, –ø—ñ–¥–∫—Ä–µ—Å–ª–µ–Ω–Ω—è —Ç–∞ –¥–µ—Ñ—ñ—Å.', '–ü–æ–º–∏–ª–∫–∞');
                  return;
                }
                
                const catLabel = await Modal.prompt('–í–≤–µ–¥—ñ—Ç—å –Ω–∞–∑–≤—É –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó');
                if (!catLabel) return;
                
                if (tempNestedCategories.find(c => c.id === catId)) {
                  await Modal.confirm('–ö–∞—Ç–µ–≥–æ—Ä—ñ—è –∑ —Ç–∞–∫–∏–º ID –≤–∂–µ —ñ—Å–Ω—É—î!', '–ü–æ–º–∏–ª–∫–∞');
                  return;
                }
                
                tempNestedCategories.push({id: catId, label: catLabel, subcategories: []});
                
                renderNestedCategories();
              });
              
              // Event delegation - –æ–¥–∏–Ω listener –∑–∞–º—ñ—Å—Ç—å –±–∞–≥–∞—Ç—å–æ—Ö
              const nestedCategoriesList = document.getElementById('nestedCategoriesList');
              
              // –í–∏–¥–∞–ª—è—î–º–æ —Å—Ç–∞—Ä–∏–π listener —è–∫—â–æ –≤—ñ–Ω —ñ—Å–Ω—É—î
              if (nestedCategoriesList._nestedClickHandler) {
                nestedCategoriesList.removeEventListener('click', nestedCategoriesList._nestedClickHandler);
              }
              
              // –°—Ç–≤–æ—Ä—é—î–º–æ –Ω–æ–≤–∏–π handler (async –¥–ª—è Modal)
              nestedCategoriesList._nestedClickHandler = async (e) => {
                // Add subcategory shortcut (–∑–∞–º—ñ—Å—Ç—å onclick)
                if (e.target.closest('.btn-add-subcat-shortcut')) {
                  const catIndex = parseInt(e.target.closest('.btn-add-subcat-shortcut').dataset.catIndex);
                  const addBtn = nestedCategoriesList.querySelector(`.nested-subcat-add-btn[data-cat-index="${catIndex}"]`);
                  if (addBtn) addBtn.click();
                  return;
                }
                
                // Edit category
                if (e.target.closest('.btn-edit-nested-cat')) {
                  const catIndex = parseInt(e.target.closest('.btn-edit-nested-cat').dataset.catIndex);
                  const cat = tempNestedCategories[catIndex];
                  
                  const newLabel = await Modal.prompt('–í–≤–µ–¥—ñ—Ç—å –Ω–æ–≤—É –Ω–∞–∑–≤—É –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó', '', cat.label);
                  if (newLabel && newLabel !== cat.label) {
                    cat.label = newLabel;
                    renderNestedCategories();
                  }
                }
                
                // Delete category
                else if (e.target.closest('.btn-delete-nested-cat')) {
                  const confirmed = await Modal.confirm('–í–∏–¥–∞–ª–∏—Ç–∏ —Ü—é –∫–∞—Ç–µ–≥–æ—Ä—ñ—é?');
                  if (!confirmed) return;
                  
                  const catIndex = parseInt(e.target.closest('.btn-delete-nested-cat').dataset.catIndex);
                  tempNestedCategories.splice(catIndex, 1);
                  
                  renderNestedCategories();
                }
                
                // Add subcategory
                else if (e.target.closest('.nested-subcat-add-btn')) {
                  const catIndex = parseInt(e.target.closest('.nested-subcat-add-btn').dataset.catIndex);
                  const cat = tempNestedCategories[catIndex];
                  
                  const subId = await Modal.prompt('–í–≤–µ–¥—ñ—Ç—å ID –ø—ñ–¥–∫–∞—Ç–µ–≥–æ—Ä—ñ—ó', '—Ç—ñ–ª—å–∫–∏ –ª–∞—Ç–∏–Ω–∏—Ü—è, —Ü–∏—Ñ—Ä–∏, _, -');
                  if (!subId) return;
                  
                  if (!validateId(subId)) {
                    await Modal.confirm('–ù–µ–∫–æ—Ä–µ–∫—Ç–Ω–∏–π ID! –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ —Ç—ñ–ª—å–∫–∏ –ª–∞—Ç–∏–Ω—Å—å–∫—ñ –±—É–∫–≤–∏, —Ü–∏—Ñ—Ä–∏, –ø—ñ–¥–∫—Ä–µ—Å–ª–µ–Ω–Ω—è —Ç–∞ –¥–µ—Ñ—ñ—Å.', '–ü–æ–º–∏–ª–∫–∞');
                    return;
                  }
                  
                  const subLabel = await Modal.prompt('–í–≤–µ–¥—ñ—Ç—å –Ω–∞–∑–≤—É –ø—ñ–¥–∫–∞—Ç–µ–≥–æ—Ä—ñ—ó');
                  if (!subLabel) return;
                  
                  if (!cat.subcategories) cat.subcategories = [];
                  
                  if (cat.subcategories.find(s => s.id === subId)) {
                    await Modal.confirm('–ü—ñ–¥–∫–∞—Ç–µ–≥–æ—Ä—ñ—è –∑ —Ç–∞–∫–∏–º ID –≤–∂–µ —ñ—Å–Ω—É—î!', '–ü–æ–º–∏–ª–∫–∞');
                    return;
                  }
                  
                  cat.subcategories.push({id: subId, label: subLabel});
                  renderNestedCategories();
                }
                
                // Edit subcategory
                else if (e.target.closest('.btn-edit-nested-subcat')) {
                  const btn = e.target.closest('.btn-edit-nested-subcat');
                  const catIndex = parseInt(btn.dataset.catIndex);
                  const subIndex = parseInt(btn.dataset.subIndex);
                  const sub = tempNestedCategories[catIndex].subcategories[subIndex];
                  
                  const newLabel = await Modal.prompt('–í–≤–µ–¥—ñ—Ç—å –Ω–æ–≤—É –Ω–∞–∑–≤—É –ø—ñ–¥–∫–∞—Ç–µ–≥–æ—Ä—ñ—ó', '', sub.label);
                  if (newLabel && newLabel !== sub.label) {
                    sub.label = newLabel;
                    renderNestedCategories();
                  }
                }
                
                // Delete subcategory
                else if (e.target.closest('.btn-delete-nested-subcat')) {
                  const confirmed = await Modal.confirm('–í–∏–¥–∞–ª–∏—Ç–∏ —Ü—é –ø—ñ–¥–∫–∞—Ç–µ–≥–æ—Ä—ñ—é?');
                  if (!confirmed) return;
                  
                  const btn = e.target.closest('.btn-delete-nested-subcat');
                  const catIndex = parseInt(btn.dataset.catIndex);
                  const subIndex = parseInt(btn.dataset.subIndex);
                  tempNestedCategories[catIndex].subcategories.splice(subIndex, 1);
                  
                  renderNestedCategories();
                }
              };
              
              // –î–æ–¥–∞—î–º–æ listener –æ–¥–∏–Ω —Ä–∞–∑
              nestedCategoriesList.addEventListener('click', nestedCategoriesList._nestedClickHandler);
              
            }, 100);
          }
        }
      );
    },
    
    showCategoryModal(categoryId = null) {
      const category = categoryId ? State.config.categories.find(c => c.id === categoryId) : null;
      const isEdit = !!category;
      
      Modal.open(
        i18n.t(isEdit ? 'modal.editCategory' : 'modal.newCategory'),
        `
          <div class="form-group">
            <label class="form-label">${i18n.t('modal.categoryId')}</label>
            <input type="text" class="form-input" id="catId" value="${category ? category.id : ''}" ${isEdit ? 'readonly' : ''} required>
          </div>
          <div class="form-group">
            <label class="form-label">${i18n.t('modal.categoryName')}</label>
            <input type="text" class="form-input" id="catLabel" value="${category ? (category.originalLabel || category.label) : ''}" required>
            ${category ? `<small style="color: var(--text-muted); display: block; margin-top: 0.5rem;">üí° ${i18n.t('modal.customCategoryNote')}</small>` : ''}
          </div>
          <div class="form-group">
            <label class="form-label">${i18n.t('modal.icon')}</label>
            <input type="text" class="form-input" id="catIcon" value="${category ? category.icon : 'fa-folder'}" placeholder="${i18n.t('hints.iconPlaceholder')}">
          </div>
        `,
        {
          icon: 'fa-folder',
          onSave: async () => {
            const id = document.getElementById('catId').value.trim();
            const label = document.getElementById('catLabel').value.trim();
            const icon = document.getElementById('catIcon').value.trim() || 'fa-folder';
            
            if (!id || !label) {
              Toast.t('messages.fillAllFields', 'error');
              return false;
            }
            
            if (!isEdit && State.config.categories.find(c => c.id === id)) {
              Toast.t('messages.categoryExists', 'error');
              return false;
            }
            
            if (isEdit) {
              const index = State.config.categories.findIndex(c => c.id === categoryId);
              const existingCategory = State.config.categories[index];
              
              // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ —î –ø–µ—Ä–µ–∫–ª–∞–¥ –¥–ª—è —Ü—ñ—î—ó –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó (—á–∏ —Ü–µ –¥–µ—Ñ–æ–ª—Ç–Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è)
              const translationKey = `categories.${id}`;
              const hasTranslation = i18n.t(translationKey) !== translationKey;
              
              State.config.categories[index] = {
                id, 
                label, 
                icon,
                // –î–ª—è –∫–∞—Å—Ç–æ–º–Ω–∏—Ö –∫–∞—Ç–µ–≥–æ—Ä—ñ–π –æ–Ω–æ–≤–ª—é—î–º–æ originalLabel, –¥–ª—è –¥–µ—Ñ–æ–ª—Ç–Ω–∏—Ö - –∑–±–µ—Ä—ñ–≥–∞—î–º–æ
                originalLabel: hasTranslation ? existingCategory.originalLabel : label
              };
            } else {
              State.config.categories.push({
                id, 
                label, 
                icon,
                originalLabel: label // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω—É –Ω–∞–∑–≤—É –¥–ª—è –∫–∞—Å—Ç–æ–º–Ω–∏—Ö –∫–∞—Ç–µ–≥–æ—Ä—ñ–π
              });
            }
            
            SyncManager.markDirty(); // –ü–æ–∑–Ω–∞—á–∞—î–º–æ –∑–º—ñ–Ω–∏
            await Storage.save();
            Renderer.renderCategories();
            Toast.t(isEdit ? 'messages.categoryUpdated' : 'messages.categoryCreated');
            return true;
          }
        }
      );
    },
    
    // –í—ñ–¥–∫—Ä–∏–≤–∞—î —Ä–µ–¥–∞–∫—Ç–æ—Ä nested categories –≤ –æ–∫—Ä–µ–º–æ–º—É –º–æ–¥–∞–ª—å–Ω–æ–º—É –≤—ñ–∫–Ω—ñ
    openNestedCategoriesEditor(field) {
      return new Promise((resolve) => {
        let tempNestedCategories = [];
        if (field && field.nestedCategories) {
          try {
            tempNestedCategories = JSON.parse(JSON.stringify(field.nestedCategories));
          } catch (e) {
            Debug.error('Error copying nestedCategories:', e);
            tempNestedCategories = [];
          }
        }
        
        const contentHtml = `
          <div style="margin-bottom: 1rem;">
            <p style="color: var(--text-muted); margin-bottom: 0.75rem;">
              ${i18n.t('hints.nestedCategories') || '–°—Ç–≤–æ—Ä—ñ—Ç—å –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó —Ç–∞ –ø—ñ–¥–∫–∞—Ç–µ–≥–æ—Ä—ñ—ó –¥–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–≤–∞–Ω–æ–≥–æ –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö'}
            </p>
            <button type="button" class="btn btn-primary" id="btnAddNestedCategory">
              <i class="fas fa-plus"></i> ${i18n.t('ui.addCategory') || '–î–æ–¥–∞—Ç–∏ –∫–∞—Ç–µ–≥–æ—Ä—ñ—é'}
            </button>
          </div>
          <div id="nestedCategoriesList" style="max-height: 400px; overflow-y: auto;"></div>
        `;
        
        Modal.open(
          `${i18n.t('ui.manageCategories') || '–ö–µ—Ä—É–≤–∞—Ç–∏ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è–º–∏'}: ${field.label}`,
          contentHtml,
          {
            icon: 'fa-layer-group',
            size: 'large',
            onSave: () => {
              // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –∑–º—ñ–Ω–∏ –≤ –ø–æ–ª–µ
              field.nestedCategories = tempNestedCategories;
              Storage.save();
              resolve(tempNestedCategories);
              return true;
            },
            onOpen: () => {
              const renderNestedCategories = () => {
                const nestedCategoriesList = document.getElementById('nestedCategoriesList');
                
                if (tempNestedCategories.length === 0) {
                  nestedCategoriesList.innerHTML = '<div style="color: var(--text-muted); padding: 1rem; text-align: center;">–ù–µ–º–∞—î –≤–∫–ª–∞–¥–µ–Ω–∏—Ö –∫–∞—Ç–µ–≥–æ—Ä—ñ–π. –î–æ–¥–∞–π—Ç–µ –ø–µ—Ä—à—É –∫–∞—Ç–µ–≥–æ—Ä—ñ—é.</div>';
                } else {
                  nestedCategoriesList.innerHTML = tempNestedCategories.map((cat, catIndex) => `
                    <div class="nested-cat-item" data-cat-id="${Sanitizer.escapeHtml(cat.id)}" style="margin-bottom: 1rem; padding: 1rem; background: var(--bg-primary); border-radius: 6px;">
                      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                        <strong class="nested-cat-label">${Sanitizer.escapeHtml(cat.label)}</strong>
                        <div>
                          <button type="button" class="btn btn-sm btn-add-subcat-shortcut" data-cat-index="${catIndex}" style="padding: 0.25rem 0.5rem; margin-right: 0.25rem;">
                            <i class="fas fa-plus"></i>
                          </button>
                          <button type="button" class="btn btn-sm btn-edit-nested-cat" data-cat-index="${catIndex}" style="padding: 0.25rem 0.5rem; margin-right: 0.25rem;">
                            <i class="fas fa-edit"></i>
                          </button>
                          <button type="button" class="btn btn-sm btn-danger btn-delete-nested-cat" data-cat-index="${catIndex}" style="padding: 0.25rem 0.5rem;">
                            <i class="fas fa-trash"></i>
                          </button>
                        </div>
                      </div>
                      <div class="nested-subcats-list" style="margin-left: 1rem;">
                        ${(cat.subcategories || []).map((sub, subIndex) => `
                          <div class="nested-subcat-item" data-sub-id="${Sanitizer.escapeHtml(sub.id)}" style="display: flex; justify-content: space-between; align-items: center; padding: 0.5rem; margin-bottom: 0.25rem; background: var(--bg-secondary); border-radius: 4px;">
                            <span class="nested-subcat-label">${Sanitizer.escapeHtml(sub.label)}</span>
                            <div>
                              <button type="button" class="btn btn-sm btn-edit-nested-subcat" data-cat-index="${catIndex}" data-sub-index="${subIndex}" style="padding: 0.25rem 0.5rem; margin-right: 0.25rem;">
                                <i class="fas fa-edit"></i>
                              </button>
                              <button type="button" class="btn btn-sm btn-danger btn-delete-nested-subcat" data-cat-index="${catIndex}" data-sub-index="${subIndex}" style="padding: 0.25rem 0.5rem;">
                                <i class="fas fa-trash"></i>
                              </button>
                            </div>
                          </div>
                        `).join('')}
                      </div>
                      <button type="button" class="btn btn-sm nested-subcat-add-btn" data-cat-index="${catIndex}" style="margin-top: 0.5rem; padding: 0.25rem 0.5rem;">
                        <i class="fas fa-plus"></i> –î–æ–¥–∞—Ç–∏ –ø—ñ–¥–∫–∞—Ç–µ–≥–æ—Ä—ñ—é
                      </button>
                    </div>
                  `).join('');
                }
              };
              
              renderNestedCategories();
              
              document.getElementById('btnAddNestedCategory').addEventListener('click', async () => {
                const catId = await Modal.prompt('–í–≤–µ–¥—ñ—Ç—å ID –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó', '—Ç—ñ–ª—å–∫–∏ –ª–∞—Ç–∏–Ω–∏—Ü—è, —Ü–∏—Ñ—Ä–∏, _, -');
                if (!catId) return;
                
                if (!validateId(catId)) {
                  await Modal.confirm('–ù–µ–∫–æ—Ä–µ–∫—Ç–Ω–∏–π ID! –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ —Ç—ñ–ª—å–∫–∏ –ª–∞—Ç–∏–Ω—Å—å–∫—ñ –±—É–∫–≤–∏, —Ü–∏—Ñ—Ä–∏, –ø—ñ–¥–∫—Ä–µ—Å–ª–µ–Ω–Ω—è —Ç–∞ –¥–µ—Ñ—ñ—Å.', '–ü–æ–º–∏–ª–∫–∞');
                  return;
                }
                
                const catLabel = await Modal.prompt('–í–≤–µ–¥—ñ—Ç—å –Ω–∞–∑–≤—É –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó');
                if (!catLabel) return;
                
                if (tempNestedCategories.find(c => c.id === catId)) {
                  await Modal.confirm('–ö–∞—Ç–µ–≥–æ—Ä—ñ—è –∑ —Ç–∞–∫–∏–º ID –≤–∂–µ —ñ—Å–Ω—É—î!', '–ü–æ–º–∏–ª–∫–∞');
                  return;
                }
                
                tempNestedCategories.push({id: catId, label: catLabel, subcategories: []});
                renderNestedCategories();
              });
              
              const nestedCategoriesList = document.getElementById('nestedCategoriesList');
              
              if (nestedCategoriesList._nestedClickHandler) {
                nestedCategoriesList.removeEventListener('click', nestedCategoriesList._nestedClickHandler);
              }
              
              nestedCategoriesList._nestedClickHandler = async (e) => {
                if (e.target.closest('.btn-add-subcat-shortcut')) {
                  const catIndex = parseInt(e.target.closest('.btn-add-subcat-shortcut').dataset.catIndex);
                  const addBtn = nestedCategoriesList.querySelector(`.nested-subcat-add-btn[data-cat-index="${catIndex}"]`);
                  if (addBtn) addBtn.click();
                  return;
                }
                
                if (e.target.closest('.btn-edit-nested-cat')) {
                  const catIndex = parseInt(e.target.closest('.btn-edit-nested-cat').dataset.catIndex);
                  const cat = tempNestedCategories[catIndex];
                  
                  const newLabel = await Modal.prompt('–í–≤–µ–¥—ñ—Ç—å –Ω–æ–≤—É –Ω–∞–∑–≤—É –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó', '', cat.label);
                  if (newLabel && newLabel !== cat.label) {
                    cat.label = newLabel;
                    renderNestedCategories();
                  }
                }
                
                else if (e.target.closest('.btn-delete-nested-cat')) {
                  const confirmed = await Modal.confirm('–í–∏–¥–∞–ª–∏—Ç–∏ —Ü—é –∫–∞—Ç–µ–≥–æ—Ä—ñ—é?');
                  if (!confirmed) return;
                  
                  const catIndex = parseInt(e.target.closest('.btn-delete-nested-cat').dataset.catIndex);
                  tempNestedCategories.splice(catIndex, 1);
                  renderNestedCategories();
                }
                
                else if (e.target.closest('.nested-subcat-add-btn')) {
                  const catIndex = parseInt(e.target.closest('.nested-subcat-add-btn').dataset.catIndex);
                  const cat = tempNestedCategories[catIndex];
                  
                  const subId = await Modal.prompt('–í–≤–µ–¥—ñ—Ç—å ID –ø—ñ–¥–∫–∞—Ç–µ–≥–æ—Ä—ñ—ó', '—Ç—ñ–ª—å–∫–∏ –ª–∞—Ç–∏–Ω–∏—Ü—è, —Ü–∏—Ñ—Ä–∏, _, -');
                  if (!subId) return;
                  
                  if (!validateId(subId)) {
                    await Modal.confirm('–ù–µ–∫–æ—Ä–µ–∫—Ç–Ω–∏–π ID! –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ —Ç—ñ–ª—å–∫–∏ –ª–∞—Ç–∏–Ω—Å—å–∫—ñ –±—É–∫–≤–∏, —Ü–∏—Ñ—Ä–∏, –ø—ñ–¥–∫—Ä–µ—Å–ª–µ–Ω–Ω—è —Ç–∞ –¥–µ—Ñ—ñ—Å.', '–ü–æ–º–∏–ª–∫–∞');
                    return;
                  }
                  
                  const subLabel = await Modal.prompt('–í–≤–µ–¥—ñ—Ç—å –Ω–∞–∑–≤—É –ø—ñ–¥–∫–∞—Ç–µ–≥–æ—Ä—ñ—ó');
                  if (!subLabel) return;
                  
                  if (!cat.subcategories) cat.subcategories = [];
                  
                  if (cat.subcategories.find(s => s.id === subId)) {
                    await Modal.confirm('–ü—ñ–¥–∫–∞—Ç–µ–≥–æ—Ä—ñ—è –∑ —Ç–∞–∫–∏–º ID –≤–∂–µ —ñ—Å–Ω—É—î!', '–ü–æ–º–∏–ª–∫–∞');
                    return;
                  }
                  
                  cat.subcategories.push({id: subId, label: subLabel});
                  renderNestedCategories();
                }
                
                else if (e.target.closest('.btn-edit-nested-subcat')) {
                  const btn = e.target.closest('.btn-edit-nested-subcat');
                  const catIndex = parseInt(btn.dataset.catIndex);
                  const subIndex = parseInt(btn.dataset.subIndex);
                  const sub = tempNestedCategories[catIndex].subcategories[subIndex];
                  
                  const newLabel = await Modal.prompt('–í–≤–µ–¥—ñ—Ç—å –Ω–æ–≤—É –Ω–∞–∑–≤—É –ø—ñ–¥–∫–∞—Ç–µ–≥–æ—Ä—ñ—ó', '', sub.label);
                  if (newLabel && newLabel !== sub.label) {
                    sub.label = newLabel;
                    renderNestedCategories();
                  }
                }
                
                else if (e.target.closest('.btn-delete-nested-subcat')) {
                  const confirmed = await Modal.confirm('–í–∏–¥–∞–ª–∏—Ç–∏ —Ü—é –ø—ñ–¥–∫–∞—Ç–µ–≥–æ—Ä—ñ—é?');
                  if (!confirmed) return;
                  
                  const btn = e.target.closest('.btn-delete-nested-subcat');
                  const catIndex = parseInt(btn.dataset.catIndex);
                  const subIndex = parseInt(btn.dataset.subIndex);
                  tempNestedCategories[catIndex].subcategories.splice(subIndex, 1);
                  renderNestedCategories();
                }
              };
              
              nestedCategoriesList.addEventListener('click', nestedCategoriesList._nestedClickHandler);
            }
          }
        );
      });
    },
    
    editFieldValue(fieldId) {
      const field = State.config.fields.find(f => f.id === fieldId);
      if (!field) return;
      
      // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –∫–æ–Ω—Ç–µ–Ω—Ç—É (—â–æ–± –º–æ–∂–Ω–∞ –±—É–ª–æ –æ–Ω–æ–≤–∏—Ç–∏ –¥–∏–Ω–∞–º—ñ—á–Ω–æ)
      // –í–ê–ñ–õ–ò–í–û: –∑–∞–≤–∂–¥–∏ –æ—Ç—Ä–∏–º—É—î–º–æ –∞–∫—Ç—É–∞–ª—å–Ω–∏–π field –∑—ñ State, –∞ –Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –∑–∞–º–∏–∫–∞–Ω–Ω—è
      const generateContent = () => {
        const currentField = State.config.fields.find(f => f.id === fieldId) || field;
        const value = State.values[fieldId];
        let contentHtml = '';
        
        if (currentField.type === 'text' || currentField.type === 'date') {
          contentHtml = `
            <div class="form-group">
              <label class="form-label">${currentField.label}</label>
              <input type="${currentField.type}" class="form-input" id="fieldValue" value="${value || ''}">
              ${currentField.type === 'text' ? `<small style="color: var(--text-muted); display: block; margin-top: 0.5rem;">üí° ${i18n.t('hints.formatting')}<br>üé® ${i18n.t('hints.selectTextForFormatting')}</small>` : ''}
            </div>
          `;
        } else if (currentField.type === 'textarea') {
          contentHtml = `
            <div class="form-group">
              <label class="form-label">${currentField.label}</label>
              <textarea class="form-textarea" id="fieldValue">${value || ''}</textarea>
              <small style="color: var(--text-muted); display: block; margin-top: 0.5rem;">üí° ${i18n.t('hints.formatting')}<br>üé® ${i18n.t('hints.selectTextForFormatting')}</small>
            </div>
          `;
        } else if (currentField.type === 'tags') {
          const tags = Array.isArray(value) ? value.join(', ') : (value || '');
          contentHtml = `
            <div class="form-group">
              <label class="form-label">${currentField.label}</label>
              <input type="text" class="form-input" id="fieldValue" value="${tags}" placeholder="${i18n.t('hints.tagsPlaceholder')}">
              <small style="color: var(--text-muted); display: block; margin-top: 0.5rem;">${i18n.t('hints.separateTagsWithCommas')}</small>
            </div>
          `;
        } else if (currentField.type === 'nested') {
          const hasCategories = currentField.nestedCategories && currentField.nestedCategories.length > 0;
          
          if (!hasCategories) {
            // –Ø–∫—â–æ –Ω–µ–º–∞—î –∫–∞—Ç–µ–≥–æ—Ä—ñ–π - –ø–æ–∫–∞–∑—É—î–º–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
            contentHtml = `
              <div style="padding: 2rem; text-align: center; color: var(--text-muted);">
                <i class="fas fa-folder-open" style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.5;"></i>
                <p style="margin-bottom: 1rem;">${i18n.t('messages.noNestedCategories') || '–ù–µ–º–∞—î –≤–∫–ª–∞–¥–µ–Ω–∏—Ö –∫–∞—Ç–µ–≥–æ—Ä—ñ–π'}</p>
                <button type="button" class="btn btn-primary" id="btnEditNestedCategories">
                  <i class="fas fa-cog"></i> ${i18n.t('ui.manageCategories') || '–ö–µ—Ä—É–≤–∞—Ç–∏ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è–º–∏'}
                </button>
              </div>
            `;
          } else {
            // –Ø–∫—â–æ —î –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó - –ø–æ–∫–∞–∑—É—î–º–æ —Ñ–æ—Ä–º—É + –∫–Ω–æ–ø–∫—É —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è
            contentHtml = '<div>';
            contentHtml += `
              <div style="margin-bottom: 1rem; display: flex; justify-content: space-between; align-items: center;">
                <span style="font-weight: 600; color: var(--text-muted);">${i18n.t('ui.values') || '–ó–Ω–∞—á–µ–Ω–Ω—è'}</span>
                <button type="button" class="btn btn-secondary btn-sm" id="btnEditNestedCategories">
                  <i class="fas fa-cog"></i> ${i18n.t('ui.manageCategories') || '–ö–µ—Ä—É–≤–∞—Ç–∏ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è–º–∏'}
                </button>
              </div>
            `;
            
            (currentField.nestedCategories || []).forEach(cat => {
              contentHtml += `<div style="margin-bottom: 1.5rem;">
                <div style="font-weight: 600; margin-bottom: 0.75rem;">${cat.label}</div>`;
              (cat.subcategories || []).forEach(sub => {
                const val = (value && value[cat.id] && value[cat.id][sub.id]) ? value[cat.id][sub.id].join(', ') : '';
                contentHtml += `
                  <div class="form-group">
                    <label class="form-label">${sub.label}</label>
                    <input type="text" class="form-input" data-cat="${cat.id}" data-sub="${sub.id}" value="${val}" placeholder="${i18n.t('hints.valuesPlaceholder')}">
                  </div>
                `;
              });
              contentHtml += '</div>';
            });
            contentHtml += '</div>';
          }
        }
        
        return contentHtml;
      };
      
      // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó –æ–±—Ä–æ–±–Ω–∏–∫–∞ –∫–Ω–æ–ø–∫–∏
      const initEditCategoriesButton = () => {
        const btnEditCategories = document.getElementById('btnEditNestedCategories');
        if (btnEditCategories) {
          btnEditCategories.onclick = async () => {
            // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ—Ç–æ—á–Ω–µ –º–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ (editFieldValue) –î–û –≤—ñ–¥–∫—Ä–∏—Ç—Ç—è —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞
            const currentModal = Modal.modalStack[Modal.modalStack.length - 1];
            
            // –í—ñ–¥–∫—Ä–∏–≤–∞—î–º–æ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è nested categories
            await this.openNestedCategoriesEditor(field);
            
            // –ù–µ–≤–µ–ª–∏–∫–∞ –∑–∞—Ç—Ä–∏–º–∫–∞, —â–æ–± –º–æ–¥–∞–ª–∫–∞ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ –≤—Å—Ç–∏–≥–ª–∞ –∑–∞–∫—Ä–∏—Ç–∏—Å—å (–∞–Ω—ñ–º–∞—Ü—ñ—è 200ms)
            await new Promise(resolve => setTimeout(resolve, 250));
            
            Debug.log('–û–Ω–æ–≤–ª—é—î–º–æ –∫–æ–Ω—Ç–µ–Ω—Ç editFieldValue –ø—ñ—Å–ª—è —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –∫–∞—Ç–µ–≥–æ—Ä—ñ–π');
            const updatedField = State.config.fields.find(f => f.id === fieldId);
            Debug.log('–ö—ñ–ª—å–∫—ñ—Å—Ç—å –∫–∞—Ç–µ–≥–æ—Ä—ñ–π:', updatedField && updatedField.nestedCategories ? updatedField.nestedCategories.length : 0);
            if (updatedField && updatedField.nestedCategories) {
              Debug.log('–ö–∞—Ç–µ–≥–æ—Ä—ñ—ó:', updatedField.nestedCategories.map(c => c.label).join(', '));
            }
            
            // –ü—ñ—Å–ª—è –∑–∞–∫—Ä–∏—Ç—Ç—è —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ - –æ–Ω–æ–≤–ª—é—î–º–æ –∫–æ–Ω—Ç–µ–Ω—Ç –î–ò–ù–ê–ú–Ü–ß–ù–û
            // –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –∑–±–µ—Ä–µ–∂–µ–Ω–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –º–æ–¥–∞–ª–∫—É editFieldValue
            let modalBody;
            
            if (currentModal.isMain) {
              // –Ø–∫—â–æ –æ—Å–Ω–æ–≤–Ω–µ –º–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ - –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ Modal.body
              modalBody = Modal.body;
              Debug.log('–û–Ω–æ–≤–ª–µ–Ω–Ω—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –≤—ñ–∫–Ω–∞');
            } else {
              // –Ø–∫—â–æ overlay –º–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ - —à—É–∫–∞—î–º–æ –≤ –π–æ–≥–æ backdrop
              modalBody = currentModal.backdrop.querySelector('.modal-body');
              Debug.log('–û–Ω–æ–≤–ª–µ–Ω–Ω—è overlay –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –≤—ñ–∫–Ω–∞');
            }
            
            if (modalBody) {
              const newContent = generateContent();
              Debug.log('–ù–æ–≤–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–æ, –¥–æ–≤–∂–∏–Ω–∞ HTML:', newContent.length);
              modalBody.innerHTML = newContent;
              // –ü–µ—Ä–µ—ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É—î–º–æ –æ–±—Ä–æ–±–Ω–∏–∫ –∫–Ω–æ–ø–∫–∏ –ø—ñ—Å–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫–æ–Ω—Ç–µ–Ω—Ç—É
              initEditCategoriesButton();
              Debug.log('–ö–æ–Ω—Ç–µ–Ω—Ç –æ–Ω–æ–≤–ª–µ–Ω–æ —É—Å–ø—ñ—à–Ω–æ');
            } else {
              Debug.error('modalBody –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ!');
            }
          };
        }
      };
      
      Modal.open(
        `${i18n.t('modal.editValue')}: ${field.label}`,
        generateContent(),
        {
          icon: 'fa-edit',
          onOpen: () => {
            // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É—î–º–æ –æ–±—Ä–æ–±–Ω–∏–∫ –∫–Ω–æ–ø–∫–∏ "–ö–µ—Ä—É–≤–∞—Ç–∏ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è–º–∏"
            initEditCategoriesButton();
          },
          onSave: async () => {
            // –û—Ç—Ä–∏–º—É—î–º–æ –∞–∫—Ç—É–∞–ª—å–Ω–∏–π field –∑—ñ State
            const currentField = State.config.fields.find(f => f.id === fieldId) || field;
            
            if (currentField.type === 'nested') {
              const newValue = {};
              (currentField.nestedCategories || []).forEach(cat => {
                newValue[cat.id] = {};
                (cat.subcategories || []).forEach(sub => {
                  // –®—É–∫–∞—î–º–æ input –≤ –ø–æ—Ç–æ—á–Ω—ñ–π –º–æ–¥–∞–ª—Ü—ñ (–º–æ–∂–µ –±—É—Ç–∏ –æ—Å–Ω–æ–≤–Ω–æ—é –∞–±–æ overlay)
                  const topModal = Modal.modalStack[Modal.modalStack.length - 1];
                  let container;
                  if (topModal.isMain) {
                    container = Modal.body;
                  } else {
                    container = topModal.backdrop;
                  }
                  
                  const input = container.querySelector(`[data-cat="${cat.id}"][data-sub="${sub.id}"]`);
                  if (input && input.value) {
                    newValue[cat.id][sub.id] = input.value.split(',').map(v => v.trim()).filter(Boolean);
                  } else {
                    newValue[cat.id][sub.id] = [];
                  }
                });
              });
              State.values[fieldId] = newValue;
            } else if (currentField.type === 'tags') {
              const input = document.getElementById('fieldValue');
              State.values[fieldId] = input.value.split(',').map(v => v.trim()).filter(Boolean);
            } else {
              const input = document.getElementById('fieldValue');
              State.values[fieldId] = input.value;
            }
            
            // –ü–æ–∑–Ω–∞—á–∞—î–º–æ —â–æ —î –Ω–µ–∑–±–µ—Ä–µ–∂–µ–Ω—ñ –∑–º—ñ–Ω–∏
            SyncManager.markDirty();
            
            await Storage.save();
            Renderer.renderContent();
            Progress.update();
            Toast.t('messages.valueUpdated');
            return true;
          }
        }
      );
    },
    
    editField(fieldId) {
      this.showFieldModal(fieldId);
    },
    
    editCategory(categoryId) {
      this.showCategoryModal(categoryId);
    },
    
    toggleFieldMenu(event, fieldId) {
      event.stopPropagation();
      const menu = document.getElementById(`fieldMenu_${fieldId}`);
      const allMenus = document.querySelectorAll('.field-controls-popup');
      
      // –ó–∞–∫—Ä–∏–≤–∞—î–º–æ –≤—Å—ñ —ñ–Ω—à—ñ –º–µ–Ω—é
      allMenus.forEach(m => {
        if (m !== menu) m.classList.remove('active');
      });
      
      // Toggle –ø–æ—Ç–æ—á–Ω–µ –º–µ–Ω—é
      menu.classList.toggle('active');
      
      // –ó–∞–∫—Ä–∏–≤–∞—î–º–æ –º–µ–Ω—é –ø—Ä–∏ –∫–ª—ñ–∫—É –ø–æ–∑–∞ –Ω–∏–º
      if (menu.classList.contains('active')) {
        setTimeout(() => {
          document.addEventListener('click', function closeMenu(e) {
            if (!menu.contains(e.target)) {
              menu.classList.remove('active');
              document.removeEventListener('click', closeMenu);
            }
          });
        }, 0);
      }
    },
    
    closeFieldMenu(fieldId) {
      const menu = document.getElementById(`fieldMenu_${fieldId}`);
      if (menu) menu.classList.remove('active');
    },
    
    async deleteField(fieldId) {
      const confirmMessage = i18n.t('messages.confirmDeleteField') || '–í–∏–¥–∞–ª–∏—Ç–∏ —Ü–µ –ø–æ–ª–µ?';
      if (!await Modal.confirm(confirmMessage)) return;
      
      State.config.fields = State.config.fields.filter(f => f.id !== fieldId);
      delete State.values[fieldId];
      SyncManager.markDirty(); // –ü–æ–∑–Ω–∞—á–∞—î–º–æ –∑–º—ñ–Ω–∏
      await Storage.save();
      Renderer.renderContent();
      Progress.update();
      Toast.t('messages.fieldDeleted');
    },
    
    // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î —Ñ—ñ–ª—å—Ç—Ä –∑–∞–ø–æ–≤–Ω–µ–Ω–æ—Å—Ç—ñ
    setFillFilter(filter) {
      State.ui.fillFilter = filter;
      Renderer.renderContent();
      Progress.update();
      
      const messageKey = {
        all: 'messages.showAll',
        filled: 'messages.showFilled',
        empty: 'messages.showEmpty'
      };
      Toast.t(messageKey[filter] || 'messages.showAll');
      
      // –û–Ω–æ–≤–ª—é—î–º–æ badge
      this.updateFiltersBadge();
    },
    
    // –£–Ω—ñ–≤–µ—Ä—Å–∞–ª—å–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è –¥–ª—è toggle dropdown
    toggleDropdown(dropdownId, buttonId) {
      const dropdown = document.getElementById(dropdownId);
      const toggleBtn = document.getElementById(buttonId);
      
      if (!dropdown || !toggleBtn) return;
      
      const isActive = dropdown.classList.contains('active');
      
      if (isActive) {
        // –ó–∞–∫—Ä–∏–≤–∞—î–º–æ –∑ –∞–Ω—ñ–º–∞—Ü—ñ—î—é
        dropdown.classList.remove('active');
        dropdown.classList.add('closing');
        toggleBtn.classList.remove('active');
        
        setTimeout(() => {
          dropdown.classList.remove('closing');
        }, DELAYS.DROPDOWN_ANIMATION);
      } else {
        // –í—ñ–¥–∫—Ä–∏–≤–∞—î–º–æ
        dropdown.classList.add('active');
        toggleBtn.classList.add('active');
        
        // –ó–∞–∫—Ä–∏–≤–∞—î–º–æ dropdown –ø—Ä–∏ –∫–ª—ñ–∫—É –ø–æ–∑–∞ –Ω–∏–º
        setTimeout(() => {
          document.addEventListener('click', function closeDropdown(e) {
            if (!dropdown.contains(e.target) && !toggleBtn.contains(e.target)) {
              dropdown.classList.remove('active');
              dropdown.classList.add('closing');
              toggleBtn.classList.remove('active');
              document.removeEventListener('click', closeDropdown);
              
              setTimeout(() => {
                dropdown.classList.remove('closing');
              }, DELAYS.DROPDOWN_ANIMATION);
            }
          });
        }, 0);
      }
    },
    
    // Toggle filters dropdown
    toggleFiltersDropdown() {
      this.toggleDropdown('filtersDropdown', 'filtersToggleBtn');
    },
    
    // Toggle —Ñ—ñ–ª—å—Ç—Ä –≤–∞–∂–ª–∏–≤–æ—Å—Ç—ñ (–º–Ω–æ–∂–∏–Ω–Ω–∏–π –≤–∏–±—ñ—Ä)
    toggleImportanceFilter(importance) {
      const index = State.ui.importanceFilters.indexOf(importance);
      
      if (index > -1) {
        // –í–∏–¥–∞–ª—è—î–º–æ —è–∫—â–æ –≤–∂–µ —î
        State.ui.importanceFilters.splice(index, 1);
      } else {
        // –î–æ–¥–∞—î–º–æ —è–∫—â–æ –Ω–µ–º–∞—î
        State.ui.importanceFilters.push(importance);
      }
      
      Renderer.renderContent();
      Progress.update();
      
      if (State.ui.importanceFilters.length === 0) {
        Toast.t('messages.allImportance');
      }
      
      // –û–Ω–æ–≤–ª—é—î–º–æ badge
      this.updateFiltersBadge();
    },
    
    // Toggle header menu dropdown
    toggleHeaderMenu() {
      this.toggleDropdown('headerMenuDropdown', 'headerMenuBtn');
    },
    
    // –í—ñ–¥–∫—Ä–∏—Ç–∏ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó
    openSyncSettings() {
      Modal.open(i18n.t('modal.syncSettings'), this.renderSyncSettingsModal(), {
        icon: 'fa-sync-alt',
        size: 'large',
        onSave: async () => {
          return await this.saveSyncSettings();
        },
        onOpen: () => {
          this.initSyncModalListeners();
        }
      });
    },
    
    // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è event listeners –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –≤—ñ–∫–Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó
    initSyncModalListeners() {
      // –ü–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è —Ä–µ–∂–∏–º—É –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è
      document.querySelectorAll('input[name="storageMode"]').forEach(radio => {
        radio.addEventListener('change', (e) => {
          const mode = e.target.value;
          const googleSheetsSettings = document.getElementById('googleSheetsSettings');
          googleSheetsSettings.style.display = mode === 'googleSheets' ? 'block' : 'none';
        });
      });
      
      // –ê–≤—Ç–æ—Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è checkbox
      const autoSyncCheckbox = document.getElementById('syncAutoSync');
      if (autoSyncCheckbox) {
        autoSyncCheckbox.addEventListener('change', (e) => {
          const intervalRow = document.getElementById('autoSyncIntervalRow');
          intervalRow.style.display = e.target.checked ? 'flex' : 'none';
        });
      }
      
      // –®–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è checkbox
      const encryptionCheckbox = document.getElementById('syncEncryption');
      if (encryptionCheckbox) {
        encryptionCheckbox.addEventListener('change', (e) => {
          const passwordFields = document.getElementById('encryptionPasswordFields');
          passwordFields.style.display = e.target.checked ? 'block' : 'none';
        });
      }
      
      // Client ID input - –∞–∫—Ç–∏–≤—É–≤–∞—Ç–∏ –∫–Ω–æ–ø–∫—É –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó
      const clientIdInput = document.getElementById('syncClientId');
      const authorizeBtn = document.getElementById('btnAuthorizeGoogle');
      if (clientIdInput && authorizeBtn) {
        clientIdInput.addEventListener('input', (e) => {
          authorizeBtn.disabled = !e.target.value.trim();
        });
      }
      
      // –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è –≤ Google
      if (authorizeBtn) {
        authorizeBtn.addEventListener('click', async () => {
          const clientId = document.getElementById('syncClientId').value.trim();
          if (!clientId) {
            Toast.t('messages.enterClientId', 'error');
            return;
          }
          
          try {
            Toast.show('‚è≥ ' + i18n.t('sync.initializing'), 'info');
            
            // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É—î–º–æ Google API
            await GoogleSheetsSync.initGapi();
            await GoogleSheetsSync.initGis(clientId);
            
            // –ê–≤—Ç–æ—Ä–∏–∑—É—î–º–æ—Å—è
            await GoogleSheetsSync.authorize();
            
            Toast.show('‚úÖ ' + i18n.t('sync.authorized'));
            
            // –ü–æ–∫–∞–∑—É—î–º–æ –∫–Ω–æ–ø–∫—É —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç–∞–±–ª–∏—Ü—ñ
            document.getElementById('btnCreateSpreadsheet').style.display = 'inline-flex';
          } catch (error) {
            console.error('Authorization error:', error);
            Toast.show('‚ùå ' + i18n.t('sync.errorAuth') + ': ' + error.message, 'error');
          }
        });
      }
      
      // –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç–∞–±–ª–∏—Ü—ñ
      const createSpreadsheetBtn = document.getElementById('btnCreateSpreadsheet');
      if (createSpreadsheetBtn) {
        createSpreadsheetBtn.addEventListener('click', async () => {
          try {
            Toast.show('‚è≥ ' + i18n.t('sync.createSpreadsheet') + '...', 'info');
            
            const result = await GoogleSheetsSync.createSpreadsheet();
            
            State.sync.googleSheets.spreadsheetId = result.spreadsheetId;
            
            // –û–Ω–æ–≤–ª—é—î–º–æ UI
            document.getElementById('syncSpreadsheetId').value = result.spreadsheetId;
            document.getElementById('spreadsheetIdRow').style.display = 'flex';
            document.getElementById('btnOpenSpreadsheet').style.display = 'inline-flex';
            document.getElementById('migrationSection').style.display = 'block';
            
            Toast.show('‚úÖ ' + i18n.t('sync.spreadsheetCreated') + ' <a href="' + result.url + '" target="_blank">' + i18n.t('sync.openLink') + '</a>');
          } catch (error) {
            console.error('Create spreadsheet error:', error);
            Toast.show('‚ùå ' + i18n.t('sync.errorCreateSheet') + ': ' + error.message, 'error');
          }
        });
      }
      
      // –í—ñ–¥–∫—Ä–∏—Ç–∏ —Ç–∞–±–ª–∏—Ü—é
      const openSpreadsheetBtn = document.getElementById('btnOpenSpreadsheet');
      if (openSpreadsheetBtn) {
        openSpreadsheetBtn.addEventListener('click', () => {
          const spreadsheetId = State.sync.googleSheets.spreadsheetId;
          if (spreadsheetId) {
            window.open(`https://docs.google.com/spreadsheets/d/${spreadsheetId}`, '_blank');
          }
        });
      }
      
      // –ï–∫—Å–ø–æ—Ä—Ç Local ‚Üí Google Sheets
      const uploadBtn = document.getElementById('btnUploadToSheets');
      if (uploadBtn) {
        uploadBtn.addEventListener('click', async () => {
          if (!GoogleSheetsSync.isAuthorized()) {
            Toast.t('messages.needAuth', 'error');
            return;
          }
          
          try {
            Toast.show('‚è≥ ' + i18n.t('sync.uploadingData'), 'info');
            
            const password = State.sync.googleSheets.encryptionEnabled ? 
              sessionStorage.getItem('encryption_password') : null;
            
            await GoogleSheetsSync.uploadData(State.config, State.values, password);
            
            State.sync.googleSheets.lastSync = new Date().toISOString();
            Storage.saveSyncSettings();
            
            Toast.t('messages.exported');
          } catch (error) {
            console.error('Upload error:', error);
            Toast.show('‚ùå ' + i18n.t('messages.syncError') + ': ' + error.message, 'error');
          }
        });
      }
      
      // –Ü–º–ø–æ—Ä—Ç Google Sheets ‚Üí Local
      const downloadBtn = document.getElementById('btnDownloadFromSheets');
      if (downloadBtn) {
        downloadBtn.addEventListener('click', async () => {
          if (!GoogleSheetsSync.isAuthorized()) {
            Toast.t('messages.needAuth', 'error');
            return;
          }
          
          try {
            Toast.show('‚è≥ ' + i18n.t('sync.downloadingData'), 'info');
            
            const password = State.sync.googleSheets.encryptionEnabled ? 
              sessionStorage.getItem('encryption_password') : null;
            
            const result = await GoogleSheetsSync.downloadData(password);
            
            State.config = result.config;
            State.values = result.values;
            
            // –ù–ï –ø–æ–∑–Ω–∞—á–∞—î–º–æ —è–∫ dirty - —Ü–µ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–æ–≤–∞–Ω—ñ –¥–∞–Ω—ñ!
            SyncManager.hasUnsyncedChanges = false;
            
            // –û–Ω–æ–≤–ª—é—î–º–æ localStorage —è–∫ backup
            await Storage.save();
            
            // –ü–µ—Ä–µ—Ä–µ–Ω–¥–µ—Ä—é—î–º–æ UI
            Renderer.renderCategories();
            Renderer.renderContent();
            Progress.update();
            
            Toast.t('messages.imported');
          } catch (error) {
            console.error('Download error:', error);
            Toast.show('‚ùå ' + i18n.t('messages.syncError') + ': ' + error.message, 'error');
          }
        });
      }
      
      // –°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É–≤–∞—Ç–∏ –∑–∞—Ä–∞–∑
      const syncNowBtn = document.getElementById('btnSyncNow');
      if (syncNowBtn) {
        syncNowBtn.addEventListener('click', async () => {
          await SyncManager.manualSync();
        });
      }
    },
    
    // –†–µ–Ω–¥–µ—Ä –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –≤—ñ–∫–Ω–∞ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó
    renderSyncSettingsModal() {
      const currentMode = State.sync.mode;
      const gs = State.sync.googleSheets;
      
      return `
        <!-- –†–æ–∑–¥—ñ–ª 1: –†–µ–∂–∏–º –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è -->
        <div class="settings-section">
          <div class="settings-section-title">
            <i class="fas fa-database"></i>
            ${i18n.t('sync.storageMode')}
          </div>
          
          <div class="radio-group">
            <label class="radio-option">
              <input type="radio" name="storageMode" value="localStorage" ${currentMode === 'localStorage' ? 'checked' : ''}>
              <div class="radio-option-content">
                <span class="radio-option-label">${i18n.t('sync.localMode')}</span>
                <span class="radio-option-desc">${i18n.t('sync.localModeDesc')}</span>
              </div>
            </label>
            
            <label class="radio-option">
              <input type="radio" name="storageMode" value="googleSheets" ${currentMode === 'googleSheets' ? 'checked' : ''}>
              <div class="radio-option-content">
                <span class="radio-option-label">${i18n.t('sync.googleSheetsMode')}</span>
                <span class="radio-option-desc">${i18n.t('sync.googleSheetsModeDesc')}</span>
              </div>
            </label>
            
            <label class="radio-option">
              <input type="radio" name="storageMode" value="manual" ${currentMode === 'manual' ? 'checked' : ''}>
              <div class="radio-option-content">
                <span class="radio-option-label">${i18n.t('sync.manualMode')}</span>
                <span class="radio-option-desc">${i18n.t('sync.manualModeDesc')}</span>
              </div>
            </label>
          </div>
        </div>
        
        <!-- –†–æ–∑–¥—ñ–ª 2: Google Sheets –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è -->
        <div class="settings-section" id="googleSheetsSettings" style="display: ${currentMode === 'googleSheets' ? 'block' : 'none'}">
          <div class="settings-section-title">
            <i class="fab fa-google"></i>
            ${i18n.t('sync.googleSheetsSettings')}
          </div>
          
          <!-- –Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è -->
          <div class="instruction-block">
            <div class="instruction-toggle">
              <i class="fas fa-chevron-down"></i>
              <span>${i18n.t('sync.stepByStepInstructions')}</span>
            </div>
            <div class="instruction-content">
              <h4>${i18n.t('sync.step1')}</h4>
              <ol>
                <li>${i18n.t('instructions.goTo')}: <code>https://console.cloud.google.com</code></li>
                <li>${i18n.t('instructions.click')} "New Project"</li>
                <li>${i18n.t('sync.projectName')}: "My Dossier" (–∞–±–æ –±—É–¥—å-—è–∫–∞)</li>
                <li>${i18n.t('instructions.click')} "Create"</li>
              </ol>
              
              <h4>${i18n.t('sync.step2')}</h4>
              <ol>
                <li>–ú–µ–Ω—é ‚Üí "APIs & Services" ‚Üí "Library"</li>
                <li>${i18n.t('instructions.find')} "Google Sheets API"</li>
                <li>${i18n.t('instructions.click')} "Enable"</li>
              </ol>
              
              <h4>${i18n.t('sync.step3')}</h4>
              <ol>
                <li>"APIs & Services" ‚Üí "Credentials"</li>
                <li>"Create Credentials" ‚Üí "OAuth client ID"</li>
                <li>Application type: "Web application"</li>
                <li>Name: "Love Dossier"</li>
                <li>Authorized JavaScript origins: ${i18n.t('instructions.yourDomain')}</li>
                <li>${i18n.t('instructions.click')} "Create"</li>
                <li><strong>${i18n.t('instructions.copyClientId')} ${i18n.t('sync.clientId')}</strong></li>
              </ol>
            </div>
          </div>
          
          <div class="sync-settings-group">
            <div class="form-row">
              <label class="form-label">${i18n.t('sync.clientId')}:</label>
              <input type="text" class="form-input" id="syncClientId" value="${gs.clientId || ''}" placeholder="${i18n.t('hints.clientIdPlaceholder')}">
            </div>
            
            <div class="form-row" id="spreadsheetIdRow" style="display: ${gs.spreadsheetId ? 'flex' : 'none'}">
              <label class="form-label">${i18n.t('sync.spreadsheetId')}:</label>
              <input type="text" class="form-input" id="syncSpreadsheetId" value="${gs.spreadsheetId || ''}" readonly>
            </div>
            
            <div class="sync-buttons">
              <button class="btn btn-secondary btn-sm" id="btnAuthorizeGoogle" ${!gs.clientId ? 'disabled' : ''}>
                <i class="fas fa-sign-in-alt"></i> ${i18n.t('sync.authorizeGoogle')}
              </button>
              
              <button class="btn btn-secondary btn-sm" id="btnCreateSpreadsheet" style="display: none">
                <i class="fas fa-plus"></i> ${i18n.t('sync.createSpreadsheet')}
              </button>
              
              <button class="btn btn-secondary btn-sm" id="btnOpenSpreadsheet" style="display: ${gs.spreadsheetId ? 'inline-flex' : 'none'}">
                <i class="fas fa-external-link-alt"></i> ${i18n.t('sync.openSpreadsheet')}
              </button>
            </div>
            
            <div class="form-row">
              <label class="checkbox-label">
                <input type="checkbox" id="syncAutoSync" ${gs.autoSyncEnabled ? 'checked' : ''}>
                ${i18n.t('sync.autoSync')}
              </label>
            </div>
            
            <div class="form-row" id="autoSyncIntervalRow" style="display: ${gs.autoSyncEnabled ? 'flex' : 'none'}">
              <label class="form-label">${i18n.t('sync.interval')}:</label>
              <select class="form-input" id="syncInterval">
                <option value="1" ${gs.autoSyncInterval === 1 ? 'selected' : ''}>${i18n.t('sync.minute1')}</option>
                <option value="5" ${gs.autoSyncInterval === 5 ? 'selected' : ''}>${i18n.t('sync.minutes5')}</option>
                <option value="15" ${gs.autoSyncInterval === 15 ? 'selected' : ''}>${i18n.t('sync.minutes15')}</option>
                <option value="30" ${gs.autoSyncInterval === 30 ? 'selected' : ''}>${i18n.t('sync.minutes30')}</option>
                <option value="60" ${gs.autoSyncInterval === 60 ? 'selected' : ''}>${i18n.t('sync.hour1')}</option>
              </select>
            </div>
            
            <div class="form-row">
              <label class="checkbox-label">
                <input type="checkbox" id="syncEncryption" ${gs.encryptionEnabled ? 'checked' : ''}>
                ${i18n.t('sync.encryption')}
              </label>
            </div>
            
            <div id="encryptionPasswordFields" style="display: ${gs.encryptionEnabled ? 'block' : 'none'}">
              <div class="form-row">
                <label class="form-label">${i18n.t('modal.password')}:</label>
                <div class="password-input-group">
                  <input type="password" class="form-input" id="syncPassword" placeholder="${i18n.t('modal.enterPassword')}">
                  <button type="button" class="password-toggle">
                    <i class="fas fa-eye"></i>
                  </button>
                </div>
              </div>
              
              <div class="form-row">
                <label class="form-label">${i18n.t('modal.confirmPassword')}:</label>
                <div class="password-input-group">
                  <input type="password" class="form-input" id="syncPasswordConfirm" placeholder="${i18n.t('modal.confirmPasswordPlaceholder')}">
                  <button type="button" class="password-toggle">
                    <i class="fas fa-eye"></i>
                  </button>
                </div>
              </div>
              
              <p style="font-size: 0.75rem; color: var(--danger); margin-top: 0.5rem;">
                ‚ö†Ô∏è <strong>${i18n.t('messages.passwordNotStored')}</strong> ${i18n.t('messages.writeItDown')}
              </p>
            </div>
          </div>
          
          <!-- Security Notice -->
          <div class="security-notice">
            <div class="security-notice-title">
              <i class="fas fa-shield-alt"></i>
              ${i18n.t('sync.securityTitle')}
            </div>
            <ul>
              <li>${i18n.t('sync.securityItem1')}</li>
              <li>${i18n.t('sync.securityItem2')}</li>
              <li>${i18n.t('sync.securityItem3')}</li>
              <li>${i18n.t('sync.securityItem4')}</li>
              <li>${i18n.t('sync.securityItem5')}</li>
            </ul>
          </div>
        </div>
        
        <!-- –†–æ–∑–¥—ñ–ª 3: –ú—ñ–≥—Ä–∞—Ü—ñ—è –¥–∞–Ω–∏—Ö -->
        <div class="settings-section" id="migrationSection" style="display: ${gs.spreadsheetId ? 'block' : 'none'}">
          <div class="settings-section-title">
            <i class="fas fa-exchange-alt"></i>
            ${i18n.t('sync.migrationAndStats')}
          </div>
          
          <div class="sync-buttons">
            <button class="btn btn-secondary btn-sm" id="btnUploadToSheets">
              <i class="fas fa-cloud-upload-alt"></i> ${i18n.t('sync.exportToSheets')}
            </button>
            
            <button class="btn btn-secondary btn-sm" id="btnDownloadFromSheets">
              <i class="fas fa-cloud-download-alt"></i> ${i18n.t('sync.importFromSheets')}
            </button>
            
            <button class="btn btn-primary btn-sm" id="btnSyncNow">
              <i class="fas fa-sync-alt"></i> ${i18n.t('sync.syncNow')}
            </button>
          </div>
          
          <div class="sync-stats">
            <div class="sync-stat-item">
              <div class="sync-stat-label">${i18n.t('sync.fieldsFilled')}</div>
              <div class="sync-stat-value">${Object.keys(State.values).length}</div>
            </div>
            <div class="sync-stat-item">
              <div class="sync-stat-label">${i18n.t('sync.lastSync')}</div>
              <div class="sync-stat-value">${gs.lastSync ? new Date(gs.lastSync).toLocaleString(i18n.currentLang === 'uk' ? 'uk-UA' : i18n.currentLang === 'ru' ? 'ru-RU' : i18n.currentLang === 'pl' ? 'pl-PL' : 'en-US') : i18n.t('sync.never')}</div>
            </div>
          </div>
        </div>
      `;
    },
    
    // –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó
    async saveSyncSettings() {
      const mode = document.querySelector('input[name="storageMode"]:checked')?.value || 'localStorage';
      const oldMode = State.sync.mode;
      
      State.sync.mode = mode;
      
      if (mode === 'googleSheets') {
        const clientId = document.getElementById('syncClientId')?.value.trim();
        const autoSync = document.getElementById('syncAutoSync')?.checked;
        const interval = parseInt(document.getElementById('syncInterval')?.value) || 5;
        const encryption = document.getElementById('syncEncryption')?.checked;
        
        if (!clientId) {
          Toast.t('messages.enterClientId', 'error');
          return false;
        }
        
        State.sync.googleSheets.clientId = clientId;
        State.sync.googleSheets.autoSyncEnabled = autoSync;
        State.sync.googleSheets.autoSyncInterval = interval;
        State.sync.googleSheets.encryptionEnabled = encryption;
        
        // –Ø–∫—â–æ —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è —É–≤—ñ–º–∫–Ω–µ–Ω–µ, –ø–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –ø–∞—Ä–æ–ª—å
        if (encryption) {
          const password = document.getElementById('syncPassword')?.value;
          const passwordConfirm = document.getElementById('syncPasswordConfirm')?.value;
          
          if (!password || password.length < 6) {
            Toast.t('messages.passwordMinLength', 'error');
            return false;
          }
          
          if (password !== passwordConfirm) {
            Toast.t('messages.passwordsNotMatch', 'error');
            return false;
          }
          
          // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ —Ö–µ—à –ø–∞—Ä–æ–ª—è –¥–ª—è –≤–µ—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—ó
          State.sync.googleSheets.encryptionPasswordHash = await GoogleSheetsSync.encryption.hashPassword(password);
          
          // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –ø–∞—Ä–æ–ª—å –≤ sessionStorage (–ù–ï –≤ localStorage!)
          sessionStorage.setItem('encryption_password', password);
        }
        
        State.sync.googleSheets.enabled = true;
        
        // –ó–∞–ø—É—Å–∫–∞—î–º–æ –∞–≤—Ç–æ—Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—é —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ
        if (autoSync) {
          SyncManager.startAutoSync(interval);
        } else {
          SyncManager.stopAutoSync();
        }
        
        SyncManager.updateStatus('synced', 'Google Sheets');
      } else {
        State.sync.googleSheets.enabled = false;
        SyncManager.stopAutoSync();
        SyncManager.updateStatus('local', i18n.t('ui.localMode'));
      }
      
      // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è
      Storage.saveSyncSettings();
      
      // –Ø–∫—â–æ —Ä–µ–∂–∏–º –∑–º—ñ–Ω–∏–≤—Å—è, –∑–∞–ø–∏—Ç–∞—Ç–∏ –ø—Ä–æ –º—ñ–≥—Ä–∞—Ü—ñ—é
      if (oldMode !== mode && oldMode !== 'localStorage') {
        // TODO: –ø–æ–∫–∞–∑–∞—Ç–∏ –¥—ñ–∞–ª–æ–≥ –º—ñ–≥—Ä–∞—Ü—ñ—ó
      }
      
      Toast.t('messages.settingsSaved');
      return true;
    },
    
    // –û–Ω–æ–≤–ª—é—î badge –∑ –∫—ñ–ª—å–∫—ñ—Å—Ç—é –∞–∫—Ç–∏–≤–Ω–∏—Ö —Ñ—ñ–ª—å—Ç—Ä—ñ–≤
    updateFiltersBadge() {
      const activeFiltersCount = 
        (State.ui.fillFilter !== 'all' ? 1 : 0) + 
        State.ui.importanceFilters.length;
      
      const toggleBtn = document.getElementById('filtersToggleBtn');
      if (!toggleBtn) return;
      
      let badge = toggleBtn.querySelector('.filters-badge');
      
      if (activeFiltersCount > 0) {
        if (!badge) {
          badge = document.createElement('span');
          badge.className = 'filters-badge';
          toggleBtn.appendChild(badge);
        }
        badge.textContent = activeFiltersCount;
      } else {
        if (badge) {
          badge.remove();
        }
      }
    }
  };

  // Expose App methods globally for onclick handlers
  window.App = App;

  // Initialize app when DOM is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () => App.init());
  } else {
    App.init();
  }
})();
</script>
</body>
</html>